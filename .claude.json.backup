{
  "numStartups": 9,
  "installMethod": "global",
  "autoUpdates": true,
  "hasSeenTasksHint": true,
  "tipsHistory": {
    "new-user-warmup": 9,
    "memory-command": 1,
    "theme-command": 1,
    "status-line": 1,
    "prompt-queue": 7,
    "enter-to-steer-in-relatime": 1,
    "todo-list": 1,
    "# for memory": 1,
    "install-github-app": 1,
    "drag-and-drop-images": 1,
    "double-esc": 1,
    "continue": 1,
    "shift-tab": 1,
    "plan-mode-for-complex-tasks": 9,
    "terminal-setup": 3,
    "double-esc-code-restore": 3,
    "image-paste": 3,
    "tab-toggle-thinking": 3,
    "ultrathink-keyword": 3,
    "custom-agents": 7
  },
  "promptQueueUseCount": 2,
  "cachedStatsigGates": {
    "tengu_disable_bypass_permissions_mode": false,
    "tengu_tool_pear": false
  },
  "cachedDynamicConfigs": {
    "tengu-top-of-feed-tip": {
      "tip": "",
      "color": ""
    }
  },
  "userID": "2b1eec430de6f74f1354ac3e5714b099a3edb84ac622807a5188689f5d921f7b",
  "fallbackAvailableWarningThreshold": 0.5,
  "projects": {
    "/home/keith": {
      "allowedTools": [],
      "history": [
        {
          "display": "can you start the dev server so i can check it?",
          "pastedContents": {}
        },
        {
          "display": "On the Mandates tab on Industry page, the formatting of the Key Traits They Want section is bad (see the screenshot in /refs called MandateFormat.png). I'd like it to be spaced out in a more readable way like the original text that I copied and pasted in (see screenshot in /refs called MandateExample.png). Is there any sort of formatting that could be brought in so that the text field keeps the same formatting as that is pasted in?",
          "pastedContents": {}
        },
        {
          "display": "read claude.md",
          "pastedContents": {}
        },
        {
          "display": "update claude.md",
          "pastedContents": {}
        },
        {
          "display": "The posted mandate (for FX) is only visible for my login (keith@arecibomedia.com), when it’s meant to be visible for all logins on all workspaces. It’s just that it should only be my login who can Add Mandates via the button (this button shouldn’t appear for any other user).",
          "pastedContents": {}
        },
        {
          "display": "that's working. update claude.md",
          "pastedContents": {}
        },
        {
          "display": "what happened? you stopped at \"PI Error: 500 {\"type\":\"error\",\"error\":{\"type\":\"api_error\",\"message\":\"Internal server error\"},\"request_id\":null}\"",
          "pastedContents": {}
        },
        {
          "display": "I'm not seeing those changes on either the Vercel site (which has successfully built) or the local site. The +2 more articles is still black unclickable text. ",
          "pastedContents": {}
        },
        {
          "display": "This works now. But it says Netflix has 7 matches but it only shows 5 and has beneath it '+2 more articles' but that text isn't clickable so there's no way to see the other articles. can we have it so it will show 5 articles max but that the text below is clickable to expand to show all the articles?",
          "pastedContents": {}
        },
        {
          "display": "Can we check if the tracking functionality on the Industry page is working? On The Lynch Brothers workspace we have only one hit for Netflix, and that is from 4 days ago, which seems highly unlikely across all the RSS feeds we’re following. We’ve checked those sites and there have been multiple articles mentioning Netflix since then.",
          "pastedContents": {}
        },
        {
          "display": "Lets make so that on the Tasks page, a Task can be associated with more than one contact (in case the User is working with multiple parties on this Task)",
          "pastedContents": {}
        },
        {
          "display": "update claude.md",
          "pastedContents": {}
        },
        {
          "display": "can you make it collapsed by default? and then push and commit the changes to vercel",
          "pastedContents": {}
        },
        {
          "display": "i hit my usage limit. Carry on from where we left off",
          "pastedContents": {}
        },
        {
          "display": "On the Links page, lets make the Add New Link section collapsible.",
          "pastedContents": {}
        },
        {
          "display": "update claude.md",
          "pastedContents": {}
        },
        {
          "display": "On the Links page, in the top section where the User adds a link, lets bring in a similar section to Genres just beneath it, that’s for previously created tags (from the User, not globally). So same functionality as for genres where the User can click multiple tags. And then we’ll move the new tag field (that’s currently in between the URL and project fields, down to below the tag selection section.\n\nWith the Project field, can we change it to the same functionality that is available on the screen where you can edit a link. That functionality is a dropdown but the projects have check boxes next to them so the user can associate the link with multiple tags.\n",
          "pastedContents": {}
        },
        {
          "display": "and will the title be truncated in the same way as on the Links page?",
          "pastedContents": {}
        },
        {
          "display": "When on a project specific page, if i had a Link via that route, the auto fetch title isn't working and neither is the favicon",
          "pastedContents": {}
        },
        {
          "display": "Can you commit and push these changes to the Vercel site",
          "pastedContents": {}
        },
        {
          "display": "On a project specific page we currently have a blue edit pill button in the top right. can this also be replace with the edit icon from Links page and also bring in the trash icon too. And do the same for a contact specific page too. On the contacts specific page the blue edit pill button is currently in the bottom right of the top section but can this be moved to the top right to match the project specific page",
          "pastedContents": {}
        },
        {
          "display": "On the Schedule page, there's an edit button, can you replace that with the edit icon button you use on the Links page. Also, can you add the same trash icon button from the Links page too, so that Users can delete meetings",
          "pastedContents": {}
        },
        {
          "display": "that's working now. Need to truncate the link title as long ones make it so the trash and edit icons need to be scrolled across to.",
          "pastedContents": {}
        },
        {
          "display": "Still not working. here's the console log: [Pasted text #1 +60 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "favicon.ico:1 \n GET https://film-crm.vercel.app/favicon.ico 404 (Not Found)\n\npage-3d8939237f8d4662.js:1 Fetching metadata for: https://www.youtube.com/watch?v=SbMIY2hFdTk\npage-3d8939237f8d4662.js:1 Metadata fetch response status: 200\npage-3d8939237f8d4662.js:1 Metadata received: \n{title: '- YouTube', favicon_url: 'https://www.youtube.com/s/desktop/3fd9a6f6/img/favicon.ico', url: 'https://www.youtube.com/watch?v=SbMIY2hFdTk'}\nfavicon_url\n: \n\"https://www.youtube.com/s/desktop/3fd9a6f6/img/favicon.ico\"\ntitle\n: \n\"- YouTube\"\nurl\n: \n\"https://www.youtube.com/watch?v=SbMIY2hFdTk\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()"
            }
          }
        },
        {
          "display": "[Pasted text #1 +58 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Failed to load resource: the server responded with a status of 404 ()\npage-3d8939237f8d4662.js:1 Fetching metadata for: https://www.youtube.com/watch?v=SbMIY2hFdTk\npage-3d8939237f8d4662.js:1 Metadata fetch response status: 200\npage-3d8939237f8d4662.js:1 Metadata received: \n{title: '- YouTube', favicon_url: 'https://www.youtube.com/s/desktop/3fd9a6f6/img/favicon.ico', url: 'https://www.youtube.com/watch?v=SbMIY2hFdTk'}\nfavicon_url\n: \n\"https://www.youtube.com/s/desktop/3fd9a6f6/img/favicon.ico\"\ntitle\n: \n\"- YouTube\"\nurl\n: \n\"https://www.youtube.com/watch?v=SbMIY2hFdTk\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()"
            }
          }
        },
        {
          "display": "The auto fetch title is working on the local site but not the vercel site.",
          "pastedContents": {}
        },
        {
          "display": "Can you start the npm dev server so i check the local site?",
          "pastedContents": {}
        },
        {
          "display": "On the Links page, the auto fetch title isn’t working again. It was previously working. Then it stopped working. Then you got it working again and now it isn’t. Can you investigate why this might be?",
          "pastedContents": {}
        },
        {
          "display": "read claude.md",
          "pastedContents": {}
        },
        {
          "display": "Update claude.md",
          "pastedContents": {}
        },
        {
          "display": "I hit my usage limit. Carry on from where you were",
          "pastedContents": {}
        },
        {
          "display": "The auto fetch of the title isn't working as well as it is on the main site. For example, a youtube video called 5 Trends Reshaping Filmmaking gets an auto fetched title of just '- Youtube'. This was an issue we had on the main sites Links page but you managed to fix it. Could you look at that page to see how you ffixed it and do the same with the extension? Also, can you change the name of the extension to Fiink.",
          "pastedContents": {}
        },
        {
          "display": "The functionality works but i need the user to be able to select their workspace in the side panel. Also, i think the side panel should start as a simplified view where you just select the workspace and then can click a Save Link button, and then after the user clicks that button, the title, tags, projects, genres fields should appear.  Also, in the current version, if i load the side panel on say youtube.com, it will show that link in the side panel and fill in the title, but then if i navigate to another tab, this doesn’t update. Hopefully moving the save link details to after pressing the button might get around this issue.",
          "pastedContents": {}
        },
        {
          "display": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2ODQ0NjIsImV4cCI6MjA3MTI2MDQ2Mn0.BVyzkd-KWsOAHM3qzFx98-DschS6IOmwsmQwBrz8DaA",
          "pastedContents": {}
        },
        {
          "display": "Session error: AuthRetryableFetchError: failed to fetch: [Pasted text #1 +907 lines] -- TypeError: Failed to fetch: [Pasted text #2 +13 lines] -- Session error: AuthRetryableFetchError: Failed to fetch: [Pasted text #3 +907 lines] -- Session error: AuthApiError: Invalid API key: [Pasted text #4 +907 lines]  ",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n// Film CRM Chrome Extension - Side Panel\n// Uses Supabase for authentication and data storage\n\nconst SUPABASE_URL = 'https://hqefgtuczwjffuydjwmb.supabase.co';\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2ODQ0NjIsImV4cCI6MjA3MTI2MDQ2Mn0.14yQ9aRDZjTgN_esrmVtqycvLzKhRugJWGJxaf0r4AE';\n\nlet supabase;\nlet currentUser = null;\nlet currentWorkspaceId = null;\nlet currentTab = null;\nlet allTags = [];\nlet projects = [];\nlet genres = [];\n\n// Initialize Supabase client\nfunction initSupabase() {\n  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n}\n\n// Initialize app\nasync function init() {\n  initSupabase();\n\n  // Check for existing session\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (session) {\n    await handleAuthenticated(session.user);\n  } else {\n    showLogin();\n  }\n\n  // Setup event listeners\n  document.getElementById('login-btn').addEventListener('click', handleLogin);\n  document.getElementById('logout-link').addEventListener('click', handleLogout);\n  document.getElementById('quick-add-form').addEventListener('submit', handleSaveLink);\n\n  // Tag autocomplete\n  const tagInput = document.getElementById('link-tags');\n  tagInput.addEventListener('input', handleTagInput);\n  tagInput.addEventListener('blur', () => {\n    setTimeout(() => {\n      document.getElementById('tag-suggestions').classList.add('hidden');\n    }, 200);\n  });\n}\n\n// Show login view\nfunction showLogin() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.remove('hidden');\n  document.getElementById('main-view').classList.add('hidden');\n}\n\n// Show main view\nfunction showMain() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.add('hidden');\n  document.getElementById('main-view').classList.remove('hidden');\n}\n\n// Handle login\nasync function handleLogin() {\n  // Create a unique auth state for this login attempt\n  const authState = Math.random().toString(36).substring(7);\n  chrome.storage.local.set({ authState });\n\n  // Open the extension callback page directly (it has a login form)\n  const authUrl = `https://film-crm.vercel.app/extension-callback?state=${authState}`;\n\n  // Use window.open to open login popup\n  const authWindow = window.open(authUrl, '_blank', 'width=450,height=600');\n\n  if (!authWindow) {\n    showError('Please allow popups for this extension');\n    return;\n  }\n\n  // Listen for messages from the callback page\n  const messageListener = (request, sender, sendResponse) => {\n    if (request.type === 'EXTENSION_AUTH_SUCCESS' && request.state === authState) {\n      const { access_token, refresh_token } = request;\n\n      if (access_token) {\n        // Set the session in Supabase\n        supabase.auth.setSession({\n          access_token,\n          refresh_token\n        }).then(({ data: sessionData, error }) => {\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session');\n            return;\n          }\n\n          if (sessionData.user) {\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listener\n            chrome.runtime.onMessage.removeListener(messageListener);\n            // Update UI\n            handleAuthenticated(sessionData.user);\n          }\n        });\n      }\n    }\n  };\n\n  chrome.runtime.onMessage.addListener(messageListener);\n\n  // Also listen for postMessage from the popup window\n  const postMessageListener = async (event) => {\n    // Verify the message is from our domain\n    if (event.origin !== 'https://film-crm.vercel.app') return;\n\n    console.log('Received postMessage:', event.data);\n\n    if (event.data.type === 'EXTENSION_AUTH_SUCCESS' && event.data.state === authState) {\n      const { access_token, refresh_token } = event.data;\n\n      console.log('Auth success, setting session...', { hasAccessToken: !!access_token, hasRefreshToken: !!refresh_token });\n\n      if (access_token) {\n        try {\n          // Set the session in Supabase\n          const { data: sessionData, error } = await supabase.auth.setSession({\n            access_token,\n            refresh_token\n          });\n\n          console.log('Session set result:', { user: sessionData?.user?.email, error });\n\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session: ' + error.message);\n            return;\n          }\n\n          if (sessionData?.user) {\n            console.log('User authenticated:', sessionData.user.email);\n\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listeners\n            chrome.runtime.onMessage.removeListener(messageListener);\n            window.removeEventListener('message', postMessageListener);\n            clearInterval(checkClosed);\n            // Update UI\n            await handleAuthenticated(sessionData.user);\n          } else {\n            console.error('No user in session data');\n            showError('Authentication failed - no user data');\n          }\n        } catch (err) {\n          console.error('Exception during session setup:', err);\n          showError('Authentication error: ' + err.message);\n        }\n      }\n    }\n  };\n\n  window.addEventListener('message', postMessageListener);\n\n  // Check if window was closed before auth completed\n  const checkClosed = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(checkClosed);\n      chrome.runtime.onMessage.removeListener(messageListener);\n      window.removeEventListener('message', postMessageListener);\n    }\n  }, 1000);\n\n  // Clean up listeners after 5 minutes\n  setTimeout(() => {\n    clearInterval(checkClosed);\n    chrome.runtime.onMessage.removeListener(messageListener);\n    window.removeEventListener('message', postMessageListener);\n  }, 300000);\n}\n\n// Handle authenticated state\nasync function handleAuthenticated(user) {\n  currentUser = user;\n  document.getElementById('user-email').textContent = user.email;\n\n  // Get user's workspace\n  const { data: workspaces } = await supabase\n    .from('workspace_members')\n    .select('workspace_id')\n    .eq('user_id', user.id)\n    .limit(1)\n    .single();\n\n  if (workspaces) {\n    currentWorkspaceId = workspaces.workspace_id;\n    await loadReferenceData();\n    await loadCurrentTab();\n    showMain();\n  } else {\n    showError('No workspace found. Please create a workspace on the main site.');\n  }\n}\n\n// Load reference data (projects, genres, tags)\nasync function loadReferenceData() {\n  // Load projects\n  const { data: projectsData } = await supabase\n    .from('projects')\n    .select('id, title')\n    .eq('workspace_id', currentWorkspaceId)\n    .order('title');\n\n  projects = projectsData || [];\n\n  const projectSelect = document.getElementById('link-projects');\n  projectSelect.innerHTML = projects.length > 0\n    ? projects.map(p => `<option value=\"${p.id}\">${p.title}</option>`).join('')\n    : '<option value=\"\">No projects yet</option>';\n\n  // Load genres\n  const { data: genresData } = await supabase\n    .from('genres')\n    .select('id, name')\n    .order('name');\n\n  genres = genresData || [];\n\n  const genreSelect = document.getElementById('link-genres');\n  genreSelect.innerHTML = genres.length > 0\n    ? genres.map(g => `<option value=\"${g.id}\">${g.name}</option>`).join('')\n    : '<option value=\"\">No genres</option>';\n\n  // Load existing tags from links\n  const { data: linksData } = await supabase\n    .from('links')\n    .select('tags')\n    .eq('workspace_id', currentWorkspaceId);\n\n  const tagSet = new Set();\n  linksData?.forEach(link => {\n    link.tags?.forEach(tag => tagSet.add(tag.toLowerCase()));\n  });\n  allTags = Array.from(tagSet).sort();\n}\n\n// Load current tab info\nasync function loadCurrentTab() {\n  chrome.runtime.sendMessage({ action: 'getCurrentTab' }, async (response) => {\n    if (response) {\n      currentTab = response;\n      document.getElementById('current-url').textContent = response.url;\n\n      // Try to fetch metadata\n      try {\n        const metadata = await fetchLinkMetadata(response.url);\n        if (metadata.title) {\n          document.getElementById('link-title').value = metadata.title;\n        } else {\n          document.getElementById('link-title').value = response.title || '';\n        }\n      } catch (error) {\n        document.getElementById('link-title').value = response.title || '';\n      }\n    }\n  });\n}\n\n// Fetch link metadata from your API\nasync function fetchLinkMetadata(url) {\n  try {\n    const response = await fetch(`https://film-crm.vercel.app/api/fetch-link-metadata?url=${encodeURIComponent(url)}`);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching metadata:', error);\n    return { title: '', favicon_url: '' };\n  }\n}\n\n// Handle tag input for autocomplete\nfunction handleTagInput(e) {\n  const value = e.target.value;\n  const tags = value.split(',');\n  const currentTag = tags[tags.length - 1].trim().toLowerCase();\n\n  if (currentTag.length < 2) {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n    return;\n  }\n\n  const matches = allTags.filter(tag =>\n    tag.startsWith(currentTag) && tag !== currentTag\n  ).slice(0, 5);\n\n  if (matches.length > 0) {\n    const suggestionsDiv = document.getElementById('tag-suggestions');\n    suggestionsDiv.innerHTML = matches.map(tag =>\n      `<div class=\"tag-suggestion\" data-tag=\"${tag}\">${tag}</div>`\n    ).join('');\n\n    // Add click handlers\n    suggestionsDiv.querySelectorAll('.tag-suggestion').forEach(el => {\n      el.addEventListener('click', () => {\n        const selectedTag = el.dataset.tag;\n        const tags = value.split(',').map(t => t.trim()).filter(t => t);\n        tags[tags.length - 1] = selectedTag;\n        document.getElementById('link-tags').value = tags.join(', ') + ', ';\n        suggestionsDiv.classList.add('hidden');\n      });\n    });\n\n    suggestionsDiv.classList.remove('hidden');\n  } else {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n  }\n}\n\n// Handle save link\nasync function handleSaveLink(e) {\n  e.preventDefault();\n\n  if (!currentTab || !currentWorkspaceId) {\n    showError('Missing required data. Please refresh the extension.');\n    return;\n  }\n\n  const saveBtn = document.getElementById('save-btn');\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Saving...';\n\n  try {\n    const title = document.getElementById('link-title').value.trim();\n    const tagsInput = document.getElementById('link-tags').value;\n    const tags = tagsInput\n      .split(',')\n      .map(t => t.trim().toLowerCase())\n      .filter(t => t.length > 0);\n\n    const selectedProjects = Array.from(document.getElementById('link-projects').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    const selectedGenres = Array.from(document.getElementById('link-genres').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    // Fetch metadata again to get favicon\n    const metadata = await fetchLinkMetadata(currentTab.url);\n\n    // Insert link\n    const { data: link, error: linkError } = await supabase\n      .from('links')\n      .insert({\n        workspace_id: currentWorkspaceId,\n        url: currentTab.url,\n        title: title || currentTab.title,\n        tags: tags.length > 0 ? tags : null,\n        favicon_url: metadata.favicon_url || currentTab.favIconUrl || null\n      })\n      .select()\n      .single();\n\n    if (linkError) throw linkError;\n\n    // Add project associations\n    if (selectedProjects.length > 0) {\n      const projectLinks = selectedProjects.map(projectId => ({\n        link_id: link.id,\n        project_id: projectId\n      }));\n\n      const { error: projectError } = await supabase\n        .from('project_links')\n        .insert(projectLinks);\n\n      if (projectError) console.error('Error adding project links:', projectError);\n    }\n\n    // Add genre associations\n    if (selectedGenres.length > 0) {\n      const genreLinks = selectedGenres.map(genreId => ({\n        link_id: link.id,\n        genre_id: genreId\n      }));\n\n      const { error: genreError } = await supabase\n        .from('link_genres')\n        .insert(genreLinks);\n\n      if (genreError) console.error('Error adding genre links:', genreError);\n    }\n\n    showSuccess('Link saved successfully!');\n\n    // Reset form\n    document.getElementById('link-tags').value = '';\n    document.getElementById('link-projects').selectedIndex = -1;\n    document.getElementById('link-genres').selectedIndex = -1;\n\n    // Reload current tab to get new URL if navigated\n    setTimeout(() => {\n      loadCurrentTab();\n    }, 2000);\n\n  } catch (error) {\n    console.error('Error saving link:', error);\n    showError('Failed to save link: ' + error.message);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Save Link';\n  }\n}\n\n// Handle logout\nasync function handleLogout() {\n  await supabase.auth.signOut();\n  currentUser = null;\n  currentWorkspaceId = null;\n  showLogin();\n}\n\n// Show success message\nfunction showSuccess(message) {\n  const successDiv = document.getElementById('success-message');\n  successDiv.textContent = message;\n  successDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    successDiv.classList.add('hidden');\n  }, 3000);\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('error-message');\n  errorDiv.textContent = message;\n  errorDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    errorDiv.classList.add('hidden');\n  }, 5000);\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n "
            },
            "2": {
              "id": 2,
              "type": "text",
              "content": "1\n2\n3\n4\n5\n6\n7\n/**\n * Skipped minification because the original files appears to be already minified.\n * Original file: /npm/@supabase/supabase-js@2.78.0/dist/umd/supabase.js\n *\n * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files\n */\n!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.supabase=t():e.supabase=t()}(self,()=>(()=>{\"use strict\";var e={13:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(231),n=r(739),i=r(698),o=r(501),a=r(251),l=r(442),c=r(819),u=r(795);t.default=class{constructor(e,t,r){var s,i,u;this.supabaseUrl=e,this.supabaseKey=t;const h=(0,c.validateSupabaseUrl)(e);if(!t)throw new Error(\"supabaseKey is required.\");this.realtimeUrl=new URL(\"realtime/v1\",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace(\"http\",\"ws\"),this.authUrl=new URL(\"auth/v1\",h),this.storageUrl=new URL(\"storage/v1\",h),this.functionsUrl=new URL(\"functions/v1\",h);const d=`sb-${h.hostname.split(\".\")[0]}-auth-token`,f={db:a.DEFAULT_DB_OPTIONS,realtime:a.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},a.DEFAULT_AUTH_OPTIONS),{storageKey:d}),global:a.DEFAULT_GLOBAL_OPTIONS},p=(0,c.applySettingDefaults)(null!=r?r:{},f);this.storageKey=null!==(s=p.auth.storageKey)&&void 0!==s?s:\"\",this.headers=null!==(i=p.global.headers)&&void 0!==i?i:{},p.accessToken?(this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(u=p.auth)&&void 0!==u?u:{},this.headers,p.global.fetch),this.fetch=(0,l.fetchWithAuth)(t,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.rest=new n.PostgrestClient(new URL(\"rest/v1\",h).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new o.StorageClient(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new s.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:o,lock:a,debug:l},c,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new u.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,flowType:o,lock:a,debug:l,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>\"authorization\"===e.toLowerCase())})}_initRealtimeClient(e){return new i.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,\"CLIENT\",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){\"TOKEN_REFRESHED\"!==e&&\"SIGNED_IN\"!==e||this.changedAccessToken===r?\"SIGNED_OUT\"===e&&(this.realtime.setAuth(),\"STORAGE\"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}}},166:(e,t,r)=>{r.r(t),r.d(t,{AuthAdminApi:()=>Me,AuthApiError:()=>f,AuthClient:()=>We,AuthError:()=>h,AuthImplicitGrantRedirectError:()=>m,AuthInvalidCredentialsError:()=>b,AuthInvalidJwtError:()=>A,AuthInvalidTokenResponseError:()=>_,AuthPKCEGrantCodeExchangeError:()=>S,AuthRetryableFetchError:()=>E,AuthSessionMissingError:()=>y,AuthUnknownError:()=>g,AuthWeakPasswordError:()=>T,CustomAuthError:()=>w,GoTrueAdminApi:()=>he,GoTrueClient:()=>qe,NavigatorLockAcquireTimeoutError:()=>ge,SIGN_OUT_SCOPES:()=>ue,isAuthApiError:()=>p,isAuthError:()=>d,isAuthImplicitGrantRedirectError:()=>k,isAuthRetryableFetchError:()=>O,isAuthSessionMissingError:()=>v,isAuthWeakPasswordError:()=>j,lockInternals:()=>fe,navigatorLock:()=>ye,processLock:()=>_e});var s=r(823);const n=\"2.78.0\",i=3e4,o={\"X-Client-Info\":`gotrue-js/${n}`},a=\"X-Supabase-Api-Version\",l=Date.parse(\"2024-01-01T00:00:00.0Z\"),c=\"2024-01-01\",u=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class h extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name=\"AuthError\",this.status=t,this.code=r}}function d(e){return\"object\"==typeof e&&null!==e&&\"__isAuthError\"in e}class f extends h{constructor(e,t,r){super(e,t,r),this.name=\"AuthApiError\",this.status=t,this.code=r}}function p(e){return d(e)&&\"AuthApiError\"===e.name}class g extends h{constructor(e,t){super(e),this.name=\"AuthUnknownError\",this.originalError=t}}class w extends h{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class y extends w{constructor(){super(\"Auth session missing!\",\"AuthSessionMissingError\",400,void 0)}}function v(e){return d(e)&&\"AuthSessionMissingError\"===e.name}class _ extends w{constructor(){super(\"Auth session or user missing\",\"AuthInvalidTokenResponseError\",500,void 0)}}class b extends w{constructor(e){super(e,\"AuthInvalidCredentialsError\",400,void 0)}}class m extends w{constructor(e,t=null){super(e,\"AuthImplicitGrantRedirectError\",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function k(e){return d(e)&&\"AuthImplicitGrantRedirectError\"===e.name}class S extends w{constructor(e,t=null){super(e,\"AuthPKCEGrantCodeExchangeError\",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class E extends w{constructor(e,t){super(e,\"AuthRetryableFetchError\",t,void 0)}}function O(e){return d(e)&&\"AuthRetryableFetchError\"===e.name}class T extends w{constructor(e,t,r){super(e,\"AuthWeakPasswordError\",t,\"weak_password\"),this.reasons=r}}function j(e){return d(e)&&\"AuthWeakPasswordError\"===e.name}class A extends w{constructor(e){super(e,\"AuthInvalidJwtError\",400,\"invalid_jwt\")}}const P=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\".split(\"\"),I=\" \\t\\n\\r=\".split(\"\"),R=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<I.length;t+=1)e[I[t].charCodeAt(0)]=-2;for(let t=0;t<P.length;t+=1)e[P[t].charCodeAt(0)]=t;return e})();function C(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(P[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(P[e]),t.queuedBits-=6}}function x(e,t,r){const s=R[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character \"${String.fromCharCode(e)}\"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function $(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error(\"Invalid UTF-8 sequence\");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error(\"Invalid UTF-8 sequence\");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let t=0;t<e.length;t+=1)x(e.charCodeAt(t),n,i);return t.join(\"\")}function N(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function U(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)x(e.charCodeAt(t),r,s);return new Uint8Array(t)}function D(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>C(e,r,s)),C(null,r,s),t.join(\"\")}const L=()=>\"undefined\"!=typeof window&&\"undefined\"!=typeof document,B={tested:!1,writable:!1},F=()=>{if(!L())return!1;try{if(\"object\"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(B.tested)return B.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),B.tested=!0,B.writable=!0}catch(e){B.tested=!0,B.writable=!1}return B.writable},q=e=>{let t;return t=e||(\"undefined\"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,517)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},M=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},W=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},V=async(e,t)=>{await e.removeItem(t)};class K{constructor(){this.promise=new K.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function H(e){const t=e.split(\".\");if(3!==t.length)throw new A(\"Invalid JWT structure\");for(let e=0;e<t.length;e++)if(!u.test(t[e]))throw new A(\"JWT not in base64url format\");return{header:JSON.parse($(t[0])),payload:JSON.parse($(t[1])),signature:U(t[2]),raw:{header:t[0],payload:t[1]}}}function z(e){return(\"0\"+e.toString(16)).substr(-2)}async function J(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if(\"undefined\"==typeof crypto){const e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~\",t=e.length;let r=\"\";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,z).join(\"\")}();let n=s;r&&(n+=\"/PASSWORD_RECOVERY\"),await M(e,`${t}-code-verifier`,n);const i=await async function(e){if(\"undefined\"==typeof crypto||void 0===crypto.subtle||\"undefined\"==typeof TextEncoder)return console.warn(\"WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256.\"),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest(\"SHA-256\",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join(\"\")}(e);return btoa(t).replace(/\\+/g,\"-\").replace(/\\//g,\"_\").replace(/=+$/,\"\")}(s);return[i,s===i?\"plain\":\"s256\"]}K.promiseConstructor=Promise;const G=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,Y=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Q(e){if(!Y.test(e))throw new Error(\"@supabase/auth-js: Expected parameter to be UUID but is not\")}function X(){return new Proxy({},{get:(e,t)=>{if(\"__isUserNotAvailableProxy\"===t)return!0;if(\"symbol\"==typeof t){const e=t.toString();if(\"Symbol(Symbol.toPrimitive)\"===e||\"Symbol(Symbol.toStringTag)\"===e||\"Symbol(util.inspect.custom)\"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the \"${t}\" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the \"${t}\" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the \"${t}\" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Z(e){return JSON.parse(JSON.stringify(e))}const ee=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),te=[502,503,504];async function re(e){var t,r;if(!(\"object\"==typeof(r=e)&&null!==r&&\"status\"in r&&\"ok\"in r&&\"json\"in r&&\"function\"==typeof r.json))throw new E(ee(e),0);if(te.includes(e.status))throw new E(ee(e),e.status);let s,n;try{s=await e.json()}catch(e){throw new g(ee(e),e)}const i=function(e){const t=e.headers.get(a);if(!t)return null;if(!t.match(G))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=l&&\"object\"==typeof s&&s&&\"string\"==typeof s.code?n=s.code:\"object\"==typeof s&&s&&\"string\"==typeof s.error_code&&(n=s.error_code),n){if(\"weak_password\"===n)throw new T(ee(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if(\"session_not_found\"===n)throw new y}else if(\"object\"==typeof s&&s&&\"object\"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&\"string\"==typeof t,!0))throw new T(ee(s),e.status,s.weak_password.reasons);throw new f(ee(s),e.status||500,n)}async function se(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);i[a]||(i[a]=c),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?\"?\"+new URLSearchParams(o).toString():\"\",u=await async function(e,t,r,s,n,i){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return\"GET\"===e?n:(n.headers=Object.assign({\"Content-Type\":\"application/json;charset=UTF-8\"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,{},i);let a;try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new E(ee(e),0)}if(a.ok||await re(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(e){await re(e)}}(e,t,r+l,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(u):{data:Object.assign({},u),error:null}}function ne(e){var t;let r=null;var s;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ie(e){const t=ne(e);return!t.error&&e.weak_password&&\"object\"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&\"string\"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&\"string\"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function oe(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ae(e){return{data:e,error:null}}function le(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:i,verification_type:o}=e,a=(0,s.__rest)(e,[\"action_link\",\"email_otp\",\"hashed_token\",\"redirect_to\",\"verification_type\"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:i,verification_type:o},user:Object.assign({},a)},error:null}}function ce(e){return e}const ue=[\"global\",\"local\",\"others\"];class he{constructor({url:e=\"\",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=q(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=ue[0]){if(ue.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ue.join(\", \")}`);try{return await se(this.fetch,\"POST\",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(d(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await se(this.fetch,\"POST\",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:oe})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=(0,s.__rest)(e,[\"options\"]),n=Object.assign(Object.assign({},r),t);return\"newEmail\"in r&&(n.new_email=null==r?void 0:r.newEmail,delete n.newEmail),await se(this.fetch,\"POST\",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:le,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(d(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await se(this.fetch,\"POST\",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oe})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await se(this.fetch,\"GET\",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:\"\",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:\"\"},xform:ce});if(c.error)throw c.error;const u=await c.json(),h=null!==(i=c.headers.get(\"x-total-count\"))&&void 0!==i?i:0,d=null!==(a=null===(o=c.headers.get(\"link\"))||void 0===o?void 0:o.split(\",\"))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(\";\")[0].split(\"=\")[1].substring(0,1)),r=JSON.parse(e.split(\";\")[1].split(\"=\")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(d(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){Q(e);try{return await se(this.fetch,\"GET\",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oe})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){Q(e);try{return await se(this.fetch,\"PUT\",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:oe})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){Q(e);try{return await se(this.fetch,\"DELETE\",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:oe})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){Q(e.userId);try{const{data:t,error:r}=await se(this.fetch,\"GET\",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(d(e))return{data:null,error:e};throw e}}async _deleteFactor(e){Q(e.userId),Q(e.id);try{return{data:await se(this.fetch,\"DELETE\",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(d(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await se(this.fetch,\"GET\",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:\"\",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:\"\"},xform:ce});if(c.error)throw c.error;const u=await c.json(),h=null!==(i=c.headers.get(\"x-total-count\"))&&void 0!==i?i:0,d=null!==(a=null===(o=c.headers.get(\"link\"))||void 0===o?void 0:o.split(\",\"))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(\";\")[0].split(\"=\")[1].substring(0,1)),r=JSON.parse(e.split(\";\")[1].split(\"=\")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(e){if(d(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await se(this.fetch,\"POST\",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await se(this.fetch,\"GET\",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await se(this.fetch,\"PUT\",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await se(this.fetch,\"DELETE\",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(d(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await se(this.fetch,\"POST\",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(d(e))return{data:null,error:e};throw e}}}function de(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const fe={debug:!!(globalThis&&F()&&globalThis.localStorage&&\"true\"===globalThis.localStorage.getItem(\"supabase.gotrue-js.locks.debug\"))};class pe extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ge extends pe{}class we extends pe{}async function ye(e,t,r){fe.debug&&console.log(\"@supabase/gotrue-js: navigatorLock: acquire lock\",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),fe.debug&&console.log(\"@supabase/gotrue-js: navigatorLock acquire timed out\",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:\"exclusive\",ifAvailable:!0}:{mode:\"exclusive\",signal:s.signal},async s=>{if(!s){if(0===t)throw fe.debug&&console.log(\"@supabase/gotrue-js: navigatorLock: not immediately available\",e),new ge(`Acquiring an exclusive Navigator LockManager lock \"${e}\" immediately failed`);if(fe.debug)try{const e=await globalThis.navigator.locks.query();console.log(\"@supabase/gotrue-js: Navigator LockManager state\",JSON.stringify(e,null,\"  \"))}catch(e){console.warn(\"@supabase/gotrue-js: Error when querying Navigator LockManager state\",e)}return console.warn(\"@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request\"),await r()}fe.debug&&console.log(\"@supabase/gotrue-js: navigatorLock: acquired\",e,s.name);try{return await r()}finally{fe.debug&&console.log(\"@supabase/gotrue-js: navigatorLock: released\",e,s.name)}}))}const ve={};async function _e(e,t,r){var s;const n=null!==(s=ve[e])&&void 0!==s?s:Promise.resolve(),i=Promise.race([n.catch(()=>null),t>=0?new Promise((r,s)=>{setTimeout(()=>{s(new we(`Acquring process lock with name \"${e}\" timed out`))},t)}):null].filter(e=>e)).catch(e=>{if(e&&e.isAcquireTimeout)throw e;return null}).then(async()=>await r());return ve[e]=i.catch(async e=>{if(e&&e.isAcquireTimeout)return await n,null;throw e}),await i}function be(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address \"${e}\" is invalid.`);return e.toLowerCase()}function me(e){const t=(new TextEncoder).encode(e);return\"0x\"+Array.from(t,e=>e.toString(16).padStart(2,\"0\")).join(\"\")}class ke extends Error{constructor({message:e,code:t,cause:r,name:s}){var n;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(n=null!=s?s:r instanceof Error?r.name:void 0)&&void 0!==n?n:\"Unknown Error\",this.code=t}}class Se extends ke{constructor(e,t){super({code:\"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY\",cause:t,message:e}),this.name=\"WebAuthnUnknownError\",this.originalError=t}}function Ee({error:e,options:t}){var r,s,n;const{publicKey:i}=t;if(!i)throw Error(\"options was missing required publicKey property\");if(\"AbortError\"===e.name){if(t.signal instanceof AbortSignal)return new ke({message:\"Registration ceremony was sent an abort signal\",code:\"ERROR_CEREMONY_ABORTED\",cause:e})}else if(\"ConstraintError\"===e.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new ke({message:\"Discoverable credentials were required but no available authenticator supported it\",code:\"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT\",cause:e});if(\"conditional\"===t.mediation&&\"required\"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new ke({message:\"User verification was required during automatic registration but it could not be performed\",code:\"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE\",cause:e});if(\"required\"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new ke({message:\"User verification was required but no available authenticator supported it\",code:\"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT\",cause:e})}else{if(\"InvalidStateError\"===e.name)return new ke({message:\"The authenticator was previously registered\",code:\"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED\",cause:e});if(\"NotAllowedError\"===e.name)return new ke({message:e.message,code:\"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY\",cause:e});if(\"NotSupportedError\"===e.name)return 0===i.pubKeyCredParams.filter(e=>\"public-key\"===e.type).length?new ke({message:'No entry in pubKeyCredParams was of type \"public-key\"',code:\"ERROR_MALFORMED_PUBKEYCREDPARAMS\",cause:e}):new ke({message:\"No available authenticator supported any of the specified pubKeyCredParams algorithms\",code:\"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG\",cause:e});if(\"SecurityError\"===e.name){const t=window.location.hostname;if(!Re(t))return new ke({message:`${window.location.hostname} is an invalid domain`,code:\"ERROR_INVALID_DOMAIN\",cause:e});if(i.rp.id!==t)return new ke({message:`The RP ID \"${i.rp.id}\" is invalid for this domain`,code:\"ERROR_INVALID_RP_ID\",cause:e})}else if(\"TypeError\"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ke({message:\"User ID was not between 1 and 64 characters\",code:\"ERROR_INVALID_USER_ID_LENGTH\",cause:e})}else if(\"UnknownError\"===e.name)return new ke({message:\"The authenticator was unable to process the specified options, or could not create a new credential\",code:\"ERROR_AUTHENTICATOR_GENERAL_ERROR\",cause:e})}return new ke({message:\"a Non-Webauthn related error has occurred\",code:\"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY\",cause:e})}function Oe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error(\"options was missing required publicKey property\");if(\"AbortError\"===e.name){if(t.signal instanceof AbortSignal)return new ke({message:\"Authentication ceremony was sent an abort signal\",code:\"ERROR_CEREMONY_ABORTED\",cause:e})}else{if(\"NotAllowedError\"===e.name)return new ke({message:e.message,code:\"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY\",cause:e});if(\"SecurityError\"===e.name){const t=window.location.hostname;if(!Re(t))return new ke({message:`${window.location.hostname} is an invalid domain`,code:\"ERROR_INVALID_DOMAIN\",cause:e});if(r.rpId!==t)return new ke({message:`The RP ID \"${r.rpId}\" is invalid for this domain`,code:\"ERROR_INVALID_RP_ID\",cause:e})}else if(\"UnknownError\"===e.name)return new ke({message:\"The authenticator was unable to process the specified options, or could not create a new assertion signature\",code:\"ERROR_AUTHENTICATOR_GENERAL_ERROR\",cause:e})}return new ke({message:\"a Non-Webauthn related error has occurred\",code:\"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY\",cause:e})}const Te=new class{createNewAbortSignal(){if(this.controller){const e=new Error(\"Cancelling existing WebAuthn API call for new one\");e.name=\"AbortError\",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error(\"Manually cancelling existing WebAuthn API call\");e.name=\"AbortError\",this.controller.abort(e),this.controller=void 0}}};function je(e){if(!e)throw new Error(\"Credential creation options are required\");if(\"undefined\"!=typeof PublicKeyCredential&&\"parseCreationOptionsFromJSON\"in PublicKeyCredential&&\"function\"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,i=(0,s.__rest)(e,[\"challenge\",\"user\",\"excludeCredentials\"]),o=U(t).buffer,a=Object.assign(Object.assign({},r),{id:U(r.id).buffer}),l=Object.assign(Object.assign({},i),{challenge:o,user:a});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];l.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:U(t.id).buffer,type:t.type||\"public-key\",transports:t.transports})}}return l}function Ae(e){if(!e)throw new Error(\"Credential request options are required\");if(\"undefined\"!=typeof PublicKeyCredential&&\"parseRequestOptionsFromJSON\"in PublicKeyCredential&&\"function\"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=(0,s.__rest)(e,[\"challenge\",\"allowCredentials\"]),i=U(t).buffer,o=Object.assign(Object.assign({},n),{challenge:i});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.allowCredentials[e]=Object.assign(Object.assign({},t),{id:U(t.id).buffer,type:t.type||\"public-key\",transports:t.transports})}}return o}function Pe(e){var t;if(\"toJSON\"in e&&\"function\"==typeof e.toJSON)return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:D(new Uint8Array(e.response.attestationObject)),clientDataJSON:D(new Uint8Array(e.response.clientDataJSON))},type:\"public-key\",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function Ie(e){var t;if(\"toJSON\"in e&&\"function\"==typeof e.toJSON)return e.toJSON();const r=e,s=e.getClientExtensionResults(),n=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:D(new Uint8Array(n.authenticatorData)),clientDataJSON:D(new Uint8Array(n.clientDataJSON)),signature:D(new Uint8Array(n.signature)),userHandle:n.userHandle?D(new Uint8Array(n.userHandle)):void 0},type:\"public-key\",clientExtensionResults:s,authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function Re(e){return\"localhost\"===e||/^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i.test(e)}function Ce(){var e,t;return!!(L()&&\"PublicKeyCredential\"in window&&window.PublicKeyCredential&&\"credentials\"in navigator&&\"function\"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&\"function\"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const xe={hints:[\"security-key\"],authenticatorSelection:{authenticatorAttachment:\"cross-platform\",requireResidentKey:!1,userVerification:\"preferred\",residentKey:\"discouraged\"},attestation:\"none\"},$e={userVerification:\"preferred\",hints:[\"security-key\"]};function Ne(...e){const t=e=>null!==e&&\"object\"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),s={};for(const n of e)if(n)for(const e in n){const i=n[e];if(void 0!==i)if(Array.isArray(i))s[e]=i;else if(r(i))s[e]=i;else if(t(i)){const r=s[e];t(r)?s[e]=Ne(r,i):s[e]=Ne(i)}else s[e]=i}return s}class Ue{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:\"webauthn\"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},n){try{const{data:i,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:o};const a=null!=s?s:Te.createNewAbortSignal();if(\"create\"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case\"create\":{const t=function(e,t){return Ne(xe,e,t||{})}(i.webauthn.credential_options.publicKey,null==n?void 0:n.create),{data:r,error:s}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Se(\"Browser returned unexpected credential type\",t)}:{data:null,error:new Se(\"Empty credential response\",t)}}catch(t){return{data:null,error:Ee({error:t,options:e})}}}({publicKey:t,signal:a});return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:s}}case\"request\":{const t=function(e,t){return Ne($e,e,t||{})}(i.webauthn.credential_options.publicKey,null==n?void 0:n.request),{data:r,error:s}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Se(\"Browser returned unexpected credential type\",t)}:{data:null,error:new Se(\"Empty credential response\",t)}}catch(t){return{data:null,error:Oe({error:t,options:e})}}}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:a}));return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:s}}}}catch(e){return d(e)?{data:null,error:e}:{data:null,error:new g(\"Unexpected error in challenge\",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=(\"undefined\"!=typeof window?window.location.hostname:void 0),rpOrigins:r=(\"undefined\"!=typeof window?[window.location.origin]:void 0),signal:s}},n){if(!t)return{data:null,error:new h(\"rpId is required for WebAuthn authentication\")};try{if(!Ce())return{data:null,error:new g(\"Browser does not support WebAuthn\",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:n});if(!i)return{data:null,error:o};const{webauthn:a}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:a.type,rpId:t,rpOrigins:r,credential_response:a.credential_response}})}catch(e){return d(e)?{data:null,error:e}:{data:null,error:new g(\"Unexpected error in authenticate\",e)}}}async _register({friendlyName:e,rpId:t=(\"undefined\"!=typeof window?window.location.hostname:void 0),rpOrigins:r=(\"undefined\"!=typeof window?[window.location.origin]:void 0),signal:s},n){if(!t)return{data:null,error:new h(\"rpId is required for WebAuthn registration\")};try{if(!Ce())return{data:null,error:new g(\"Browser does not support WebAuthn\",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>\"webauthn\"===t.factor_type&&t.friendly_name===e&&\"unverified\"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:o};const{data:a,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:n});return a?this._verify({factorId:i.id,challengeId:a.challengeId,webauthn:{rpId:t,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:l}}catch(e){return d(e)?{data:null,error:e}:{data:null,error:new g(\"Unexpected error in register\",e)}}}}!function(){if(\"object\"!=typeof globalThis)try{Object.defineProperty(Object.prototype,\"__magic__\",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){\"undefined\"!=typeof self&&(self.globalThis=self)}}();const De={url:\"http://localhost:9999\",storageKey:\"supabase.auth.token\",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:o,flowType:\"implicit\",debug:!1,hasCustomAuthorizationHeader:!1};async function Le(e,t,r){return await r()}const Be={};class Fe{get jwks(){var e,t;return null!==(t=null===(e=Be[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Be[this.storageKey]=Object.assign(Object.assign({},Be[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Be[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Be[this.storageKey]=Object.assign(Object.assign({},Be[this.storageKey]),{cachedAt:e})}constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Fe.nextInstanceID,Fe.nextInstanceID+=1,this.instanceID>0&&L()&&console.warn(\"Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.\");const s=Object.assign(Object.assign({},De),e);if(this.logDebugMessages=!!s.debug,\"function\"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new he({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=q(s.fetch),this.lock=s.lock||Le,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:L()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=ye:this.lock=Le,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Ue(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:F()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=de(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=de(this.memoryStorage)),L()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error(\"Failed to create a new BroadcastChannel, multi-tab state changes will not be available\",e)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener(\"message\",async e=>{this._debug(\"received broadcast notification from other tab or client\",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${n}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&\"#\"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r=\"none\";if(this._isImplicitGrantCallback(t)?r=\"implicit\":await this._isPKCECallback(t)&&(r=\"pkce\"),L()&&this.detectSessionInUrl&&\"none\"!==r){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug(\"#_initialize()\",\"error detecting session from URL\",n),k(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if(\"identity_already_exists\"===t||\"identity_not_found\"===t||\"single_identity_not_deletable\"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:i,redirectType:o}=s;return this._debug(\"#_initialize()\",\"detected session in URL\",i,\"redirect type\",o),await this._saveSession(i),setTimeout(async()=>{\"recovery\"===o?await this._notifyAllSubscribers(\"PASSWORD_RECOVERY\",i):await this._notifyAllSubscribers(\"SIGNED_IN\",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return d(e)?{error:e}:{error:new g(\"Unexpected error during initialization\",e)}}finally{await this._handleVisibilityChange(),this._debug(\"#_initialize()\",\"end\")}}async signInAnonymously(e){var t,r,s;try{const n=await se(this.fetch,\"POST\",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:ne}),{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers(\"SIGNED_IN\",a)),{data:{user:l,session:a},error:null}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,r,s;try{let n;if(\"email\"in e){const{email:r,password:s,options:i}=e;let o=null,a=null;\"pkce\"===this.flowType&&([o,a]=await J(this.storage,this.storageKey)),n=await se(this.fetch,\"POST\",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:ne})}else{if(!(\"phone\"in e))throw new b(\"You must provide either an email or phone number and a password\");{const{phone:t,password:i,options:o}=e;n=await se(this.fetch,\"POST\",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:\"sms\",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:ne})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers(\"SIGNED_IN\",a)),{data:{user:l,session:a},error:null}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if(\"email\"in e){const{email:r,password:s,options:n}=e;t=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ie})}else{if(!(\"phone\"in e))throw new b(\"You must provide either an email or phone number and a password\");{const{phone:r,password:s,options:n}=e;t=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ie})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers(\"SIGNED_IN\",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case\"ethereum\":return await this.signInWithEthereum(e);case\"solana\":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain \"${t}\"`)}}async signInWithEthereum(e){var t,r,s,n,i,o,a,l,c,u,h;let f,p;if(\"message\"in e)f=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:d,options:g}=e;let w;if(L())if(\"object\"==typeof h)w=h;else{const e=window;if(!(\"ethereum\"in e)||\"object\"!=typeof e.ethereum||!(\"request\"in e.ethereum)||\"function\"!=typeof e.ethereum.request)throw new Error(\"@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.\");w=e.ethereum}else{if(\"object\"!=typeof h||!(null==g?void 0:g.url))throw new Error(\"@supabase/auth-js: Both wallet and url must be specified in non-browser environments.\");w=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),v=await w.request({method:\"eth_requestAccounts\"}).then(e=>e).catch(()=>{throw new Error(\"@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid\")});if(!v||0===v.length)throw new Error(\"@supabase/auth-js: No accounts available. Please ensure the wallet is connected.\");const _=be(v[0]);let b=null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!b){const e=await w.request({method:\"eth_chainId\"});b=parseInt(e,16)}f=function(e){var t;const{chainId:r,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:h,version:d}=e;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field \"chainId\". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field \"domain\". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field \"nonce\". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field \"uri\". URI must be provided.');if(\"1\"!==d)throw new Error(`@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes(\"\\n\"))throw new Error(`@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\\\n'. Provided value: ${e.statement}`);const f=`${u?`${u}://${s}`:s} wants you to sign in with your Ethereum account:\\n${be(e.address)}\\n\\n${e.statement?`${e.statement}\\n`:\"\"}`;let p=`URI: ${h}\\nVersion: ${d}\\nChain ID: ${r}${o?`\\nNonce: ${o}`:\"\"}\\nIssued At: ${i.toISOString()}`;if(n&&(p+=`\\nExpiration Time: ${n.toISOString()}`),a&&(p+=`\\nNot Before: ${a.toISOString()}`),l&&(p+=`\\nRequest ID: ${l}`),c){let e=\"\\nResources:\";for(const t of c){if(!t||\"string\"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field \"resources\". Every resource must be a valid string. Provided value: ${t}`);e+=`\\n- ${t}`}p+=e}return`${f}\\n${p}`}({domain:y.host,address:_,statement:d,uri:y.href,version:\"1\",chainId:b,nonce:null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.nonce,issuedAt:null!==(i=null===(n=null==g?void 0:g.signInWithEthereum)||void 0===n?void 0:n.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(l=null==g?void 0:g.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.resources}),p=await w.request({method:\"personal_sign\",params:[me(f),_]})}try{const{data:t,error:r}=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:\"ethereum\",message:f,signature:p},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:ne});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers(\"SIGNED_IN\",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSolana(e){var t,r,s,n,i,o,a,l,c,u,h,f;let p,g;if(\"message\"in e)p=e.message,g=e.signature;else{const{chain:h,wallet:d,statement:f,options:w}=e;let y;if(L())if(\"object\"==typeof d)y=d;else{const e=window;if(!(\"solana\"in e)||\"object\"!=typeof e.solana||!(\"signIn\"in e.solana&&\"function\"==typeof e.solana.signIn||\"signMessage\"in e.solana&&\"function\"==typeof e.solana.signMessage))throw new Error(\"@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.\");y=e.solana}else{if(\"object\"!=typeof d||!(null==w?void 0:w.url))throw new Error(\"@supabase/auth-js: Both wallet and url must be specified in non-browser environments.\");y=d}const v=new URL(null!==(t=null==w?void 0:w.url)&&void 0!==t?t:window.location.href);if(\"signIn\"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==w?void 0:w.signInWithSolana),{version:\"1\",domain:v.host,uri:v.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&\"object\"==typeof e[0])t=e[0];else{if(!(e&&\"object\"==typeof e&&\"signedMessage\"in e&&\"signature\"in e))throw new Error(\"@supabase/auth-js: Wallet method signIn() returned unrecognized value\");t=e}if(!(\"signedMessage\"in t&&\"signature\"in t&&(\"string\"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error(\"@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields\");p=\"string\"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),g=t.signature}else{if(!(\"signMessage\"in y&&\"function\"==typeof y.signMessage&&\"publicKey\"in y&&\"object\"==typeof y&&y.publicKey&&\"toBase58\"in y.publicKey&&\"function\"==typeof y.publicKey.toBase58))throw new Error(\"@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API\");p=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...f?[\"\",f,\"\"]:[\"\"],\"Version: 1\",`URI: ${v.href}`,`Issued At: ${null!==(s=null===(r=null==w?void 0:w.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(n=null==w?void 0:w.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...(null===(i=null==w?void 0:w.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...(null===(o=null==w?void 0:w.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...(null===(a=null==w?void 0:w.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...(null===(l=null==w?void 0:w.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==w?void 0:w.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?[\"Resources\",...w.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join(\"\\n\");const e=await y.signMessage((new TextEncoder).encode(p),\"utf8\");if(!(e&&e instanceof Uint8Array))throw new Error(\"@supabase/auth-js: Wallet signMessage() API returned an recognized value\");g=e}}try{const{data:t,error:r}=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:\"solana\",message:p,signature:D(g)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(f=e.options)||void 0===f?void 0:f.captchaToken}}:null),xform:ne});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers(\"SIGNED_IN\",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async _exchangeCodeForSession(e){const t=await W(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:\"\").split(\"/\");try{const{data:t,error:n}=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ne});if(await V(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers(\"SIGNED_IN\",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,o=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ne}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers(\"SIGNED_IN\",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,r,s,n,i;try{if(\"email\"in e){const{email:s,options:n}=e;let i=null,o=null;\"pkce\"===this.flowType&&([i,o]=await J(this.storage,this.storageKey));const{error:a}=await se(this.fetch,\"POST\",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if(\"phone\"in e){const{phone:t,options:r}=e,{data:o,error:a}=await se(this.fetch,\"POST\",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:\"sms\"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new b(\"You must provide either an email or phone number.\")}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,r;try{let s,n;\"options\"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await se(this.fetch,\"POST\",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:ne});if(o)throw o;if(!i)throw new Error(\"An error occurred on token verification.\");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers(\"recovery\"==e.type?\"PASSWORD_RECOVERY\":\"SIGNED_IN\",a)),{data:{user:l,session:a},error:null}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,r,s;try{let n=null,i=null;return\"pkce\"===this.flowType&&([n,i]=await J(this.storage,this.storageKey)),await se(this.fetch,\"POST\",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},\"providerId\"in e?{provider_id:e.providerId}:null),\"domain\"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:ae})}catch(e){if(d(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new y;const{error:s}=await se(this.fetch,\"GET\",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if(\"email\"in e){const{email:r,type:s,options:n}=e,{error:i}=await se(this.fetch,\"POST\",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if(\"phone\"in e){const{phone:r,type:s,options:n}=e,{data:i,error:o}=await se(this.fetch,\"POST\",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new b(\"You must provide either an email or phone number and a type\")}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug(\"#_acquireLock\",\"begin\",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug(\"#_acquireLock\",\"lock acquired for storage key\",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug(\"#_acquireLock\",\"lock released for storage key\",this.storageKey),this.lockAcquired=!1}})}finally{this._debug(\"#_acquireLock\",\"end\")}}async _useSession(e){this._debug(\"#_useSession\",\"begin\");try{const t=await this.__loadSession();return await e(t)}finally{this._debug(\"#_useSession\",\"end\")}}async __loadSession(){this._debug(\"#__loadSession()\",\"begin\"),this.lockAcquired||this._debug(\"#__loadSession()\",\"used outside of an acquired lock!\",(new Error).stack);try{let e=null;const t=await W(this.storage,this.storageKey);if(this._debug(\"#getSession()\",\"session from storage\",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug(\"#getSession()\",\"session from storage is not valid\"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug(\"#__loadSession()\",`session has${r?\"\":\" not\"} expired`,\"expires_at\",e.expires_at),!r){if(this.userStorage){const t=await W(this.userStorage,this.storageKey+\"-user\");(null==t?void 0:t.user)?e.user=t.user:e.user=X()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,r,s)=>{if(\"__isInsecureUserWarningProxy\"===r)return!0;if(\"symbol\"==typeof r){const t=r.toString();if(\"Symbol(Symbol.toPrimitive)\"===t||\"Symbol(Symbol.toStringTag)\"===t||\"Symbol(util.inspect.custom)\"===t||\"Symbol(nodejs.util.inspect.custom)\"===t)return Reflect.get(e,r,s)}return t.value||\"string\"!=typeof r||(console.warn(\"Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.\"),t.value=!0),Reflect.get(e,r,s)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug(\"#__loadSession()\",\"end\")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await se(this.fetch,\"GET\",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oe}):await this._useSession(async e=>{var t,r,s;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await se(this.fetch,\"GET\",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:oe}):{data:{user:null},error:new y}})}catch(e){if(d(e))return v(e)&&(await this._removeSession(),await V(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new y;const i=s.session;let o=null,a=null;\"pkce\"===this.flowType&&null!=e.email&&([o,a]=await J(this.storage,this.storageKey));const{data:l,error:c}=await se(this.fetch,\"PUT\",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:oe});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers(\"USER_UPDATED\",i),{data:{user:i.user},error:null}})}catch(e){if(d(e))return{data:{user:null},error:e};throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new y;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:i}=H(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:\"bearer\",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers(\"SIGNED_IN\",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(d(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new y;const{data:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!L())throw new m(\"No browser detected.\");if(e.error||e.error_description||e.error_code)throw new m(e.error_description||\"Error in URL with unspecified error_description\",{error:e.error||\"unspecified_error\",code:e.error_code||\"unspecified_code\"});switch(t){case\"implicit\":if(\"pkce\"===this.flowType)throw new S(\"Not a valid PKCE flow url.\");break;case\"pkce\":if(\"implicit\"===this.flowType)throw new m(\"Not a valid implicit grant flow url.\")}if(\"pkce\"===t){if(this._debug(\"#_initialize()\",\"begin\",\"is PKCE flow\",!0),!e.code)throw new S(\"No code detected.\");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete(\"code\"),window.history.replaceState(window.history.state,\"\",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!(n&&a&&o&&c))throw new m(\"No session defined in URL\");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const f=d-u;1e3*f<=i&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn(\"@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale\",p,d,u):u-p<0&&console.warn(\"@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew\",p,d,u);const{data:g,error:w}=await this._getUser(n);if(w)throw w;const y={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:d,refresh_token:o,token_type:c,user:g.user};return window.location.hash=\"\",this._debug(\"#_getSessionFromURL()\",\"clearing window.location.hash\"),{data:{session:y,redirectType:e.type},error:null}}catch(e){if(d(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await W(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:\"global\"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:\"global\"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!p(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return\"others\"!==e&&(await this._removeSession(),await V(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return(\"x\"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug(\"#unsubscribe()\",\"state change callback with id removed\",t),this.stateChangeEmitters.delete(t)}};return this._debug(\"#onAuthStateChange()\",\"registered callback with id\",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback(\"INITIAL_SESSION\",s)),this._debug(\"INITIAL_SESSION\",\"callback id\",e,\"session\",s)}catch(t){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback(\"INITIAL_SESSION\",null)),this._debug(\"INITIAL_SESSION\",\"callback id\",e,\"error\",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;\"pkce\"===this.flowType&&([r,s]=await J(this.storage,this.storageKey,!0));try{return await se(this.fetch,\"POST\",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(d(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(e){if(d(e))return{data:null,error:e};throw e}}async linkIdentity(e){return\"token\"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,i,o;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await se(this.fetch,\"GET\",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})});if(s)throw s;return L()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(t){if(d(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:s,data:{session:n}}=t;if(s)throw s;const{options:i,provider:o,token:a,access_token:l,nonce:c}=e,u=await se(this.fetch,\"POST\",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==n?void 0:n.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:ne}),{data:h,error:d}=u;return d?{data:{user:null,session:null},error:d}:h&&h.session&&h.user?(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers(\"USER_UPDATED\",h.session)),{data:h,error:d}):{data:{user:null,session:null},error:new _}}catch(e){if(d(e))return{data:{user:null,session:null},error:e};throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)throw i;return await se(this.fetch,\"DELETE\",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,\"begin\");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,\"refreshing attempt\",r),await se(this.fetch,\"POST\",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ne})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&O(t)&&Date.now()+r-n<i},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await r(n);if(!s(n,null))return void e(t)}catch(e){if(!s(n,e))return void t(e)}})()}))}catch(e){if(this._debug(t,\"error\",e),d(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,\"end\")}var r,s}_isValidSession(e){return\"object\"==typeof e&&null!==e&&\"access_token\"in e&&\"refresh_token\"in e&&\"expires_at\"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug(\"#_handleProviderSignIn()\",\"provider\",e,\"options\",t,\"url\",r),L()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r=\"#_recoverAndRefresh()\";this._debug(r,\"begin\");try{const s=await W(this.storage,this.storageKey);if(s&&this.userStorage){let t=await W(this.userStorage,this.storageKey+\"-user\");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:s.user},await M(this.userStorage,this.storageKey+\"-user\",t)),s.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:X()}else if(s&&!s.user&&!s.user){const e=await W(this.storage,this.storageKey+\"-user\");e&&(null==e?void 0:e.user)?(s.user=e.user,await V(this.storage,this.storageKey+\"-user\"),await M(this.storage,this.storageKey,s)):s.user=X()}if(this._debug(r,\"session from storage\",s),!this._isValidSession(s))return this._debug(r,\"session is not valid\"),void(null!==s&&await this._removeSession());const n=1e3*(null!==(t=s.expires_at)&&void 0!==t?t:1/0)-Date.now()<9e4;if(this._debug(r,`session has${n?\"\":\" not\"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),O(e)||(this._debug(r,\"refresh failed with a non-retryable error, removing the session\",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers(\"SIGNED_IN\",s)):this._debug(r,\"could not get user data, skipping SIGNED_IN notification\")}catch(e){console.error(\"Error getting user data:\",e),this._debug(r,\"error getting user data, skipping SIGNED_IN notification\",e)}else await this._notifyAllSubscribers(\"SIGNED_IN\",s)}catch(e){return this._debug(r,\"error\",e),void console.error(e)}finally{this._debug(r,\"end\")}}async _callRefreshToken(e){var t,r;if(!e)throw new y;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,\"begin\");try{this.refreshingDeferred=new K;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new y;await this._saveSession(t.session),await this._notifyAllSubscribers(\"TOKEN_REFRESHED\",t.session);const s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,\"error\",e),d(e)){const r={data:null,error:e};return O(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,\"end\")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,\"begin\",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,\"end\")}}async _saveSession(e){this._debug(\"#_saveSession()\",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await M(this.userStorage,this.storageKey+\"-user\",{user:t.user});const e=Object.assign({},t);delete e.user;const s=Z(e);await M(this.storage,this.storageKey,s)}else{const e=Z(t);await M(this.storage,this.storageKey,e)}}async _removeSession(){this._debug(\"#_removeSession()\"),await V(this.storage,this.storageKey),await V(this.storage,this.storageKey+\"-code-verifier\"),await V(this.storage,this.storageKey+\"-user\"),this.userStorage&&await V(this.userStorage,this.storageKey+\"-user\"),await this._notifyAllSubscribers(\"SIGNED_OUT\",null)}_removeVisibilityChangedCallback(){this._debug(\"#_removeVisibilityChangedCallback()\");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&L()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener(\"visibilitychange\",e)}catch(e){console.error(\"removing visibilitychange callback failed\",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug(\"#_startAutoRefresh()\");const e=setInterval(()=>this._autoRefreshTokenTick(),i);this.autoRefreshTicker=e,e&&\"object\"==typeof e&&\"function\"==typeof e.unref?e.unref():\"undefined\"!=typeof Deno&&\"function\"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug(\"#_stopAutoRefresh()\");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug(\"#_autoRefreshTokenTick()\",\"begin\");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug(\"#_autoRefreshTokenTick()\",\"no session\");const s=Math.floor((1e3*r.expires_at-e)/i);this._debug(\"#_autoRefreshTokenTick()\",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error(\"Auto refresh tick failed with error. This is likely a transient error.\",e)}}finally{this._debug(\"#_autoRefreshTokenTick()\",\"end\")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof pe))throw e;this._debug(\"auto refresh token tick lock not available\")}}async _handleVisibilityChange(){if(this._debug(\"#_handleVisibilityChange()\"),!L()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener(\"visibilitychange\",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error(\"_handleVisibilityChange\",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,\"visibilityState\",document.visibilityState),\"visible\"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{\"visible\"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,\"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting\")}))):\"hidden\"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),\"pkce\"===this.flowType){const[e,t]=await J(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join(\"&\")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await se(this.fetch,\"DELETE\",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},\"phone\"===e.factorType?{phone:e.phone}:\"totp\"===e.factorType?{issuer:e.issuer}:{}),{data:a,error:l}=await se(this.fetch,\"POST\",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:(\"totp\"===e.factorType&&\"totp\"===a.type&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const i=Object.assign({challenge_id:e.challengeId},\"webauthn\"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:\"create\"===e.webauthn.type?Pe(e.webauthn.credential_response):Ie(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:a}=await se(this.fetch,\"POST\",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers(\"MFA_CHALLENGE_VERIFIED\",o),{data:o,error:a})})}catch(e){if(d(e))return{data:null,error:e};throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const i=await se(this.fetch,\"POST\",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});if(i.error)return i;const{data:o}=i;if(\"webauthn\"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case\"create\":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:je(o.webauthn.credential_options.publicKey)})})}),error:null};case\"request\":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Ae(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(d(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])s.all.push(r),\"verified\"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:s}=await this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=H(r.access_token);let i=null;n.aal&&(i=n.aal);let o=i;return(null!==(t=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>\"verified\"===e.status))&&void 0!==t?t:[]).length>0&&(o=\"aal2\"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:s}=t;return s?{data:null,error:s}:r?await se(this.fetch,\"GET\",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):{data:null,error:new y}})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;if(n)return{data:null,error:n};if(!s)return{data:null,error:new y};const i=await se(this.fetch,\"POST\",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:\"approve\"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&L()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(d(e))return{data:null,error:e};throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;if(n)return{data:null,error:n};if(!s)return{data:null,error:new y};const i=await se(this.fetch,\"POST\",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:\"deny\"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&L()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(d(e))return{data:null,error:e};throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>s)return r;const{data:n,error:i}=await se(this.fetch,\"GET\",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=s,r=n.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:s,payload:n,signature:i,raw:{header:o,payload:a}}=H(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error(\"Missing exp claim\");if(e<=Math.floor(Date.now()/1e3))throw new Error(\"JWT has expired\")}(n.exp);const l=s.alg&&!s.alg.startsWith(\"HS\")&&s.kid&&\"crypto\"in globalThis&&\"subtle\"in globalThis.crypto?await this.fetchJwk(s.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:n,header:s,signature:i},error:null}}const c=function(e){switch(e){case\"RS256\":return{name:\"RSASSA-PKCS1-v1_5\",hash:{name:\"SHA-256\"}};case\"ES256\":return{name:\"ECDSA\",namedCurve:\"P-256\",hash:{name:\"SHA-256\"}};default:throw new Error(\"Invalid alg claim\")}}(s.alg),u=await crypto.subtle.importKey(\"jwk\",l,c,!0,[\"verify\"]);if(!await crypto.subtle.verify(c,u,i,function(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}N(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${o}.${a}`)))throw new A(\"Invalid JWT signature\");return{data:{claims:n,header:s,signature:i},error:null}}catch(e){if(d(e))return{data:null,error:e};throw e}}}Fe.nextInstanceID=0;const qe=Fe,Me=he,We=Fe},231:(e,t,r)=>{r.r(t),r.d(t,{FunctionRegion:()=>s,FunctionsClient:()=>c,FunctionsError:()=>i,FunctionsFetchError:()=>o,FunctionsHttpError:()=>l,FunctionsRelayError:()=>a});var s,n=r(823);class i extends Error{constructor(e,t=\"FunctionsError\",r){super(e),this.name=t,this.context=r}}class o extends i{constructor(e){super(\"Failed to send a request to the Edge Function\",\"FunctionsFetchError\",e)}}class a extends i{constructor(e){super(\"Relay Error invoking the Edge Function\",\"FunctionsRelayError\",e)}}class l extends i{constructor(e){super(\"Edge Function returned a non-2xx status code\",\"FunctionsHttpError\",e)}}!function(e){e.Any=\"any\",e.ApNortheast1=\"ap-northeast-1\",e.ApNortheast2=\"ap-northeast-2\",e.ApSouth1=\"ap-south-1\",e.ApSoutheast1=\"ap-southeast-1\",e.ApSoutheast2=\"ap-southeast-2\",e.CaCentral1=\"ca-central-1\",e.EuCentral1=\"eu-central-1\",e.EuWest1=\"eu-west-1\",e.EuWest2=\"eu-west-2\",e.EuWest3=\"eu-west-3\",e.SaEast1=\"sa-east-1\",e.UsEast1=\"us-east-1\",e.UsWest1=\"us-west-1\",e.UsWest2=\"us-west-2\"}(s||(s={}));class c{constructor(e,{headers:t={},customFetch:n,region:i=s.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(e=>{let t;return t=e||(\"undefined\"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,517)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return(0,n.__awaiter)(this,arguments,void 0,function*(e,t={}){var r;try{const{headers:s,method:n,body:i,signal:c}=t;let u={},{region:h}=t;h||(h=this.region);const d=new URL(`${this.url}/${e}`);let f;h&&\"any\"!==h&&(u[\"x-region\"]=h,d.searchParams.set(\"forceFunctionRegion\",h)),i&&(s&&!Object.prototype.hasOwnProperty.call(s,\"Content-Type\")||!s)?\"undefined\"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(u[\"Content-Type\"]=\"application/octet-stream\",f=i):\"string\"==typeof i?(u[\"Content-Type\"]=\"text/plain\",f=i):\"undefined\"!=typeof FormData&&i instanceof FormData?f=i:(u[\"Content-Type\"]=\"application/json\",f=JSON.stringify(i)):f=i;const p=yield this.fetch(d.toString(),{method:n||\"POST\",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),s),body:f,signal:c}).catch(e=>{if(\"AbortError\"===e.name)throw e;throw new o(e)}),g=p.headers.get(\"x-relay-error\");if(g&&\"true\"===g)throw new a(p);if(!p.ok)throw new l(p);let w,y=(null!==(r=p.headers.get(\"Content-Type\"))&&void 0!==r?r:\"text/plain\").split(\";\")[0].trim();return w=\"application/json\"===y?yield p.json():\"application/octet-stream\"===y||\"application/pdf\"===y?yield p.blob():\"text/event-stream\"===y?p:\"multipart/form-data\"===y?yield p.formData():yield p.text(),{data:w,error:null,response:p}}catch(e){return e instanceof Error&&\"AbortError\"===e.name?{data:null,error:new o(e)}:{data:null,error:e,response:e instanceof l||e instanceof a?e.context:void 0}}})}}},251:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.DEFAULT_REALTIME_OPTIONS=t.DEFAULT_AUTH_OPTIONS=t.DEFAULT_DB_OPTIONS=t.DEFAULT_GLOBAL_OPTIONS=t.DEFAULT_HEADERS=void 0;const s=r(822);let n=\"\";n=\"undefined\"!=typeof Deno?\"deno\":\"undefined\"!=typeof document?\"web\":\"undefined\"!=typeof navigator&&\"ReactNative\"===navigator.product?\"react-native\":\"node\",t.DEFAULT_HEADERS={\"X-Client-Info\":`supabase-js-${n}/${s.version}`},t.DEFAULT_GLOBAL_OPTIONS={headers:t.DEFAULT_HEADERS},t.DEFAULT_DB_OPTIONS={schema:\"public\"},t.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:\"implicit\"},t.DEFAULT_REALTIME_OPTIONS={}},442:function(e,t,r){var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!(\"get\"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,\"default\",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)\"default\"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,\"__esModule\",{value:!0}),t.fetchWithAuth=t.resolveHeadersConstructor=t.resolveFetch=void 0;const a=o(r(517));t.resolveFetch=e=>{let t;return t=e||(\"undefined\"==typeof fetch?a.default:fetch),(...e)=>t(...e)},t.resolveHeadersConstructor=()=>\"undefined\"==typeof Headers?a.Headers:Headers,t.fetchWithAuth=(e,r,s)=>{const n=(0,t.resolveFetch)(s),i=(0,t.resolveHeadersConstructor)();return async(t,s)=>{var o;const a=null!==(o=await r())&&void 0!==o?o:e;let l=new i(null==s?void 0:s.headers);return l.has(\"apikey\")||l.set(\"apikey\",e),l.has(\"Authorization\")||l.set(\"Authorization\",`Bearer ${a}`),n(t,Object.assign(Object.assign({},s),{headers:l}))}}},501:(e,t,r)=>{r.r(t),r.d(t,{StorageAnalyticsApi:()=>O,StorageApiError:()=>o,StorageClient:()=>K,StorageError:()=>n,StorageUnknownError:()=>a,StorageVectorsApiError:()=>P,StorageVectorsClient:()=>M,StorageVectorsError:()=>j,StorageVectorsErrorCode:()=>R,StorageVectorsUnknownError:()=>I,VectorBucketApi:()=>q,VectorBucketScope:()=>W,VectorDataApi:()=>F,VectorIndexApi:()=>B,VectorIndexScope:()=>V,isPlainObject:()=>$,isStorageError:()=>i,isStorageVectorsError:()=>A,normalizeToFloat32:()=>N,resolveFetch:()=>C,resolveResponse:()=>x,validateVectorDimension:()=>U});var s=r(823);class n extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name=\"StorageError\"}}function i(e){return\"object\"==typeof e&&null!==e&&\"__isStorageError\"in e}class o extends n{constructor(e,t,r){super(e),this.name=\"StorageApiError\",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class a extends n{constructor(e,t){super(e),this.name=\"StorageUnknownError\",this.originalError=t}}const l=e=>{let t;return t=e||(\"undefined\"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,517)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},c=e=>{if(Array.isArray(e))return e.map(e=>c(e));if(\"function\"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,\"\"));t[s]=c(r)}),t},u=e=>{var t;return e.msg||e.message||e.error_description||(\"string\"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)};function h(e,t,n,i,l,c){return(0,s.__awaiter)(this,void 0,void 0,function*(){return new Promise((h,d)=>{e(n,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return\"GET\"!==e&&s?((e=>{if(\"object\"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(s)?(n.headers=Object.assign({\"Content-Type\":\"application/json\"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),r)):n})(t,i,l,c)).then(e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()}).then(e=>h(e)).catch(e=>((e,t,n)=>(0,s.__awaiter)(void 0,void 0,void 0,function*(){const i=yield(0,s.__awaiter)(void 0,void 0,void 0,function*(){return\"undefined\"==typeof Response?(yield Promise.resolve().then(r.bind(r,517))).Response:Response});e instanceof i&&!(null==n?void 0:n.noResolveJson)?e.json().then(r=>{const s=e.status||500,n=(null==r?void 0:r.statusCode)||s+\"\";t(new o(u(r),s,n))}).catch(e=>{t(new a(u(e),e))}):t(new a(u(e),e))}))(e,d,i))})})}function d(e,t,r,n){return(0,s.__awaiter)(this,void 0,void 0,function*(){return h(e,\"GET\",t,r,n)})}function f(e,t,r,n,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){return h(e,\"POST\",t,n,i,r)})}function p(e,t,r,n,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){return h(e,\"PUT\",t,n,i,r)})}function g(e,t,r,n,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){return h(e,\"DELETE\",t,n,i,r)})}class w{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}}var y;y=Symbol.toStringTag;const v=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[y]=\"BlobDownloadBuilder\",this.promise=null}asStream(){return new w(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}},_={limit:100,offset:0,sortBy:{column:\"name\",order:\"asc\"}},b={cacheControl:\"3600\",contentType:\"text/plain;charset=UTF-8\",upsert:!1};class m{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=l(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,n){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},b),n);let o=Object.assign(Object.assign({},this.headers),\"POST\"===e&&{\"x-upsert\":String(i.upsert)});const a=i.metadata;\"undefined\"!=typeof Blob&&r instanceof Blob?(s=new FormData,s.append(\"cacheControl\",i.cacheControl),a&&s.append(\"metadata\",this.encodeMetadata(a)),s.append(\"\",r)):\"undefined\"!=typeof FormData&&r instanceof FormData?(s=r,s.append(\"cacheControl\",i.cacheControl),a&&s.append(\"metadata\",this.encodeMetadata(a))):(s=r,o[\"cache-control\"]=`max-age=${i.cacheControl}`,o[\"content-type\"]=i.contentType,a&&(o[\"x-metadata\"]=this.toBase64(this.encodeMetadata(a)))),(null==n?void 0:n.headers)&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield(\"PUT\"==e?p:f)(this.fetch,`${this.url}/object/${c}`,s,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}upload(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate(\"POST\",e,t,r)})}uploadToSignedUrl(e,t,r,n){return(0,s.__awaiter)(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set(\"token\",t);try{let e;const t=Object.assign({upsert:b.upsert},n),i=Object.assign(Object.assign({},this.headers),{\"x-upsert\":String(t.upsert)});return\"undefined\"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append(\"cacheControl\",t.cacheControl),e.append(\"\",r)):\"undefined\"!=typeof FormData&&r instanceof FormData?(e=r,e.append(\"cacheControl\",t.cacheControl)):(e=r,i[\"cache-control\"]=`max-age=${t.cacheControl}`,i[\"content-type\"]=t.contentType),{data:{path:s,fullPath:(yield p(this.fetch,a.toString(),e,{headers:i})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s[\"x-upsert\"]=\"true\");const i=yield f(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get(\"token\");if(!a)throw new n(\"No token returned by API\");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}update(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate(\"PUT\",e,t,r)})}move(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield f(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}copy(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield f(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield f(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const i=(null==r?void 0:r.download)?`&download=${!0===r.download?\"\":r.download}`:\"\";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const s=yield f(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?\"\":r.download}`:\"\";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?\"render/image/authenticated\":\"object\",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:\"\",i=this._getFinalPath(e);return new v(()=>d(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield d(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:c(e),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}exists(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){return h(e,\"HEAD\",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),undefined)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e)&&e instanceof a){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?\"\":t.download}`:\"\";\"\"!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?\"render/image\":\"object\",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});\"\"!==o&&s.push(o);let a=s.join(\"&\");return\"\"!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}remove(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}list(e,t,r){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},_),t),{prefix:e||\"\"});return{data:yield f(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}listV2(e,t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield f(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return\"undefined\"!=typeof Buffer?Buffer.from(e).toString(\"base64\"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\\/+/,\"\")}`}_removeEmptyFolders(e){return e.replace(/^\\/|\\/$/g,\"\").replace(/\\/+/g,\"/\")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join(\"&\")}}const k=\"2.78.0\",S={\"X-Client-Info\":`storage-js/${k}`};class E{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes(\"storage.supabase.\")&&(n.hostname=n.hostname.replace(\"supabase.\",\"storage.supabase.\")),this.url=n.href.replace(/\\/$/,\"\"),this.headers=Object.assign(Object.assign({},S),t),this.fetch=l(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield d(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield d(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}createBucket(e){return(0,s.__awaiter)(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield f(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}emptyBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield f(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(e){const t={};return e&&(\"limit\"in e&&(t.limit=String(e.limit)),\"offset\"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?\"?\"+new URLSearchParams(t).toString():\"\"}}class O{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\\/$/,\"\"),this.headers=Object.assign(Object.assign({},S),t),this.fetch=l(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield f(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}listBuckets(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const t=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&t.set(\"limit\",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&t.set(\"offset\",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set(\"sortColumn\",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set(\"sortOrder\",e.sortOrder),(null==e?void 0:e.search)&&t.set(\"search\",e.search);const r=t.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield d(this.fetch,s,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(i(e))return{data:null,error:e};throw e}})}}const T={\"X-Client-Info\":`storage-js/${k}`,\"Content-Type\":\"application/json\"};class j extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name=\"StorageVectorsError\"}}function A(e){return\"object\"==typeof e&&null!==e&&\"__isStorageVectorsError\"in e}class P extends j{constructor(e,t,r){super(e),this.name=\"StorageVectorsApiError\",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class I extends j{constructor(e,t){super(e),this.name=\"StorageVectorsUnknownError\",this.originalError=t}}var R;!function(e){e.InternalError=\"InternalError\",e.S3VectorConflictException=\"S3VectorConflictException\",e.S3VectorNotFoundException=\"S3VectorNotFoundException\",e.S3VectorBucketNotEmpty=\"S3VectorBucketNotEmpty\",e.S3VectorMaxBucketsExceeded=\"S3VectorMaxBucketsExceeded\",e.S3VectorMaxIndexesExceeded=\"S3VectorMaxIndexesExceeded\"}(R||(R={}));const C=e=>{let t;return t=e||(\"undefined\"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,517)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},x=()=>(0,s.__awaiter)(void 0,void 0,void 0,function*(){return\"undefined\"==typeof Response?(yield Promise.resolve().then(r.bind(r,517))).Response:Response}),$=e=>{if(\"object\"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},N=e=>Array.from(new Float32Array(e)),U=(e,t)=>{if(void 0!==t&&e.float32.length!==t)throw new Error(`Vector dimension mismatch: expected ${t}, got ${e.float32.length}`)},D=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function L(e,t,r,n,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){return function(e,t,r,n,i,o){return(0,s.__awaiter)(this,void 0,void 0,function*(){return new Promise((a,l)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return\"GET\"!==e&&s?($(s)?(n.headers=Object.assign({\"Content-Type\":\"application/json\"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,Object.assign(Object.assign({},n),r)):n})(t,n,i,o)).then(e=>{if(!e.ok)throw e;if(null==n?void 0:n.noResolveJson)return e;const t=e.headers.get(\"content-type\");return t&&t.includes(\"application/json\")?e.json():{}}).then(e=>a(e)).catch(e=>((e,t,r)=>(0,s.__awaiter)(void 0,void 0,void 0,function*(){if(e&&\"object\"==typeof e&&\"status\"in e&&\"ok\"in e&&\"number\"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){const r=e.status||500,s=e;if(\"function\"==typeof s.json)s.json().then(e=>{const s=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+\"\";t(new P(D(e),r,s))}).catch(()=>{const e=r+\"\",n=s.statusText||`HTTP ${r} error`;t(new P(n,r,e))});else{const e=r+\"\",n=s.statusText||`HTTP ${r} error`;t(new P(n,r,e))}}else t(new I(D(e),e))}))(e,l,n))})})}(e,\"POST\",t,n,i,r)})}class B{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\\/$/,\"\"),this.headers=Object.assign(Object.assign({},T),t),this.fetch=C(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}getIndex(e,t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}listIndexes(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}deleteIndex(e,t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}}class F{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\\/$/,\"\"),this.headers=Object.assign(Object.assign({},T),t),this.fetch=C(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error(\"Vector batch size must be between 1 and 500 items\");return{data:(yield L(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}getVectors(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}listVectors(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error(\"segmentCount must be between 1 and 16\");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(\"segmentIndex must be between 0 and \"+(e.segmentCount-1))}return{data:yield L(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}queryVectors(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}deleteVectors(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error(\"Keys batch size must be between 1 and 500 items\");return{data:(yield L(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}}class q{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\\/$/,\"\"),this.headers=Object.assign(Object.assign({},T),t),this.fetch=C(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield L(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}listBuckets(){return(0,s.__awaiter)(this,arguments,void 0,function*(e={}){try{return{data:yield L(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield L(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(A(e))return{data:null,error:e};throw e}})}}class M extends q{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new W(this.url,this.headers,e,this.fetch)}}class W extends B{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,s.__awaiter)(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new V(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class V extends F{constructor(e,t,r,s,n){super(e,t,n),this.vectorBucketName=r,this.indexName=s}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,s.__awaiter)(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,s.__awaiter)(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class K extends E{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new m(this.url,this.headers,e,this.fetch)}get vectors(){return new M(this.url+\"/vector\",{headers:this.headers,fetch:this.fetch})}get analytics(){return new O(this.url+\"/iceberg\",this.headers,this.fetch)}}},517:(e,t,r)=>{r.r(t),r.d(t,{Headers:()=>o,Request:()=>a,Response:()=>l,default:()=>i,fetch:()=>n});var s=function(){if(\"undefined\"!=typeof self)return self;if(\"undefined\"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error(\"unable to locate global object\")}();const n=s.fetch,i=s.fetch.bind(s),o=s.Headers,a=s.Request,l=s.Response},595:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(823),n=s.__importDefault(r(517)),i=s.__importDefault(r(886));t.default=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:\"undefined\"==typeof fetch?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||([\"GET\",\"HEAD\"].includes(this.method)?this.headers.set(\"Accept-Profile\",this.schema):this.headers.set(\"Content-Profile\",this.schema)),\"GET\"!==this.method&&\"HEAD\"!==this.method&&this.headers.set(\"Content-Type\",\"application/json\");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s,n;let o=null,a=null,l=null,c=e.status,u=e.statusText;if(e.ok){if(\"HEAD\"!==this.method){const r=await e.text();\"\"===r||(a=\"text/csv\"===this.headers.get(\"Accept\")||this.headers.get(\"Accept\")&&(null===(t=this.headers.get(\"Accept\"))||void 0===t?void 0:t.includes(\"application/vnd.pgrst.plan+text\"))?r:JSON.parse(r))}const n=null===(r=this.headers.get(\"Prefer\"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),i=null===(s=e.headers.get(\"content-range\"))||void 0===s?void 0:s.split(\"/\");n&&i&&i.length>1&&(l=parseInt(i[1])),this.isMaybeSingle&&\"GET\"===this.method&&Array.isArray(a)&&(a.length>1?(o={code:\"PGRST116\",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:\"JSON object requested, multiple (or no) rows returned\"},a=null,l=null,c=406,u=\"Not Acceptable\"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{o=JSON.parse(t),Array.isArray(o)&&404===e.status&&(a=[],o=null,c=200,u=\"OK\")}catch(r){404===e.status&&\"\"===t?(c=204,u=\"No Content\"):o={message:t}}if(o&&this.isMaybeSingle&&(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.includes(\"0 rows\"))&&(o=null,c=200,u=\"OK\"),o&&this.shouldThrowOnError)throw new i.default(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:\"FetchError\"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:\"\"}`,hint:\"\",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:\"\"}`},data:null,count:null,status:0,statusText:\"\"}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}}},597:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(823),n=s.__importDefault(r(705)),i=s.__importDefault(r(973));class o{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new n.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;r||s?(a=r?\"HEAD\":\"GET\",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(\",\")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a=\"POST\",c=t);const u=new Headers(this.headers);return n&&u.set(\"Prefer\",`count=${n}`),new i.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}}t.default=o},646:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!(\"get\"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)\"default\"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.createClient=t.SupabaseClient=t.FunctionRegion=t.FunctionsError=t.FunctionsRelayError=t.FunctionsFetchError=t.FunctionsHttpError=t.PostgrestError=void 0;const o=i(r(13));n(r(166),t);var a=r(739);Object.defineProperty(t,\"PostgrestError\",{enumerable:!0,get:function(){return a.PostgrestError}});var l=r(231);Object.defineProperty(t,\"FunctionsHttpError\",{enumerable:!0,get:function(){return l.FunctionsHttpError}}),Object.defineProperty(t,\"FunctionsFetchError\",{enumerable:!0,get:function(){return l.FunctionsFetchError}}),Object.defineProperty(t,\"FunctionsRelayError\",{enumerable:!0,get:function(){return l.FunctionsRelayError}}),Object.defineProperty(t,\"FunctionsError\",{enumerable:!0,get:function(){return l.FunctionsError}}),Object.defineProperty(t,\"FunctionRegion\",{enumerable:!0,get:function(){return l.FunctionRegion}}),n(r(698),t);var c=r(13);Object.defineProperty(t,\"SupabaseClient\",{enumerable:!0,get:function(){return i(c).default}}),t.createClient=(e,t,r)=>new o.default(e,t,r),function(){if(\"undefined\"!=typeof window)return!1;if(\"undefined\"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\\d+)\\./);return!!t&&parseInt(t[1],10)<=18}()&&console.warn(\"⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217\")},698:(e,t,r)=>{r.r(t),r.d(t,{REALTIME_CHANNEL_STATES:()=>A,REALTIME_LISTEN_TYPES:()=>O,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:()=>E,REALTIME_PRESENCE_LISTEN_EVENTS:()=>S,REALTIME_SUBSCRIBE_STATES:()=>T,RealtimeChannel:()=>P,RealtimeClient:()=>C,RealtimePresence:()=>j,WebSocketFactory:()=>s});const s=class{static detectEnvironment(){var e;if(\"undefined\"!=typeof WebSocket)return{type:\"native\",constructor:WebSocket};if(\"undefined\"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:\"native\",constructor:globalThis.WebSocket};if(void 0!==r.g&&void 0!==r.g.WebSocket)return{type:\"native\",constructor:r.g.WebSocket};if(\"undefined\"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:\"cloudflare\",error:\"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.\",workaround:\"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime.\"};if(\"undefined\"!=typeof globalThis&&globalThis.EdgeRuntime||\"undefined\"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes(\"Vercel-Edge\")))return{type:\"unsupported\",error:\"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.\",workaround:\"Use serverless functions or a different deployment target for WebSocket functionality.\"};if(\"undefined\"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,\"\").split(\".\")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:\"native\",constructor:globalThis.WebSocket}:{type:\"unsupported\",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:\"Provide a WebSocket implementation via the transport option.\"}:{type:\"unsupported\",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install \"ws\" package and provide it via the transport option:\\nimport ws from \"ws\"\\nnew RealtimeClient(url, { transport: ws })'}}}return{type:\"unsupported\",error:\"Unknown JavaScript runtime without WebSocket support.\",workaround:\"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation.\"}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||\"WebSocket not supported in this environment.\";throw e.workaround&&(t+=`\\n\\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return\"native\"===e.type||\"ws\"===e.type}catch(e){return!1}}};var n,i,o,a,l,c;!function(e){e[e.connecting=0]=\"connecting\",e[e.open=1]=\"open\",e[e.closing=2]=\"closing\",e[e.closed=3]=\"closed\"}(n||(n={})),function(e){e.closed=\"closed\",e.errored=\"errored\",e.joined=\"joined\",e.joining=\"joining\",e.leaving=\"leaving\"}(i||(i={})),function(e){e.close=\"phx_close\",e.error=\"phx_error\",e.join=\"phx_join\",e.reply=\"phx_reply\",e.leave=\"phx_leave\",e.access_token=\"access_token\"}(o||(o={})),function(e){e.websocket=\"websocket\"}(a||(a={})),function(e){e.Connecting=\"connecting\",e.Open=\"open\",e.Closing=\"closing\",e.Closed=\"closed\"}(l||(l={}));class u{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(\"string\"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=r.decode(e.slice(i,i+s));i+=s;const a=r.decode(e.slice(i,i+n));return i+=n,{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}class h{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime=\"abstime\",e.bool=\"bool\",e.date=\"date\",e.daterange=\"daterange\",e.float4=\"float4\",e.float8=\"float8\",e.int2=\"int2\",e.int4=\"int4\",e.int4range=\"int4range\",e.int8=\"int8\",e.int8range=\"int8range\",e.json=\"json\",e.jsonb=\"jsonb\",e.money=\"money\",e.numeric=\"numeric\",e.oid=\"oid\",e.reltime=\"reltime\",e.text=\"text\",e.time=\"time\",e.timestamp=\"timestamp\",e.timestamptz=\"timestamptz\",e.timetz=\"timetz\",e.tsrange=\"tsrange\",e.tstzrange=\"tstzrange\"}(c||(c={}));const d=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=f(s,e,t,n),r),{}):{}},f=(e,t,r,s)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=r[e];return i&&!s.includes(i)?p(i,o):g(o)},p=(e,t)=>{if(\"_\"===e.charAt(0)){const r=e.slice(1,e.length);return _(t,r)}switch(e){case c.bool:return w(t);case c.float4:case c.float8:case c.int2:case c.int4:case c.int8:case c.numeric:case c.oid:return y(t);case c.json:case c.jsonb:return v(t);case c.timestamp:return b(t);case c.abstime:case c.date:case c.daterange:case c.int4range:case c.int8range:case c.money:case c.reltime:case c.text:case c.time:case c.timestamptz:case c.timetz:case c.tsrange:case c.tstzrange:default:return g(t)}},g=e=>e,w=e=>{switch(e){case\"t\":return!0;case\"f\":return!1;default:return e}},y=e=>{if(\"string\"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},v=e=>{if(\"string\"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},_=(e,t)=>{if(\"string\"!=typeof e)return e;const r=e.length-1,s=e[r];if(\"{\"===e[0]&&\"}\"===s){let s;const n=e.slice(1,r);try{s=JSON.parse(\"[\"+n+\"]\")}catch(e){s=n?n.split(\",\"):[]}return s.map(e=>p(t,e))}return e},b=e=>\"string\"==typeof e?e.replace(\" \",\"T\"):e,m=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,\"http\"),t.pathname=t.pathname.replace(/\\/+$/,\"\").replace(/\\/socket\\/websocket$/i,\"\").replace(/\\/socket$/i,\"\").replace(/\\/websocket$/i,\"\"),\"\"===t.pathname||\"/\"===t.pathname?t.pathname=\"/api/broadcast\":t.pathname=t.pathname+\"/api/broadcast\",t.href};class k{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref=\"\",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref=\"\",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived(\"timeout\")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger(\"timeout\",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var S,E,O,T;!function(e){e.SYNC=\"sync\",e.JOIN=\"join\",e.LEAVE=\"leave\"}(S||(S={}));class j{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:\"presence_state\",diff:\"presence_diff\"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=j.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=j.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=j.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger(\"presence\",{event:\"join\",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger(\"presence\",{event:\"leave\",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger(\"presence\",{event:\"sync\"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map(e=>e.presence_ref),s=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;const i=r.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]=\"metas\"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL=\"*\",e.INSERT=\"INSERT\",e.UPDATE=\"UPDATE\",e.DELETE=\"DELETE\"}(E||(E={})),function(e){e.BROADCAST=\"broadcast\",e.PRESENCE=\"presence\",e.POSTGRES_CHANGES=\"postgres_changes\",e.SYSTEM=\"system\"}(O||(O={})),function(e){e.SUBSCRIBED=\"SUBSCRIBED\",e.TIMED_OUT=\"TIMED_OUT\",e.CLOSED=\"CLOSED\",e.CHANNEL_ERROR=\"CHANNEL_ERROR\"}(T||(T={}));const A=i;class P{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=i.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,\"\"),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:\"\",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new k(this,o.join,this.params,this.timeout),this.rejoinTimer=new h(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive(\"ok\",()=>{this.state=i.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log(\"channel\",`close ${this.topic} ${this._joinRef()}`),this.state=i.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log(\"channel\",`error ${this.topic}`,e),this.state=i.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive(\"timeout\",()=>{this._isJoining()&&(this.socket.log(\"channel\",`timeout ${this.topic}`,this.joinPush.timeout),this.state=i.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive(\"error\",e=>{this._isLeaving()||this._isClosed()||(this.socket.log(\"channel\",`error ${this.topic}`,e),this.state=i.errored,this.rejoinTimer.scheduleTimeout())}),this._on(o.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new j(this),this.broadcastEndpointURL=m(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(s=this.params.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==i.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],u=!!this.bindings[O.PRESENCE]&&this.bindings[O.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),h={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(T.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(T.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive(\"ok\",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,o=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:a,schema:l,table:c,filter:u}}=n,h=t&&t[r];if(!h||h.event!==a||h.schema!==l||h.table!==c||h.filter!==u)return this.unsubscribe(),this.state=i.errored,void(null==e||e(T.CHANNEL_ERROR,new Error(\"mismatch between server and client bindings for postgres changes\")));o.push(Object.assign(Object.assign({},n),{id:h.id}))}return this.bindings.postgres_changes=o,void(e&&e(T.SUBSCRIBED))}null==e||e(T.SUBSCRIBED)}).receive(\"error\",t=>{this.state=i.errored,null==e||e(T.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(\", \")||\"error\")))}).receive(\"timeout\",()=>{null==e||e(T.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:\"presence\",event:\"track\",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:\"presence\",event:\"untrack\"},e)}on(e,t,r){return this.state===i.joined&&e===O.PRESENCE&&(this.socket.log(\"channel\",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var s;const n=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:\"\";if(null==t)return Promise.reject(\"Payload is required for httpSend()\");const i={method:\"POST\",headers:{Authorization:n,apikey:this.socket.apiKey?this.socket.apiKey:\"\",\"Content-Type\":\"application/json\"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(s=r.timeout)&&void 0!==s?s:this.timeout);if(202===o.status)return{success:!0};let a=o.statusText;try{const e=await o.json();a=e.error||e.message||a}catch(e){}return Promise.reject(new Error(a))}async send(e,t={}){var r,s;if(this._canPush()||\"broadcast\"!==e.type)return new Promise(r=>{var s,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);\"broadcast\"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r(\"ok\"),o.receive(\"ok\",()=>r(\"ok\")),o.receive(\"error\",()=>r(\"error\")),o.receive(\"timeout\",()=>r(\"timed out\"))});{console.warn(\"Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.\");const{event:n,payload:i}=e,o={method:\"POST\",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:\"\",apikey:this.socket.apiKey?this.socket.apiKey:\"\",\"Content-Type\":\"application/json\"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?\"ok\":\"error\"}catch(e){return\"AbortError\"===e.name?\"timed out\":\"error\"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=i.leaving;const t=()=>{this.socket.log(\"channel\",`leave ${this.topic}`),this._trigger(o.close,\"leave\",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new k(this,o.leave,{},e),r.receive(\"ok\",()=>{t(),s(\"ok\")}).receive(\"timeout\",()=>{t(),s(\"timed out\")}).receive(\"error\",()=>{s(\"error\")}),r.send(),this._canPush()||r.trigger(\"ok\",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=i.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new k(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log(\"channel\",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=o;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,t,r);if(t&&!h)throw\"channel onMessage callbacks must return the payload, modified or unmodified\";[\"insert\",\"update\",\"delete\"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return\"*\"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(h,r)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var r,s,n,o,a,l;if([\"broadcast\",\"presence\",\"postgres_changes\"].includes(i)){if(\"id\"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&(\"*\"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return\"*\"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if(\"object\"==typeof h&&\"ids\"in h){const e=h.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,r)})}_isClosed(){return this.state===i.closed}_isJoined(){return this.state===i.joined}_isJoining(){return this.state===i.joining}_isLeaving(){return this.state===i.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&P.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(o.close,{},e)}_onError(e){this._on(o.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=i.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return\"INSERT\"!==e.type&&\"UPDATE\"!==e.type||(t.new=d(e.columns,e.record)),\"UPDATE\"!==e.type&&\"DELETE\"!==e.type||(t.old=d(e.columns,e.old_record)),t}}const I=()=>{},R=[1e3,2e3,5e3,1e4];class C{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint=\"\",this.httpEndpoint=\"\",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=I,this.ref=0,this.reconnectTimer=null,this.logger=I,this.conn=null,this.sendBuffer=[],this.serializer=new u,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState=\"disconnected\",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||(\"undefined\"==typeof fetch?(...e)=>Promise.resolve().then(r.bind(r,517)).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error(\"API key is required to connect to Realtime\");this.apiKey=t.params.apikey,this.endPoint=`${e}/${a.websocket}`,this.httpEndpoint=m(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState(\"connecting\"),this._setAuthSafely(\"connect\"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=s.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState(\"disconnected\");const t=e.message;if(t.includes(\"Node.js\"))throw new Error(`${t}\\n\\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\\n\\nOption 1: Use Node.js 22+ which has native WebSocket support\\nOption 2: Install and provide the \"ws\" package:\\n\\n  npm install ws\\n\\n  import ws from \"ws\"\\n  const client = new RealtimeClient(url, {\\n    ...options,\\n    transport: ws\\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:\"1.0.0\"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState(\"disconnecting\",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState(\"disconnected\")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState(\"disconnected\")},e?this.conn.close(e,null!=t?t:\"\"):this.conn.close(),this._teardownConnection()}else this._setConnectionState(\"disconnected\")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case n.connecting:return l.Connecting;case n.open:return l.Open;case n.closing:return l.Closing;default:return l.Closed}}isConnected(){return this.connectionState()===l.Open}isConnecting(){return\"connecting\"===this._connectionState}isDisconnecting(){return\"disconnecting\"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new P(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log(\"push\",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log(\"transport\",\"heartbeat timeout. Attempting to re-establish connection\");try{this.heartbeatCallback(\"timeout\")}catch(e){this.log(\"error\",\"error in heartbeat callback\",e)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,\"heartbeat timeout\"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},100)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:\"phoenix\",event:\"heartbeat\",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback(\"sent\")}catch(e){this.log(\"error\",\"error in heartbeat callback\",e)}this._setAuthSafely(\"heartbeat\")}else try{this.heartbeatCallback(\"disconnected\")}catch(e){this.log(\"error\",\"error in heartbeat callback\",e)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log(\"transport\",`leaving duplicate topic \"${e}\"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if(\"phoenix\"===e.topic&&\"phx_reply\"===e.event)try{this.heartbeatCallback(\"ok\"===e.payload.status?\"ok\":\"error\")}catch(e){this.log(\"error\",\"error in heartbeat callback\",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:\"\",o=s.status||\"\";this.log(\"receive\",`${o} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks(\"message\",e)})}_clearTimer(e){var t;\"heartbeat\"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):\"reconnect\"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer(\"heartbeat\"),this._clearTimer(\"reconnect\")}_setupConnectionHandlers(){this.conn&&(\"binaryType\"in this.conn&&(this.conn.binaryType=\"arraybuffer\"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState(\"connected\"),this.log(\"transport\",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer(\"reconnect\"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks(\"open\")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log(\"worker\",`starting worker for from ${this.workerUrl}`):this.log(\"worker\",\"starting default worker\");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log(\"worker\",\"worker error\",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{\"keepAlive\"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:\"start\",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState(\"disconnected\"),this.log(\"transport\",\"close\",e),this._triggerChanError(),this._clearTimer(\"heartbeat\"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks(\"close\",e)}_onConnError(e){this._setConnectionState(\"disconnected\"),this.log(\"transport\",`${e}`),this._triggerChanError(),this._triggerStateCallbacks(\"error\",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(o.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\\?/)?\"&\":\"?\";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\\n  addEventListener(\"message\", (e) => {\\n    if (e.data.event === \"start\") {\\n      setInterval(() => postMessage({ event: \"keepAlive\" }), e.data.interval);\\n    }\\n  });'],{type:\"application/javascript\"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,\"connecting\"===e?this._wasManualDisconnect=!1:\"disconnecting\"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:\"realtime-js/2.78.0\"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(o.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e=\"general\"){this.setAuth().catch(t=>{this.log(\"error\",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log(\"error\",`error in ${e} callback`,t)}})}catch(t){this.log(\"error\",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new h(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,o,a,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:25e3,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:I,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==e?void 0:e.reconnectAfterMs)&&void 0!==a?a:e=>R[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if(\"undefined\"!=typeof window&&!window.Worker)throw new Error(\"Web Worker is not supported\");this.workerUrl=null==e?void 0:e.workerUrl}}}},705:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(823).__importDefault(r(973));t.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,t){const{head:r=!1,count:n}=null!=t?t:{},i=r?\"HEAD\":\"GET\";let o=!1;const a=(null!=e?e:\"*\").split(\"\").map(e=>/\\s/.test(e)&&!o?\"\":('\"'===e&&(o=!o),e)).join(\"\");return this.url.searchParams.set(\"select\",a),n&&this.headers.append(\"Prefer\",`count=${n}`),new s.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;if(t&&this.headers.append(\"Prefer\",`count=${t}`),r||this.headers.append(\"Prefer\",\"missing=default\"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`\"${e}\"`);this.url.searchParams.set(\"columns\",e.join(\",\"))}}return new s.default({method:\"POST\",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){var o;if(this.headers.append(\"Prefer\",`resolution=${r?\"ignore\":\"merge\"}-duplicates`),void 0!==t&&this.url.searchParams.set(\"on_conflict\",t),n&&this.headers.append(\"Prefer\",`count=${n}`),i||this.headers.append(\"Prefer\",\"missing=default\"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`\"${e}\"`);this.url.searchParams.set(\"columns\",e.join(\",\"))}}return new s.default({method:\"POST\",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append(\"Prefer\",`count=${t}`),new s.default({method:\"PATCH\",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append(\"Prefer\",`count=${e}`),new s.default({method:\"DELETE\",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},739:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const s=r(823),n=s.__importDefault(r(597));t.PostgrestClient=n.default;const i=s.__importDefault(r(705));t.PostgrestQueryBuilder=i.default;const o=s.__importDefault(r(973));t.PostgrestFilterBuilder=o.default;const a=s.__importDefault(r(817));t.PostgrestTransformBuilder=a.default;const l=s.__importDefault(r(595));t.PostgrestBuilder=l.default;const c=s.__importDefault(r(886));t.PostgrestError=c.default,t.default={PostgrestClient:n.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default}},795:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.SupabaseAuthClient=void 0;const s=r(166);class n extends s.AuthClient{constructor(e){super(e)}}t.SupabaseAuthClient=n},817:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(823).__importDefault(r(595));class n extends s.default{select(e){let t=!1;const r=(null!=e?e:\"*\").split(\"\").map(e=>/\\s/.test(e)&&!t?\"\":('\"'===e&&(t=!t),e)).join(\"\");return this.url.searchParams.set(\"select\",r),this.headers.append(\"Prefer\",\"return=representation\"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:\"order\",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:\"\"}${e}.${t?\"asc\":\"desc\"}${void 0===r?\"\":r?\".nullsfirst\":\".nullslast\"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?\"limit\":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?\"offset\":`${s}.offset`,i=void 0===s?\"limit\":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,\"\"+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set(\"Accept\",\"application/vnd.pgrst.object+json\"),this}maybeSingle(){return\"GET\"===this.method?this.headers.set(\"Accept\",\"application/json\"):this.headers.set(\"Accept\",\"application/vnd.pgrst.object+json\"),this.isMaybeSingle=!0,this}csv(){return this.headers.set(\"Accept\",\"text/csv\"),this}geojson(){return this.headers.set(\"Accept\",\"application/geo+json\"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i=\"text\"}={}){var o;const a=[e?\"analyze\":null,t?\"verbose\":null,r?\"settings\":null,s?\"buffers\":null,n?\"wal\":null].filter(Boolean).join(\"|\"),l=null!==(o=this.headers.get(\"Accept\"))&&void 0!==o?o:\"application/json\";return this.headers.set(\"Accept\",`application/vnd.pgrst.plan+${i}; for=\"${l}\"; options=${a};`),this}rollback(){return this.headers.append(\"Prefer\",\"tx=rollback\"),this}returns(){return this}maxAffected(e){return this.headers.append(\"Prefer\",\"handling=strict\"),this.headers.append(\"Prefer\",`max-affected=${e}`),this}}t.default=n},819:(e,t)=>{function r(e){return e.endsWith(\"/\")?e:e+\"/\"}Object.defineProperty(t,\"__esModule\",{value:!0}),t.isBrowser=void 0,t.uuid=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return(\"x\"==e?t:3&t|8).toString(16)})},t.ensureTrailingSlash=r,t.applySettingDefaults=function(e,t){var r,s;const{db:n,auth:i,realtime:o,global:a}=e,{db:l,auth:c,realtime:u,global:h}=t,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:async()=>\"\"};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d},t.validateSupabaseUrl=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error(\"supabaseUrl is required.\");if(!t.match(/^https?:\\/\\//i))throw new Error(\"Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.\");try{return new URL(r(t))}catch(e){throw Error(\"Invalid supabaseUrl: Provided URL is malformed.\")}},t.isBrowser=()=>\"undefined\"!=typeof window},822:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.version=void 0,t.version=\"2.78.0\"},823:(e,t,r)=>{r.r(t),r.d(t,{__addDisposableResource:()=>N,__assign:()=>i,__asyncDelegator:()=>O,__asyncGenerator:()=>E,__asyncValues:()=>T,__await:()=>S,__awaiter:()=>p,__classPrivateFieldGet:()=>C,__classPrivateFieldIn:()=>$,__classPrivateFieldSet:()=>x,__createBinding:()=>w,__decorate:()=>a,__disposeResources:()=>D,__esDecorate:()=>c,__exportStar:()=>y,__extends:()=>n,__generator:()=>g,__importDefault:()=>R,__importStar:()=>I,__makeTemplateObject:()=>j,__metadata:()=>f,__param:()=>l,__propKey:()=>h,__read:()=>_,__rest:()=>o,__rewriteRelativeImportExtension:()=>L,__runInitializers:()=>u,__setFunctionName:()=>d,__spread:()=>b,__spreadArray:()=>k,__spreadArrays:()=>m,__values:()=>v,default:()=>B});var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},s(e,t)};function n(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Class extends value \"+String(t)+\" is not a constructor or null\");function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};function o(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}function a(e,t,r,s){var n,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,r,o):n(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function l(e,t){return function(r,s){t(r,s,e)}}function c(e,t,r,s,n,i){function o(e){if(void 0!==e&&\"function\"!=typeof e)throw new TypeError(\"Function expected\");return e}for(var a,l=s.kind,c=\"getter\"===l?\"get\":\"setter\"===l?\"set\":\"value\",u=!t&&e?s.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,s.name):{}),d=!1,f=r.length-1;f>=0;f--){var p={};for(var g in s)p[g]=\"access\"===g?{}:s[g];for(var g in s.access)p.access[g]=s.access[g];p.addInitializer=function(e){if(d)throw new TypeError(\"Cannot add initializers after decoration has completed\");i.push(o(e||null))};var w=(0,r[f])(\"accessor\"===l?{get:h.get,set:h.set}:h[c],p);if(\"accessor\"===l){if(void 0===w)continue;if(null===w||\"object\"!=typeof w)throw new TypeError(\"Object expected\");(a=o(w.get))&&(h.get=a),(a=o(w.set))&&(h.set=a),(a=o(w.init))&&n.unshift(a)}else(a=o(w))&&(\"field\"===l?n.unshift(a):h[c]=a)}u&&Object.defineProperty(u,s.name,h),d=!0}function u(e,t,r){for(var s=arguments.length>2,n=0;n<t.length;n++)r=s?t[n].call(e,r):t[n].call(e);return s?r:void 0}function h(e){return\"symbol\"==typeof e?e:\"\".concat(e)}function d(e,t,r){return\"symbol\"==typeof t&&(t=t.description?\"[\".concat(t.description,\"]\"):\"\"),Object.defineProperty(e,\"name\",{configurable:!0,value:r?\"\".concat(r,\" \",t):t})}function f(e,t){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function p(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})}function g(e,t){var r,s,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create((\"function\"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(r)throw new TypeError(\"Generator is already executing.\");for(;o&&(o=0,a[0]&&(i=0)),i;)try{if(r=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((n=(n=i.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}var w=Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!(\"get\"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]};function y(e,t){for(var r in e)\"default\"===r||Object.prototype.hasOwnProperty.call(t,r)||w(t,e,r)}function v(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}function _(e,t){var r=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e}function m(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var s=Array(e),n=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function k(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function S(e){return this instanceof S?(this.v=e,this):new S(e)}function E(e,t,r){if(!Symbol.asyncIterator)throw new TypeError(\"Symbol.asyncIterator is not defined.\");var s,n=r.apply(e,t||[]),i=[];return s=Object.create((\"function\"==typeof AsyncIterator?AsyncIterator:Object).prototype),o(\"next\"),o(\"throw\"),o(\"return\",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){n[e]&&(s[e]=function(t){return new Promise(function(r,s){i.push([e,t,r,s])>1||a(e,t)})},t&&(s[e]=t(s[e])))}function a(e,t){try{(r=n[e](t)).value instanceof S?Promise.resolve(r.value.v).then(l,c):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function l(e){a(\"next\",e)}function c(e){a(\"throw\",e)}function u(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function O(e){var t,r;return t={},s(\"next\"),s(\"throw\",function(e){throw e}),s(\"return\"),t[Symbol.iterator]=function(){return this},t;function s(s,n){t[s]=e[s]?function(t){return(r=!r)?{value:S(e[s](t)),done:!1}:n?n(t):t}:n}}function T(e){if(!Symbol.asyncIterator)throw new TypeError(\"Symbol.asyncIterator is not defined.\");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=v(e),t={},s(\"next\"),s(\"throw\"),s(\"return\"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,n){!function(e,t,r,s){Promise.resolve(s).then(function(t){e({value:t,done:r})},t)}(s,n,(t=e[r](t)).done,t.value)})}}}function j(e,t){return Object.defineProperty?Object.defineProperty(e,\"raw\",{value:t}):e.raw=t,e}var A=Object.create?function(e,t){Object.defineProperty(e,\"default\",{enumerable:!0,value:t})}:function(e,t){e.default=t},P=function(e){return P=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},P(e)};function I(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=P(e),s=0;s<r.length;s++)\"default\"!==r[s]&&w(t,e,r[s]);return A(t,e),t}function R(e){return e&&e.__esModule?e:{default:e}}function C(e,t,r,s){if(\"a\"===r&&!s)throw new TypeError(\"Private accessor was defined without a getter\");if(\"function\"==typeof t?e!==t||!s:!t.has(e))throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");return\"m\"===r?s:\"a\"===r?s.call(e):s?s.value:t.get(e)}function x(e,t,r,s,n){if(\"m\"===s)throw new TypeError(\"Private method is not writable\");if(\"a\"===s&&!n)throw new TypeError(\"Private accessor was defined without a setter\");if(\"function\"==typeof t?e!==t||!n:!t.has(e))throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");return\"a\"===s?n.call(e,r):n?n.value=r:t.set(e,r),r}function $(e,t){if(null===t||\"object\"!=typeof t&&\"function\"!=typeof t)throw new TypeError(\"Cannot use 'in' operator on non-object\");return\"function\"==typeof e?t===e:e.has(t)}function N(e,t,r){if(null!=t){if(\"object\"!=typeof t&&\"function\"!=typeof t)throw new TypeError(\"Object expected.\");var s,n;if(r){if(!Symbol.asyncDispose)throw new TypeError(\"Symbol.asyncDispose is not defined.\");s=t[Symbol.asyncDispose]}if(void 0===s){if(!Symbol.dispose)throw new TypeError(\"Symbol.dispose is not defined.\");s=t[Symbol.dispose],r&&(n=s)}if(\"function\"!=typeof s)throw new TypeError(\"Object not disposable.\");n&&(s=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:s,async:r})}else r&&e.stack.push({async:!0});return t}var U=\"function\"==typeof SuppressedError?SuppressedError:function(e,t,r){var s=new Error(r);return s.name=\"SuppressedError\",s.error=e,s.suppressed=t,s};function D(e){function t(t){e.error=e.hasError?new U(t,e.error,\"An error was suppressed during disposal.\"):t,e.hasError=!0}var r,s=0;return function n(){for(;r=e.stack.pop();)try{if(!r.async&&1===s)return s=0,e.stack.push(r),Promise.resolve().then(n);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(i).then(n,function(e){return t(e),n()})}else s|=1}catch(e){t(e)}if(1===s)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function L(e,t){return\"string\"==typeof e&&/^\\.\\.?\\//.test(e)?e.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i,function(e,r,s,n,i){return r?t?\".jsx\":\".js\":!s||n&&i?s+n+\".\"+i.toLowerCase()+\"js\":e}):e}const B={__extends:n,__assign:i,__rest:o,__decorate:a,__param:l,__esDecorate:c,__runInitializers:u,__propKey:h,__setFunctionName:d,__metadata:f,__awaiter:p,__generator:g,__createBinding:w,__exportStar:y,__values:v,__read:_,__spread:b,__spreadArrays:m,__spreadArray:k,__await:S,__asyncGenerator:E,__asyncDelegator:O,__asyncValues:T,__makeTemplateObject:j,__importStar:I,__importDefault:R,__classPrivateFieldGet:C,__classPrivateFieldSet:x,__classPrivateFieldIn:$,__addDisposableResource:N,__disposeResources:D,__rewriteRelativeImportExtension:L}},886:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:!0});class r extends Error{constructor(e){super(e.message),this.name=\"PostgrestError\",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=r},973:(e,t,r)=>{Object.defineProperty(t,\"__esModule\",{value:!0});const s=r(823).__importDefault(r(817)),n=new RegExp(\"[,()]\");class i extends s.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(\",\")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(\",\")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(\",\")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(\",\")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>\"string\"==typeof e&&n.test(e)?`\"${e}\"`:`${e}`).join(\",\");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return\"string\"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(\",\")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return\"string\"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(\",\")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return\"string\"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(\",\")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n=\"\";\"plain\"===s?n=\"pl\":\"phrase\"===s?n=\"ph\":\"websearch\"===s&&(n=\"w\");const i=void 0===r?\"\":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:\"or\";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}t.default=i}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}return r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(e){if(\"object\"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r(646)})());"
            },
            "3": {
              "id": 3,
              "type": "text",
              "content": "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n// Film CRM Chrome Extension - Side Panel\n// Uses Supabase for authentication and data storage\n\nconst SUPABASE_URL = 'https://hqefgtuczwjffuydjwmb.supabase.co';\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2ODQ0NjIsImV4cCI6MjA3MTI2MDQ2Mn0.14yQ9aRDZjTgN_esrmVtqycvLzKhRugJWGJxaf0r4AE';\n\nlet supabase;\nlet currentUser = null;\nlet currentWorkspaceId = null;\nlet currentTab = null;\nlet allTags = [];\nlet projects = [];\nlet genres = [];\n\n// Initialize Supabase client\nfunction initSupabase() {\n  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n}\n\n// Initialize app\nasync function init() {\n  initSupabase();\n\n  // Check for existing session\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (session) {\n    await handleAuthenticated(session.user);\n  } else {\n    showLogin();\n  }\n\n  // Setup event listeners\n  document.getElementById('login-btn').addEventListener('click', handleLogin);\n  document.getElementById('logout-link').addEventListener('click', handleLogout);\n  document.getElementById('quick-add-form').addEventListener('submit', handleSaveLink);\n\n  // Tag autocomplete\n  const tagInput = document.getElementById('link-tags');\n  tagInput.addEventListener('input', handleTagInput);\n  tagInput.addEventListener('blur', () => {\n    setTimeout(() => {\n      document.getElementById('tag-suggestions').classList.add('hidden');\n    }, 200);\n  });\n}\n\n// Show login view\nfunction showLogin() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.remove('hidden');\n  document.getElementById('main-view').classList.add('hidden');\n}\n\n// Show main view\nfunction showMain() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.add('hidden');\n  document.getElementById('main-view').classList.remove('hidden');\n}\n\n// Handle login\nasync function handleLogin() {\n  // Create a unique auth state for this login attempt\n  const authState = Math.random().toString(36).substring(7);\n  chrome.storage.local.set({ authState });\n\n  // Open the extension callback page directly (it has a login form)\n  const authUrl = `https://film-crm.vercel.app/extension-callback?state=${authState}`;\n\n  // Use window.open to open login popup\n  const authWindow = window.open(authUrl, '_blank', 'width=450,height=600');\n\n  if (!authWindow) {\n    showError('Please allow popups for this extension');\n    return;\n  }\n\n  // Listen for messages from the callback page\n  const messageListener = (request, sender, sendResponse) => {\n    if (request.type === 'EXTENSION_AUTH_SUCCESS' && request.state === authState) {\n      const { access_token, refresh_token } = request;\n\n      if (access_token) {\n        // Set the session in Supabase\n        supabase.auth.setSession({\n          access_token,\n          refresh_token\n        }).then(({ data: sessionData, error }) => {\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session');\n            return;\n          }\n\n          if (sessionData.user) {\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listener\n            chrome.runtime.onMessage.removeListener(messageListener);\n            // Update UI\n            handleAuthenticated(sessionData.user);\n          }\n        });\n      }\n    }\n  };\n\n  chrome.runtime.onMessage.addListener(messageListener);\n\n  // Also listen for postMessage from the popup window\n  const postMessageListener = async (event) => {\n    // Verify the message is from our domain\n    if (event.origin !== 'https://film-crm.vercel.app') return;\n\n    console.log('Received postMessage:', event.data);\n\n    if (event.data.type === 'EXTENSION_AUTH_SUCCESS' && event.data.state === authState) {\n      const { access_token, refresh_token } = event.data;\n\n      console.log('Auth success, setting session...', { hasAccessToken: !!access_token, hasRefreshToken: !!refresh_token });\n\n      if (access_token) {\n        try {\n          // Set the session in Supabase\n          const { data: sessionData, error } = await supabase.auth.setSession({\n            access_token,\n            refresh_token\n          });\n\n          console.log('Session set result:', { user: sessionData?.user?.email, error });\n\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session: ' + error.message);\n            return;\n          }\n\n          if (sessionData?.user) {\n            console.log('User authenticated:', sessionData.user.email);\n\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listeners\n            chrome.runtime.onMessage.removeListener(messageListener);\n            window.removeEventListener('message', postMessageListener);\n            clearInterval(checkClosed);\n            // Update UI\n            await handleAuthenticated(sessionData.user);\n          } else {\n            console.error('No user in session data');\n            showError('Authentication failed - no user data');\n          }\n        } catch (err) {\n          console.error('Exception during session setup:', err);\n          showError('Authentication error: ' + err.message);\n        }\n      }\n    }\n  };\n\n  window.addEventListener('message', postMessageListener);\n\n  // Check if window was closed before auth completed\n  const checkClosed = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(checkClosed);\n      chrome.runtime.onMessage.removeListener(messageListener);\n      window.removeEventListener('message', postMessageListener);\n    }\n  }, 1000);\n\n  // Clean up listeners after 5 minutes\n  setTimeout(() => {\n    clearInterval(checkClosed);\n    chrome.runtime.onMessage.removeListener(messageListener);\n    window.removeEventListener('message', postMessageListener);\n  }, 300000);\n}\n\n// Handle authenticated state\nasync function handleAuthenticated(user) {\n  currentUser = user;\n  document.getElementById('user-email').textContent = user.email;\n\n  // Get user's workspace\n  const { data: workspaces } = await supabase\n    .from('workspace_members')\n    .select('workspace_id')\n    .eq('user_id', user.id)\n    .limit(1)\n    .single();\n\n  if (workspaces) {\n    currentWorkspaceId = workspaces.workspace_id;\n    await loadReferenceData();\n    await loadCurrentTab();\n    showMain();\n  } else {\n    showError('No workspace found. Please create a workspace on the main site.');\n  }\n}\n\n// Load reference data (projects, genres, tags)\nasync function loadReferenceData() {\n  // Load projects\n  const { data: projectsData } = await supabase\n    .from('projects')\n    .select('id, title')\n    .eq('workspace_id', currentWorkspaceId)\n    .order('title');\n\n  projects = projectsData || [];\n\n  const projectSelect = document.getElementById('link-projects');\n  projectSelect.innerHTML = projects.length > 0\n    ? projects.map(p => `<option value=\"${p.id}\">${p.title}</option>`).join('')\n    : '<option value=\"\">No projects yet</option>';\n\n  // Load genres\n  const { data: genresData } = await supabase\n    .from('genres')\n    .select('id, name')\n    .order('name');\n\n  genres = genresData || [];\n\n  const genreSelect = document.getElementById('link-genres');\n  genreSelect.innerHTML = genres.length > 0\n    ? genres.map(g => `<option value=\"${g.id}\">${g.name}</option>`).join('')\n    : '<option value=\"\">No genres</option>';\n\n  // Load existing tags from links\n  const { data: linksData } = await supabase\n    .from('links')\n    .select('tags')\n    .eq('workspace_id', currentWorkspaceId);\n\n  const tagSet = new Set();\n  linksData?.forEach(link => {\n    link.tags?.forEach(tag => tagSet.add(tag.toLowerCase()));\n  });\n  allTags = Array.from(tagSet).sort();\n}\n\n// Load current tab info\nasync function loadCurrentTab() {\n  chrome.runtime.sendMessage({ action: 'getCurrentTab' }, async (response) => {\n    if (response) {\n      currentTab = response;\n      document.getElementById('current-url').textContent = response.url;\n\n      // Try to fetch metadata\n      try {\n        const metadata = await fetchLinkMetadata(response.url);\n        if (metadata.title) {\n          document.getElementById('link-title').value = metadata.title;\n        } else {\n          document.getElementById('link-title').value = response.title || '';\n        }\n      } catch (error) {\n        document.getElementById('link-title').value = response.title || '';\n      }\n    }\n  });\n}\n\n// Fetch link metadata from your API\nasync function fetchLinkMetadata(url) {\n  try {\n    const response = await fetch(`https://film-crm.vercel.app/api/fetch-link-metadata?url=${encodeURIComponent(url)}`);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching metadata:', error);\n    return { title: '', favicon_url: '' };\n  }\n}\n\n// Handle tag input for autocomplete\nfunction handleTagInput(e) {\n  const value = e.target.value;\n  const tags = value.split(',');\n  const currentTag = tags[tags.length - 1].trim().toLowerCase();\n\n  if (currentTag.length < 2) {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n    return;\n  }\n\n  const matches = allTags.filter(tag =>\n    tag.startsWith(currentTag) && tag !== currentTag\n  ).slice(0, 5);\n\n  if (matches.length > 0) {\n    const suggestionsDiv = document.getElementById('tag-suggestions');\n    suggestionsDiv.innerHTML = matches.map(tag =>\n      `<div class=\"tag-suggestion\" data-tag=\"${tag}\">${tag}</div>`\n    ).join('');\n\n    // Add click handlers\n    suggestionsDiv.querySelectorAll('.tag-suggestion').forEach(el => {\n      el.addEventListener('click', () => {\n        const selectedTag = el.dataset.tag;\n        const tags = value.split(',').map(t => t.trim()).filter(t => t);\n        tags[tags.length - 1] = selectedTag;\n        document.getElementById('link-tags').value = tags.join(', ') + ', ';\n        suggestionsDiv.classList.add('hidden');\n      });\n    });\n\n    suggestionsDiv.classList.remove('hidden');\n  } else {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n  }\n}\n\n// Handle save link\nasync function handleSaveLink(e) {\n  e.preventDefault();\n\n  if (!currentTab || !currentWorkspaceId) {\n    showError('Missing required data. Please refresh the extension.');\n    return;\n  }\n\n  const saveBtn = document.getElementById('save-btn');\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Saving...';\n\n  try {\n    const title = document.getElementById('link-title').value.trim();\n    const tagsInput = document.getElementById('link-tags').value;\n    const tags = tagsInput\n      .split(',')\n      .map(t => t.trim().toLowerCase())\n      .filter(t => t.length > 0);\n\n    const selectedProjects = Array.from(document.getElementById('link-projects').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    const selectedGenres = Array.from(document.getElementById('link-genres').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    // Fetch metadata again to get favicon\n    const metadata = await fetchLinkMetadata(currentTab.url);\n\n    // Insert link\n    const { data: link, error: linkError } = await supabase\n      .from('links')\n      .insert({\n        workspace_id: currentWorkspaceId,\n        url: currentTab.url,\n        title: title || currentTab.title,\n        tags: tags.length > 0 ? tags : null,\n        favicon_url: metadata.favicon_url || currentTab.favIconUrl || null\n      })\n      .select()\n      .single();\n\n    if (linkError) throw linkError;\n\n    // Add project associations\n    if (selectedProjects.length > 0) {\n      const projectLinks = selectedProjects.map(projectId => ({\n        link_id: link.id,\n        project_id: projectId\n      }));\n\n      const { error: projectError } = await supabase\n        .from('project_links')\n        .insert(projectLinks);\n\n      if (projectError) console.error('Error adding project links:', projectError);\n    }\n\n    // Add genre associations\n    if (selectedGenres.length > 0) {\n      const genreLinks = selectedGenres.map(genreId => ({\n        link_id: link.id,\n        genre_id: genreId\n      }));\n\n      const { error: genreError } = await supabase\n        .from('link_genres')\n        .insert(genreLinks);\n\n      if (genreError) console.error('Error adding genre links:', genreError);\n    }\n\n    showSuccess('Link saved successfully!');\n\n    // Reset form\n    document.getElementById('link-tags').value = '';\n    document.getElementById('link-projects').selectedIndex = -1;\n    document.getElementById('link-genres').selectedIndex = -1;\n\n    // Reload current tab to get new URL if navigated\n    setTimeout(() => {\n      loadCurrentTab();\n    }, 2000);\n\n  } catch (error) {\n    console.error('Error saving link:', error);\n    showError('Failed to save link: ' + error.message);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Save Link';\n  }\n}\n\n// Handle logout\nasync function handleLogout() {\n  await supabase.auth.signOut();\n  currentUser = null;\n  currentWorkspaceId = null;\n  showLogin();\n}\n\n// Show success message\nfunction showSuccess(message) {\n  const successDiv = document.getElementById('success-message');\n  successDiv.textContent = message;\n  successDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    successDiv.classList.add('hidden');\n  }, 3000);\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('error-message');\n  errorDiv.textContent = message;\n  errorDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    errorDiv.classList.add('hidden');\n  }, 5000);\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n "
            },
            "4": {
              "id": 4,
              "type": "text",
              "content": "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n// Film CRM Chrome Extension - Side Panel\n// Uses Supabase for authentication and data storage\n\nconst SUPABASE_URL = 'https://hqefgtuczwjffuydjwmb.supabase.co';\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2ODQ0NjIsImV4cCI6MjA3MTI2MDQ2Mn0.14yQ9aRDZjTgN_esrmVtqycvLzKhRugJWGJxaf0r4AE';\n\nlet supabase;\nlet currentUser = null;\nlet currentWorkspaceId = null;\nlet currentTab = null;\nlet allTags = [];\nlet projects = [];\nlet genres = [];\n\n// Initialize Supabase client\nfunction initSupabase() {\n  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n}\n\n// Initialize app\nasync function init() {\n  initSupabase();\n\n  // Check for existing session\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (session) {\n    await handleAuthenticated(session.user);\n  } else {\n    showLogin();\n  }\n\n  // Setup event listeners\n  document.getElementById('login-btn').addEventListener('click', handleLogin);\n  document.getElementById('logout-link').addEventListener('click', handleLogout);\n  document.getElementById('quick-add-form').addEventListener('submit', handleSaveLink);\n\n  // Tag autocomplete\n  const tagInput = document.getElementById('link-tags');\n  tagInput.addEventListener('input', handleTagInput);\n  tagInput.addEventListener('blur', () => {\n    setTimeout(() => {\n      document.getElementById('tag-suggestions').classList.add('hidden');\n    }, 200);\n  });\n}\n\n// Show login view\nfunction showLogin() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.remove('hidden');\n  document.getElementById('main-view').classList.add('hidden');\n}\n\n// Show main view\nfunction showMain() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.add('hidden');\n  document.getElementById('main-view').classList.remove('hidden');\n}\n\n// Handle login\nasync function handleLogin() {\n  // Create a unique auth state for this login attempt\n  const authState = Math.random().toString(36).substring(7);\n  chrome.storage.local.set({ authState });\n\n  // Open the extension callback page directly (it has a login form)\n  const authUrl = `https://film-crm.vercel.app/extension-callback?state=${authState}`;\n\n  // Use window.open to open login popup\n  const authWindow = window.open(authUrl, '_blank', 'width=450,height=600');\n\n  if (!authWindow) {\n    showError('Please allow popups for this extension');\n    return;\n  }\n\n  // Listen for messages from the callback page\n  const messageListener = (request, sender, sendResponse) => {\n    if (request.type === 'EXTENSION_AUTH_SUCCESS' && request.state === authState) {\n      const { access_token, refresh_token } = request;\n\n      if (access_token) {\n        // Set the session in Supabase\n        supabase.auth.setSession({\n          access_token,\n          refresh_token\n        }).then(({ data: sessionData, error }) => {\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session');\n            return;\n          }\n\n          if (sessionData.user) {\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listener\n            chrome.runtime.onMessage.removeListener(messageListener);\n            // Update UI\n            handleAuthenticated(sessionData.user);\n          }\n        });\n      }\n    }\n  };\n\n  chrome.runtime.onMessage.addListener(messageListener);\n\n  // Also listen for postMessage from the popup window\n  const postMessageListener = async (event) => {\n    // Verify the message is from our domain\n    if (event.origin !== 'https://film-crm.vercel.app') return;\n\n    console.log('Received postMessage:', event.data);\n\n    if (event.data.type === 'EXTENSION_AUTH_SUCCESS' && event.data.state === authState) {\n      const { access_token, refresh_token } = event.data;\n\n      console.log('Auth success, setting session...', { hasAccessToken: !!access_token, hasRefreshToken: !!refresh_token });\n\n      if (access_token) {\n        try {\n          // Set the session in Supabase\n          const { data: sessionData, error } = await supabase.auth.setSession({\n            access_token,\n            refresh_token\n          });\n\n          console.log('Session set result:', { user: sessionData?.user?.email, error });\n\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session: ' + error.message);\n            return;\n          }\n\n          if (sessionData?.user) {\n            console.log('User authenticated:', sessionData.user.email);\n\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listeners\n            chrome.runtime.onMessage.removeListener(messageListener);\n            window.removeEventListener('message', postMessageListener);\n            clearInterval(checkClosed);\n            // Update UI\n            await handleAuthenticated(sessionData.user);\n          } else {\n            console.error('No user in session data');\n            showError('Authentication failed - no user data');\n          }\n        } catch (err) {\n          console.error('Exception during session setup:', err);\n          showError('Authentication error: ' + err.message);\n        }\n      }\n    }\n  };\n\n  window.addEventListener('message', postMessageListener);\n\n  // Check if window was closed before auth completed\n  const checkClosed = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(checkClosed);\n      chrome.runtime.onMessage.removeListener(messageListener);\n      window.removeEventListener('message', postMessageListener);\n    }\n  }, 1000);\n\n  // Clean up listeners after 5 minutes\n  setTimeout(() => {\n    clearInterval(checkClosed);\n    chrome.runtime.onMessage.removeListener(messageListener);\n    window.removeEventListener('message', postMessageListener);\n  }, 300000);\n}\n\n// Handle authenticated state\nasync function handleAuthenticated(user) {\n  currentUser = user;\n  document.getElementById('user-email').textContent = user.email;\n\n  // Get user's workspace\n  const { data: workspaces } = await supabase\n    .from('workspace_members')\n    .select('workspace_id')\n    .eq('user_id', user.id)\n    .limit(1)\n    .single();\n\n  if (workspaces) {\n    currentWorkspaceId = workspaces.workspace_id;\n    await loadReferenceData();\n    await loadCurrentTab();\n    showMain();\n  } else {\n    showError('No workspace found. Please create a workspace on the main site.');\n  }\n}\n\n// Load reference data (projects, genres, tags)\nasync function loadReferenceData() {\n  // Load projects\n  const { data: projectsData } = await supabase\n    .from('projects')\n    .select('id, title')\n    .eq('workspace_id', currentWorkspaceId)\n    .order('title');\n\n  projects = projectsData || [];\n\n  const projectSelect = document.getElementById('link-projects');\n  projectSelect.innerHTML = projects.length > 0\n    ? projects.map(p => `<option value=\"${p.id}\">${p.title}</option>`).join('')\n    : '<option value=\"\">No projects yet</option>';\n\n  // Load genres\n  const { data: genresData } = await supabase\n    .from('genres')\n    .select('id, name')\n    .order('name');\n\n  genres = genresData || [];\n\n  const genreSelect = document.getElementById('link-genres');\n  genreSelect.innerHTML = genres.length > 0\n    ? genres.map(g => `<option value=\"${g.id}\">${g.name}</option>`).join('')\n    : '<option value=\"\">No genres</option>';\n\n  // Load existing tags from links\n  const { data: linksData } = await supabase\n    .from('links')\n    .select('tags')\n    .eq('workspace_id', currentWorkspaceId);\n\n  const tagSet = new Set();\n  linksData?.forEach(link => {\n    link.tags?.forEach(tag => tagSet.add(tag.toLowerCase()));\n  });\n  allTags = Array.from(tagSet).sort();\n}\n\n// Load current tab info\nasync function loadCurrentTab() {\n  chrome.runtime.sendMessage({ action: 'getCurrentTab' }, async (response) => {\n    if (response) {\n      currentTab = response;\n      document.getElementById('current-url').textContent = response.url;\n\n      // Try to fetch metadata\n      try {\n        const metadata = await fetchLinkMetadata(response.url);\n        if (metadata.title) {\n          document.getElementById('link-title').value = metadata.title;\n        } else {\n          document.getElementById('link-title').value = response.title || '';\n        }\n      } catch (error) {\n        document.getElementById('link-title').value = response.title || '';\n      }\n    }\n  });\n}\n\n// Fetch link metadata from your API\nasync function fetchLinkMetadata(url) {\n  try {\n    const response = await fetch(`https://film-crm.vercel.app/api/fetch-link-metadata?url=${encodeURIComponent(url)}`);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching metadata:', error);\n    return { title: '', favicon_url: '' };\n  }\n}\n\n// Handle tag input for autocomplete\nfunction handleTagInput(e) {\n  const value = e.target.value;\n  const tags = value.split(',');\n  const currentTag = tags[tags.length - 1].trim().toLowerCase();\n\n  if (currentTag.length < 2) {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n    return;\n  }\n\n  const matches = allTags.filter(tag =>\n    tag.startsWith(currentTag) && tag !== currentTag\n  ).slice(0, 5);\n\n  if (matches.length > 0) {\n    const suggestionsDiv = document.getElementById('tag-suggestions');\n    suggestionsDiv.innerHTML = matches.map(tag =>\n      `<div class=\"tag-suggestion\" data-tag=\"${tag}\">${tag}</div>`\n    ).join('');\n\n    // Add click handlers\n    suggestionsDiv.querySelectorAll('.tag-suggestion').forEach(el => {\n      el.addEventListener('click', () => {\n        const selectedTag = el.dataset.tag;\n        const tags = value.split(',').map(t => t.trim()).filter(t => t);\n        tags[tags.length - 1] = selectedTag;\n        document.getElementById('link-tags').value = tags.join(', ') + ', ';\n        suggestionsDiv.classList.add('hidden');\n      });\n    });\n\n    suggestionsDiv.classList.remove('hidden');\n  } else {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n  }\n}\n\n// Handle save link\nasync function handleSaveLink(e) {\n  e.preventDefault();\n\n  if (!currentTab || !currentWorkspaceId) {\n    showError('Missing required data. Please refresh the extension.');\n    return;\n  }\n\n  const saveBtn = document.getElementById('save-btn');\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Saving...';\n\n  try {\n    const title = document.getElementById('link-title').value.trim();\n    const tagsInput = document.getElementById('link-tags').value;\n    const tags = tagsInput\n      .split(',')\n      .map(t => t.trim().toLowerCase())\n      .filter(t => t.length > 0);\n\n    const selectedProjects = Array.from(document.getElementById('link-projects').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    const selectedGenres = Array.from(document.getElementById('link-genres').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    // Fetch metadata again to get favicon\n    const metadata = await fetchLinkMetadata(currentTab.url);\n\n    // Insert link\n    const { data: link, error: linkError } = await supabase\n      .from('links')\n      .insert({\n        workspace_id: currentWorkspaceId,\n        url: currentTab.url,\n        title: title || currentTab.title,\n        tags: tags.length > 0 ? tags : null,\n        favicon_url: metadata.favicon_url || currentTab.favIconUrl || null\n      })\n      .select()\n      .single();\n\n    if (linkError) throw linkError;\n\n    // Add project associations\n    if (selectedProjects.length > 0) {\n      const projectLinks = selectedProjects.map(projectId => ({\n        link_id: link.id,\n        project_id: projectId\n      }));\n\n      const { error: projectError } = await supabase\n        .from('project_links')\n        .insert(projectLinks);\n\n      if (projectError) console.error('Error adding project links:', projectError);\n    }\n\n    // Add genre associations\n    if (selectedGenres.length > 0) {\n      const genreLinks = selectedGenres.map(genreId => ({\n        link_id: link.id,\n        genre_id: genreId\n      }));\n\n      const { error: genreError } = await supabase\n        .from('link_genres')\n        .insert(genreLinks);\n\n      if (genreError) console.error('Error adding genre links:', genreError);\n    }\n\n    showSuccess('Link saved successfully!');\n\n    // Reset form\n    document.getElementById('link-tags').value = '';\n    document.getElementById('link-projects').selectedIndex = -1;\n    document.getElementById('link-genres').selectedIndex = -1;\n\n    // Reload current tab to get new URL if navigated\n    setTimeout(() => {\n      loadCurrentTab();\n    }, 2000);\n\n  } catch (error) {\n    console.error('Error saving link:', error);\n    showError('Failed to save link: ' + error.message);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Save Link';\n  }\n}\n\n// Handle logout\nasync function handleLogout() {\n  await supabase.auth.signOut();\n  currentUser = null;\n  currentWorkspaceId = null;\n  showLogin();\n}\n\n// Show success message\nfunction showSuccess(message) {\n  const successDiv = document.getElementById('success-message');\n  successDiv.textContent = message;\n  successDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    successDiv.classList.add('hidden');\n  }, 3000);\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('error-message');\n  errorDiv.textContent = message;\n  errorDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    errorDiv.classList.add('hidden');\n  }, 5000);\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n "
            }
          }
        },
        {
          "display": "It's still not working and chrome says the extension has a number of errors. STACK TRACE: [Pasted text #1 +454 lines]. I'll send the others after you've looked at this one.",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "// Film CRM Chrome Extension - Side Panel\n// Uses Supabase for authentication and data storage\n\nconst SUPABASE_URL = 'https://hqefgtuczwjffuydjwmb.supabase.co';\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2ODQ0NjIsImV4cCI6MjA3MTI2MDQ2Mn0.14yQ9aRDZjTgN_esrmVtqycvLzKhRugJWGJxaf0r4AE';\n\nlet supabase;\nlet currentUser = null;\nlet currentWorkspaceId = null;\nlet currentTab = null;\nlet allTags = [];\nlet projects = [];\nlet genres = [];\n\n// Initialize Supabase client\nfunction initSupabase() {\n  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n}\n\n// Initialize app\nasync function init() {\n  initSupabase();\n\n  // Check for existing session\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (session) {\n    await handleAuthenticated(session.user);\n  } else {\n    showLogin();\n  }\n\n  // Setup event listeners\n  document.getElementById('login-btn').addEventListener('click', handleLogin);\n  document.getElementById('logout-link').addEventListener('click', handleLogout);\n  document.getElementById('quick-add-form').addEventListener('submit', handleSaveLink);\n\n  // Tag autocomplete\n  const tagInput = document.getElementById('link-tags');\n  tagInput.addEventListener('input', handleTagInput);\n  tagInput.addEventListener('blur', () => {\n    setTimeout(() => {\n      document.getElementById('tag-suggestions').classList.add('hidden');\n    }, 200);\n  });\n}\n\n// Show login view\nfunction showLogin() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.remove('hidden');\n  document.getElementById('main-view').classList.add('hidden');\n}\n\n// Show main view\nfunction showMain() {\n  document.getElementById('loading').classList.add('hidden');\n  document.getElementById('login-view').classList.add('hidden');\n  document.getElementById('main-view').classList.remove('hidden');\n}\n\n// Handle login\nasync function handleLogin() {\n  // Create a unique auth state for this login attempt\n  const authState = Math.random().toString(36).substring(7);\n  chrome.storage.local.set({ authState });\n\n  // Open the extension callback page directly (it has a login form)\n  const authUrl = `https://film-crm.vercel.app/extension-callback?state=${authState}`;\n\n  // Use window.open to open login popup\n  const authWindow = window.open(authUrl, '_blank', 'width=450,height=600');\n\n  if (!authWindow) {\n    showError('Please allow popups for this extension');\n    return;\n  }\n\n  // Listen for messages from the callback page\n  const messageListener = (request, sender, sendResponse) => {\n    if (request.type === 'EXTENSION_AUTH_SUCCESS' && request.state === authState) {\n      const { access_token, refresh_token } = request;\n\n      if (access_token) {\n        // Set the session in Supabase\n        supabase.auth.setSession({\n          access_token,\n          refresh_token\n        }).then(({ data: sessionData, error }) => {\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session');\n            return;\n          }\n\n          if (sessionData.user) {\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listener\n            chrome.runtime.onMessage.removeListener(messageListener);\n            // Update UI\n            handleAuthenticated(sessionData.user);\n          }\n        });\n      }\n    }\n  };\n\n  chrome.runtime.onMessage.addListener(messageListener);\n\n  // Also listen for postMessage from the popup window\n  const postMessageListener = async (event) => {\n    // Verify the message is from our domain\n    if (event.origin !== 'https://film-crm.vercel.app') return;\n\n    console.log('Received postMessage:', event.data);\n\n    if (event.data.type === 'EXTENSION_AUTH_SUCCESS' && event.data.state === authState) {\n      const { access_token, refresh_token } = event.data;\n\n      console.log('Auth success, setting session...', { hasAccessToken: !!access_token, hasRefreshToken: !!refresh_token });\n\n      if (access_token) {\n        try {\n          // Set the session in Supabase\n          const { data: sessionData, error } = await supabase.auth.setSession({\n            access_token,\n            refresh_token\n          });\n\n          console.log('Session set result:', { user: sessionData?.user?.email, error });\n\n          if (error) {\n            console.error('Session error:', error);\n            showError('Failed to establish session: ' + error.message);\n            return;\n          }\n\n          if (sessionData?.user) {\n            console.log('User authenticated:', sessionData.user.email);\n\n            // Close the auth window\n            if (authWindow && !authWindow.closed) {\n              authWindow.close();\n            }\n            // Remove listeners\n            chrome.runtime.onMessage.removeListener(messageListener);\n            window.removeEventListener('message', postMessageListener);\n            clearInterval(checkClosed);\n            // Update UI\n            await handleAuthenticated(sessionData.user);\n          } else {\n            console.error('No user in session data');\n            showError('Authentication failed - no user data');\n          }\n        } catch (err) {\n          console.error('Exception during session setup:', err);\n          showError('Authentication error: ' + err.message);\n        }\n      }\n    }\n  };\n\n  window.addEventListener('message', postMessageListener);\n\n  // Check if window was closed before auth completed\n  const checkClosed = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(checkClosed);\n      chrome.runtime.onMessage.removeListener(messageListener);\n      window.removeEventListener('message', postMessageListener);\n    }\n  }, 1000);\n\n  // Clean up listeners after 5 minutes\n  setTimeout(() => {\n    clearInterval(checkClosed);\n    chrome.runtime.onMessage.removeListener(messageListener);\n    window.removeEventListener('message', postMessageListener);\n  }, 300000);\n}\n\n// Handle authenticated state\nasync function handleAuthenticated(user) {\n  currentUser = user;\n  document.getElementById('user-email').textContent = user.email;\n\n  // Get user's workspace\n  const { data: workspaces } = await supabase\n    .from('workspace_members')\n    .select('workspace_id')\n    .eq('user_id', user.id)\n    .limit(1)\n    .single();\n\n  if (workspaces) {\n    currentWorkspaceId = workspaces.workspace_id;\n    await loadReferenceData();\n    await loadCurrentTab();\n    showMain();\n  } else {\n    showError('No workspace found. Please create a workspace on the main site.');\n  }\n}\n\n// Load reference data (projects, genres, tags)\nasync function loadReferenceData() {\n  // Load projects\n  const { data: projectsData } = await supabase\n    .from('projects')\n    .select('id, title')\n    .eq('workspace_id', currentWorkspaceId)\n    .order('title');\n\n  projects = projectsData || [];\n\n  const projectSelect = document.getElementById('link-projects');\n  projectSelect.innerHTML = projects.length > 0\n    ? projects.map(p => `<option value=\"${p.id}\">${p.title}</option>`).join('')\n    : '<option value=\"\">No projects yet</option>';\n\n  // Load genres\n  const { data: genresData } = await supabase\n    .from('genres')\n    .select('id, name')\n    .order('name');\n\n  genres = genresData || [];\n\n  const genreSelect = document.getElementById('link-genres');\n  genreSelect.innerHTML = genres.length > 0\n    ? genres.map(g => `<option value=\"${g.id}\">${g.name}</option>`).join('')\n    : '<option value=\"\">No genres</option>';\n\n  // Load existing tags from links\n  const { data: linksData } = await supabase\n    .from('links')\n    .select('tags')\n    .eq('workspace_id', currentWorkspaceId);\n\n  const tagSet = new Set();\n  linksData?.forEach(link => {\n    link.tags?.forEach(tag => tagSet.add(tag.toLowerCase()));\n  });\n  allTags = Array.from(tagSet).sort();\n}\n\n// Load current tab info\nasync function loadCurrentTab() {\n  chrome.runtime.sendMessage({ action: 'getCurrentTab' }, async (response) => {\n    if (response) {\n      currentTab = response;\n      document.getElementById('current-url').textContent = response.url;\n\n      // Try to fetch metadata\n      try {\n        const metadata = await fetchLinkMetadata(response.url);\n        if (metadata.title) {\n          document.getElementById('link-title').value = metadata.title;\n        } else {\n          document.getElementById('link-title').value = response.title || '';\n        }\n      } catch (error) {\n        document.getElementById('link-title').value = response.title || '';\n      }\n    }\n  });\n}\n\n// Fetch link metadata from your API\nasync function fetchLinkMetadata(url) {\n  try {\n    const response = await fetch(`https://film-crm.vercel.app/api/fetch-link-metadata?url=${encodeURIComponent(url)}`);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching metadata:', error);\n    return { title: '', favicon_url: '' };\n  }\n}\n\n// Handle tag input for autocomplete\nfunction handleTagInput(e) {\n  const value = e.target.value;\n  const tags = value.split(',');\n  const currentTag = tags[tags.length - 1].trim().toLowerCase();\n\n  if (currentTag.length < 2) {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n    return;\n  }\n\n  const matches = allTags.filter(tag =>\n    tag.startsWith(currentTag) && tag !== currentTag\n  ).slice(0, 5);\n\n  if (matches.length > 0) {\n    const suggestionsDiv = document.getElementById('tag-suggestions');\n    suggestionsDiv.innerHTML = matches.map(tag =>\n      `<div class=\"tag-suggestion\" data-tag=\"${tag}\">${tag}</div>`\n    ).join('');\n\n    // Add click handlers\n    suggestionsDiv.querySelectorAll('.tag-suggestion').forEach(el => {\n      el.addEventListener('click', () => {\n        const selectedTag = el.dataset.tag;\n        const tags = value.split(',').map(t => t.trim()).filter(t => t);\n        tags[tags.length - 1] = selectedTag;\n        document.getElementById('link-tags').value = tags.join(', ') + ', ';\n        suggestionsDiv.classList.add('hidden');\n      });\n    });\n\n    suggestionsDiv.classList.remove('hidden');\n  } else {\n    document.getElementById('tag-suggestions').classList.add('hidden');\n  }\n}\n\n// Handle save link\nasync function handleSaveLink(e) {\n  e.preventDefault();\n\n  if (!currentTab || !currentWorkspaceId) {\n    showError('Missing required data. Please refresh the extension.');\n    return;\n  }\n\n  const saveBtn = document.getElementById('save-btn');\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Saving...';\n\n  try {\n    const title = document.getElementById('link-title').value.trim();\n    const tagsInput = document.getElementById('link-tags').value;\n    const tags = tagsInput\n      .split(',')\n      .map(t => t.trim().toLowerCase())\n      .filter(t => t.length > 0);\n\n    const selectedProjects = Array.from(document.getElementById('link-projects').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    const selectedGenres = Array.from(document.getElementById('link-genres').selectedOptions)\n      .map(opt => opt.value)\n      .filter(id => id);\n\n    // Fetch metadata again to get favicon\n    const metadata = await fetchLinkMetadata(currentTab.url);\n\n    // Insert link\n    const { data: link, error: linkError } = await supabase\n      .from('links')\n      .insert({\n        workspace_id: currentWorkspaceId,\n        url: currentTab.url,\n        title: title || currentTab.title,\n        tags: tags.length > 0 ? tags : null,\n        favicon_url: metadata.favicon_url || currentTab.favIconUrl || null\n      })\n      .select()\n      .single();\n\n    if (linkError) throw linkError;\n\n    // Add project associations\n    if (selectedProjects.length > 0) {\n      const projectLinks = selectedProjects.map(projectId => ({\n        link_id: link.id,\n        project_id: projectId\n      }));\n\n      const { error: projectError } = await supabase\n        .from('project_links')\n        .insert(projectLinks);\n\n      if (projectError) console.error('Error adding project links:', projectError);\n    }\n\n    // Add genre associations\n    if (selectedGenres.length > 0) {\n      const genreLinks = selectedGenres.map(genreId => ({\n        link_id: link.id,\n        genre_id: genreId\n      }));\n\n      const { error: genreError } = await supabase\n        .from('link_genres')\n        .insert(genreLinks);\n\n      if (genreError) console.error('Error adding genre links:', genreError);\n    }\n\n    showSuccess('Link saved successfully!');\n\n    // Reset form\n    document.getElementById('link-tags').value = '';\n    document.getElementById('link-projects').selectedIndex = -1;\n    document.getElementById('link-genres').selectedIndex = -1;\n\n    // Reload current tab to get new URL if navigated\n    setTimeout(() => {\n      loadCurrentTab();\n    }, 2000);\n\n  } catch (error) {\n    console.error('Error saving link:', error);\n    showError('Failed to save link: ' + error.message);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Save Link';\n  }\n}\n\n// Handle logout\nasync function handleLogout() {\n  await supabase.auth.signOut();\n  currentUser = null;\n  currentWorkspaceId = null;\n  showLogin();\n}\n\n// Show success message\nfunction showSuccess(message) {\n  const successDiv = document.getElementById('success-message');\n  successDiv.textContent = message;\n  successDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    successDiv.classList.add('hidden');\n  }, 3000);\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('error-message');\n  errorDiv.textContent = message;\n  errorDiv.classList.remove('hidden');\n\n  setTimeout(() => {\n    errorDiv.classList.add('hidden');\n  }, 5000);\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n"
            }
          }
        },
        {
          "display": "can you read claude.md to get a sense of the site we've been building together. We have just been working on a chrome extension to allow Users to quickly add url links and connect them to their projects/tags/genres on their main account. you can find the extension at keith/chrome-extension. We were working on an issue where the extension wasn't logging in. If i click the login button it would bring up a popup saying the activation was successful but the extension still wouldnt login. You crashed so this info wont be in the claude.md. You asked me to get the console log for the extension. so here it is: [Pasted text #1 +19 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Received postMessage: Objectaccess_token: \"eyJhbGciOiJIUzI1NiIsImtpZCI6IlE4UldXYTh3Smo5Q25jdEoiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2hxZWZndHVjendqZmZ1eWRqd21iLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiIwNDI0ODJmMi05Y2ZkLTQ0OTUtOWI1Ni04MmM2MmQ3ZGVmYWQiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzYyMDQwNzM1LCJpYXQiOjE3NjIwMzcxMzUsImVtYWlsIjoia2VpdGhAYXJlY2lib21lZGlhLmNvbSIsInBob25lIjoiIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiXX0sInVzZXJfbWV0YWRhdGEiOnsiZW1haWwiOiJrZWl0aEBhcmVjaWJvbWVkaWEuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBob25lX3ZlcmlmaWVkIjpmYWxzZSwic3ViIjoiMDQyNDgyZjItOWNmZC00NDk1LTliNTYtODJjNjJkN2RlZmFkIn0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMSIsImFtciI6W3sibWV0aG9kIjoicGFzc3dvcmQiLCJ0aW1lc3RhbXAiOjE3NjIwMzcxMzV9XSwic2Vzc2lvbl9pZCI6ImQ1YmRlNjczLTk0YjYtNGUzNi1iYjVhLWFjOGMwZTIzMzcwMyIsImlzX2Fub255bW91cyI6ZmFsc2V9.YpzJ-6H9p--yiHsyfp3H6zOf9PLu-uxyg_FdMYmaCRk\"refresh_token: \"ba55xojvr2hh\"state: \"awy4fu\"type: \"EXTENSION_AUTH_SUCCESS\"[[Prototype]]: Objectconstructor: ƒ Object()hasOwnProperty: ƒ hasOwnProperty()isPrototypeOf: ƒ isPrototypeOf()propertyIsEnumerable: ƒ propertyIsEnumerable()toLocaleString: ƒ toLocaleString()toString: ƒ toString()valueOf: ƒ valueOf()__defineGetter__: ƒ __defineGetter__()__defineSetter__: ƒ __defineSetter__()__lookupGetter__: ƒ __lookupGetter__()__lookupSetter__: ƒ __lookupSetter__()__proto__: (...)get __proto__: ƒ __proto__()set __proto__: ƒ __proto__()\nsidepanel.js:123 Auth success, setting session... ObjecthasAccessToken: truehasRefreshToken: true[[Prototype]]: Objectconstructor: ƒ Object()hasOwnProperty: ƒ hasOwnProperty()isPrototypeOf: ƒ isPrototypeOf()propertyIsEnumerable: ƒ propertyIsEnumerable()toLocaleString: ƒ toLocaleString()toString: ƒ toString()valueOf: ƒ valueOf()__defineGetter__: ƒ __defineGetter__()__defineSetter__: ƒ __defineSetter__()__lookupGetter__: ƒ __lookupGetter__()__lookupSetter__: ƒ __lookupSetter__()__proto__: (...)get __proto__: ƒ __proto__()set __proto__: ƒ __proto__()\nzflxnfhqgzmfkpcilzqm.supabase.co/auth/v1/user:1  Failed to load resource: net::ERR_NAME_NOT_RESOLVEDUnderstand this error\nsupabase.js:7 TypeError: Failed to fetch\n    at e.166.q (supabase.js:7:9167)\n    at u.headers (supabase.js:7:13928)\n    at se (supabase.js:7:14109)\n    at n._getUser (supabase.js:7:61638)\n    at n._setSession (supabase.js:7:63597)\n    at supabase.js:7:63183\n    at supabase.js:7:59042\n    at supabase.js:7:22712\nu.headers @ supabase.js:7Understand this error\nsidepanel.js:133 Session set result: Object\nsidepanel.js:136 Session error: AuthRetryableFetchError: Failed to fetch\n    at u.headers (supabase.js:7:13985)\n    at async se (supabase.js:7:13603)\n    at async n._getUser (supabase.js:7:61632)\n    at async n._setSession (supabase.js:7:63586)\n    at async supabase.js:7:63172"
            }
          }
        },
        {
          "display": "so now when i click on Log In, a popup appears and tells me authentication was successful and then closes the window but nothing changes on the extension side panel. All i can do is click the login button again",
          "pastedContents": {}
        },
        {
          "display": "that brought up a popup login window. i entered my details and then got this error: Error in invocation of runtime.sendMessage(optional string extensionId, any message, optional object options, optional function callback): chrome.runtime.sendMessage() called from a webpage must specify an Extension ID (string) for its first argument.",
          "pastedContents": {}
        },
        {
          "display": "The popup opens and comes up with this error: Authentication Required\nNo active session found. Please click the button below to authenticate. - but now there's a login button. I click that, the window reloads but i'm still seeing the same error",
          "pastedContents": {}
        },
        {
          "display": "The smaller popup window appeared but I'm still getting the same error: No active session found. Please log in first, then try again.",
          "pastedContents": {}
        },
        {
          "display": "this time it took me to the 'extension-callback' page but i got an error: No Active Session found. Please log in first'. But i load my site in another tab, i am still logged in",
          "pastedContents": {}
        },
        {
          "display": "I'm getting this Build Error in Vercel: [Pasted text #1 +36 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "22:34:17.871 Running build in Washington, D.C., USA (East) – iad1\n22:34:17.871 Build machine configuration: 2 cores, 8 GB\n22:34:18.011 Cloning github.com/keithlynch81/film-crm (Branch: main, Commit: 9d03a5d)\n22:34:18.708 Cloning completed: 697.000ms\n22:34:19.044 Restored build cache from previous deployment (79TSHNtwJcoPPBgT6DNWuDGpYmJR)\n22:34:19.550 Running \"vercel build\"\n22:34:20.449 Vercel CLI 48.8.0\n22:34:20.971 Installing dependencies...\n22:34:22.505 \n22:34:22.506 up to date in 1s\n22:34:22.506 \n22:34:22.506 128 packages are looking for funding\n22:34:22.507   run `npm fund` for details\n22:34:22.536 Detected Next.js version: 14.0.4\n22:34:22.541 Running \"npm run build\"\n22:34:22.651 \n22:34:22.651 > film-crm@0.1.0 build\n22:34:22.651 > next build\n22:34:22.651 \n22:34:23.353    ▲ Next.js 14.0.4\n22:34:23.353 \n22:34:23.354    Creating an optimized production build ...\n22:34:32.615  ✓ Compiled successfully\n22:34:32.616    Linting and checking validity of types ...\n22:34:46.903 Failed to compile.\n22:34:46.904 \n22:34:46.904 ./app/extension-callback/page.tsx:35:29\n22:34:46.905 Type error: Cannot find name 'chrome'.\n22:34:46.905 \n22:34:46.905 [0m [90m 33 |[39m[0m\n22:34:46.905 [0m [90m 34 |[39m         [90m// Send tokens to the extension[39m[0m\n22:34:46.905 [0m[31m[1m>[22m[39m[90m 35 |[39m         [36mconst[39m extensionId [33m=[39m chrome[33m?[39m[33m.[39mruntime[33m?[39m[33m.[39mid[33m;[39m[0m\n22:34:46.905 [0m [90m    |[39m                             [31m[1m^[22m[39m[0m\n22:34:46.906 [0m [90m 36 |[39m[0m\n22:34:46.906 [0m [90m 37 |[39m         [36mif[39m ([36mtypeof[39m chrome [33m!==[39m [32m'undefined'[39m [33m&&[39m chrome[33m.[39mruntime [33m&&[39m chrome[33m.[39mruntime[33m.[39msendMessage) {[0m\n22:34:46.906 [0m [90m 38 |[39m           [90m// We're in a Chrome context[39m[0m\n22:34:46.992 Error: Command \"npm run build\" exited with 1"
            }
          }
        },
        {
          "display": "The same issue is happening. I click log in and it loads up my site, but doesn't take me to the callback page",
          "pastedContents": {}
        },
        {
          "display": "it was quite a lot of little things. maybe we just need to leave it for now as will take too long to explain. When you crashed, we were working on building a chrome extension linked to my site that would allow users to quickly add url links to their main account. You build a version which I installed but the Log In functionality wasn't working. If i clicked on it, it would open a tab of my vercel site, which i was already logged into, but nothing would change on the extension. You can find the extension in keith\\chrome-extension",
          "pastedContents": {}
        },
        {
          "display": "Can you read claude.md? We've made some changes this that was updated but i hit an error because of some unsupported image type so had to close you without updating the claude.md",
          "pastedContents": {}
        },
        {
          "display": "i've removed the .svg that was causing the error. can you continue?",
          "pastedContents": {}
        },
        {
          "display": "what went wrong?",
          "pastedContents": {}
        },
        {
          "display": "So i installed the extension fine but when i click LOGIN, it loads my vercel site (which I'm already logged into) and then nothing changes on the side panel extension. If I click the LOG IN button again, chrome just opens another tab of my site but nothing changes on the extension.",
          "pastedContents": {}
        },
        {
          "display": "1. it should show a form first to add tags/projects/genres before saving.  2. Can you explain why i might not be comfortable with these permissions?  3. lets start with just the quick add for now.  4. Lets get it working in Chrome first.  5. Lets start with it as an 'unpacked extension' for now.",
          "pastedContents": {}
        },
        {
          "display": "Is it possible to create a Chrome extension linked to the site that would bring the Links functionality into a sidebar on Chrome so that Users can easily add links to projects and tag them while not on our main site? They’d obviously have to log in to their main account via the extension somehow. I’d like it to work similar to Raindrop.io where there’s a + icon on the sidebar where you can click it to add the URL that you are on to your library of links. Is this possible? Do you have any questions?",
          "pastedContents": {}
        },
        {
          "display": "On the mobile version, I'd like to change the following buttons to simply white plus symbols on blue rounded square buttons. And have these plus buttons on the same line as the page title (eg. Projects). I'd like you to do this on the Projects, Contacts, Schedule, Tasks, Notebook pages. I'd also like to hide the text explaining what the page does. Eg 'Manage your industry contacts and relationships'",
          "pastedContents": {}
        },
        {
          "display": "there were other changes we made that haven't been deployed. eg. changing the upload and export csv buttons on the Contacts page, fixing the favicons on the Links page, removing the 'No matching articles found yet. New matches will appear here automatically when articles mentioning \"Burn Night\" are published.' text on the Track tab on Industry page and reducing the space above and below the title and 'tracking since' text on tracked terms that have no matches. On the same page, we also removed the 'matching articles' text from entries that did have matches.",
          "pastedContents": {}
        },
        {
          "display": "can you push and commit all the changes we've made in this session to github and our vercel site. That's all we need to do to migrate these changes from the local dev site to the live vercel site right?",
          "pastedContents": {}
        },
        {
          "display": "\nOn the Analytics page on mobile version can we hide the overview section at the top that shows the total projects, total contacts and total submissions\n",
          "pastedContents": {}
        },
        {
          "display": "on the Tasks page on the mobile site, can you remove the 'Quick overview of your upcoming and overdue tasks' text to save space. I also want to reduce the size of the button beneath it that quickly highlights 'overdue' or 'upcoming' tasks. Ideally we'd be able to fit the 'Task Summary' heading and the 'overdue' or 'upcoming/this week' buttons all on one line. and within the 'overdue'/'upcoming/this week' buttons, it would be great if the number could be on the same line as the text, to reduce the height of those buttons. I'd also like to hide the Search Tasks section on mobile.",
          "pastedContents": {}
        },
        {
          "display": "Yesterday we made some changes to the way the Upload CSV, Export CSV buttons displayed on the Projects page. I want these changes to also be made on the Contacts page. On the desktop version of the site, we swapped these buttons for icon buttons. And on the mobile version, we hid these buttons altogether.",
          "pastedContents": {}
        },
        {
          "display": "on the Track tab, the space under tracked terms that have no matches is too large ( see TrackTermSpace.png in /refs). Can you reduce that so the bottom of the box is a short distance below 'Tracking since...'. And also reduce the space of the box above the title so that there's only a small gap. Both upper and lower gaps should be the same.  Also, in the entries that do have matches, you can remove the 'Matching Articles:' text. the listing of the articles should be clear enough.",
          "pastedContents": {}
        },
        {
          "display": "On the Track tab on Industry page, if a tracked term doesn't have any matches, it displays this text beneath the title and 'tracking since date': \"No matching articles found yet. New matches will appear here automatically when articles mentioning \"Burn Night\" are published.\" - can you remove this? You already have a bit of text saying 'no matches yet' next to the title, that does the job. Also, can you make it so the tracked terms that have matches are at the top. It should go from most amount of matches to least amount of matches.",
          "pastedContents": {}
        },
        {
          "display": "that's working. Could you make it so tags aren't case sensitive? I've got two tags, one that is 'cinematography', another that is 'Cinematography'. I don't want that to happen just because the User types a capital letter at the front. Also, before you fixed the auto fetch titles, the links in the list had little youtube/instagram etc icons next to the entries but they've disappeared now. Can you fix them?",
          "pastedContents": {}
        },
        {
          "display": "yeah that's better now. On the links page, can you make it so that tag field can auto fill? Eg if a User has already created a 'Cinematography' tag, when they start typing 'Cin' the tag 'Cinematography' should appear in the field for them to select.",
          "pastedContents": {}
        },
        {
          "display": "that's working now. the auto fetch of titles seems intermittent. One youtube video i saved called 'The Mill is Back' auto fetched as 'The Mill is Back - Youtube' but another youtube video called 'S1E4: The Realism of Image-based Lighting' auto fetched as just '- Youtube' - why might this be?",
          "pastedContents": {}
        },
        {
          "display": "When running the sql i got this error in supabase: ERROR:  42P01: relation \"link_genres\" does not exist",
          "pastedContents": {}
        },
        {
          "display": "The Links page was previously working, and we brought in the free api that allowed the links title to be auto created, but at some point during the work we did yesterday, the Link functionality broke. I can fill out the fields and click Add Link and i don't get an error but no entries appear in the list below. And none of the previous link entries i added are visible either",
          "pastedContents": {}
        },
        {
          "display": "can you start the dev server so i can look at the local site?",
          "pastedContents": {}
        },
        {
          "display": "could you read claude.md ",
          "pastedContents": {}
        },
        {
          "display": "can you update the claude.md as I'm going to finish for the day",
          "pastedContents": {}
        },
        {
          "display": "before i ran the above, ive realised mandates are now showing across both workspaces",
          "pastedContents": {}
        },
        {
          "display": "Market Intelligence tab is now showing the articles",
          "pastedContents": {}
        },
        {
          "display": "this is what i see in Console on the Market Intelligence tab: [Pasted text #1 +188 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Failed to load resource: the server responded with a status of 404 ()\nhqefgtuczwjffuydjwmb…r=created_at.desc:1 \n Failed to load resource: the server responded with a status of 403 ()\n938-402f3bc19e337b98.js:1 Error loading mandates: \nObject\ncode\n: \n\"42501\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"permission denied for table users\"\n[[Prototype]]\n: \nObject\nwindow.console.error    @    938-402f3bc19e337b98.js:1\nex    @    page-10e7b60b2f85608d.js:1\nhqefgtuczwjffuydjwmb…at.desc&limit=100:1 \n Failed to load resource: the server responded with a status of 400 ()\n\n938-402f3bc19e337b98.js:1 Error loading article matches: \nObject\ncode\n: \n\"42703\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"column news_contact_matches.article_id does not exist\"\n[[Prototype]]\n: \nObject\nwindow.console.error    @    938-402f3bc19e337b98.js:1\neg    @    page-10e7b60b2f85608d.js:1\nhqefgtuczwjffuydjwmb…at.desc&limit=100:1 \n Failed to load resource: the server responded with a status of 400 ()\n938-402f3bc19e337b98.js:1 Error loading article matches: \nObject\ncode\n: \n\"42703\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"column news_contact_matches.article_id does not exist\"\n[[Prototype]]\n: \nObject\nwindow.console.error    @    938-402f3bc19e337b98.js:1\neg    @    page-10e7b60b2f85608d.js:1\nhqefgtuczwjffuydjwmb…at.desc&limit=100:1 \n Failed to load resource: the server responded with a status of 400 ()\n938-402f3bc19e337b98.js:1 Error loading article matches: \nObject\ncode\n: \n\"42703\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"column news_contact_matches.article_id does not exist\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()\nwindow.console.error    @    938-402f3bc19e337b98.js:1\nhqefgtuczwjffuydjwmb…at.desc&limit=100:1 \n Failed to load resource: the server responded with a status of 400 ()\n938-402f3bc19e337b98.js:1 Error loading article matches: \nObject\ncode\n: \n\"42703\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"column news_contact_matches.article_id does not exist\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()\nwindow.console.error    @    938-402f3bc19e337b98.js:1"
            }
          }
        },
        {
          "display": "this is what i see for RLS policies for mandates: Policies\nManage Row Level Security policies for your tables\n\nDocs\n94586\n\nschema\n\npublic\n\nmandates\n\nDisable RLS\n\nCreate policy\n\nName    Command    Applied to    Actions\n\nadmin_manage_mandates_v2\nALL    \npublic\n\n\nadmin_only_mandates\nALL    \npublic\n\n\nall_authenticated_view_mandates\nSELECT    \npublic - and this is what i see for the RLS policies for 'contacts': Policies\nManage Row Level Security policies for your tables\n\nDocs\n17380\n\nschema\n\npublic\n\ncontacts\n\nDisable RLS\n\nCreate policy\n\nName    Command    Applied to    Actions\n\nworkspace_members_delete\nDELETE    \npublic\n\n\nworkspace_members_insert\nINSERT    \npublic\n\n\nworkspace_members_select\nSELECT    \npublic\n\n\nworkspace_members_update\nUPDATE    \npublic",
          "pastedContents": {}
        },
        {
          "display": "i hit my limit. can you carry on from where you were?",
          "pastedContents": {}
        },
        {
          "display": "Vercel has been deployed but I'm still not seeing any articles on Market Intelligence tab. And the mandate is still only showing in The Lynch Brothers workspace not the Extra Workspace. all sqls have been applied",
          "pastedContents": {}
        },
        {
          "display": "my local site isn't working for some reason. all i get on the page is: missing required error components, refreshing...",
          "pastedContents": {}
        },
        {
          "display": "1. this is the console log for Industry/Market Intelligence: [Pasted text #1 +293 lines] 2. The mandate is still missing. 3. no you fixed the articles being saved issue a while back",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "GET https://film-crm.vercel.app/favicon.ico 404 (Not Found)\n\n872-3828b96beb1b0c0a.js:21 \n GET https://hqefgtuczwjffuydjwmb.supabase.co/rest/v1/mandates?select=*&workspace_id=eq.decd6e7a-0ee1-4317-9192-be367c199055&order=created_at.desc 403 (Forbidden)\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\nh    @    872-3828b96beb1b0c0a.js:21\nr    @    872-3828b96beb1b0c0a.js:21\nPromise.then        \ni    @    872-3828b96beb1b0c0a.js:21\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\nthen    @    872-3828b96beb1b0c0a.js:1\n938-402f3bc19e337b98.js:1 Error loading mandates: \n{code: '42501', details: null, hint: null, message: 'permission denied for table users'}\nwindow.console.error    @    938-402f3bc19e337b98.js:1\nex    @    page-10e7b60b2f85608d.js:1\nawait in ex        \n(anonymous)    @    page-10e7b60b2f85608d.js:1\naD    @    fd9d1056-bb83248b179cbfc4.js:1\na1    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\no7    @    fd9d1056-bb83248b179cbfc4.js:1\n(anonymous)    @    fd9d1056-bb83248b179cbfc4.js:1\nw    @    938-402f3bc19e337b98.js:1\n872-3828b96beb1b0c0a.js:21 \n GET https://hqefgtuczwjffuydjwmb.supabase.co/rest/v1/news_contact_matches?selec…%2C7b37387b-04fe-45ce-a1bf-5b315f241aa2%29&order=created_at.desc&limit=100 400 (Bad Request)\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\nh    @    872-3828b96beb1b0c0a.js:21\nr    @    872-3828b96beb1b0c0a.js:21\nPromise.then        \ni    @    872-3828b96beb1b0c0a.js:21\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\n(anonymous)    @    872-3828b96beb1b0c0a.js:21\nthen    @    872-3828b96beb1b0c0a.js:1\n938-402f3bc19e337b98.js:1 Error loading article matches: \n{code: '42703', details: null, hint: null, message: 'column news_contact_matches.article_id does not exist'}\nwindow.console.error    @    938-402f3bc19e337b98.js:1\neg    @    page-10e7b60b2f85608d.js:1\nawait in eg        \n(anonymous)    @    page-10e7b60b2f85608d.js:1\naD    @    fd9d1056-bb83248b179cbfc4.js:1\na1    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\na4    @    fd9d1056-bb83248b179cbfc4.js:1\na6    @    fd9d1056-bb83248b179cbfc4.js:1\no7    @    fd9d1056-bb83248b179cbfc4.js:1\n(anonymous)    @    fd9d1056-bb83248b179cbfc4.js:1\nw    @    938-402f3bc19e337b98.js:1"
            }
          }
        },
        {
          "display": "ive already ran both those sqls when you asked me to before. and neither of them fixed the issues",
          "pastedContents": {}
        },
        {
          "display": "THe Mandate still isn't showing in Extra Workspace. And regarding the Market Intelligence tab console logs, here they are: [Pasted text #1 +125 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "favicon.ico:1 \n Failed to load resource: the server responded with a status of 404 ()\nhqefgtuczwjffuydjwmb…r=created_at.desc:1 \n Failed to load resource: the server responded with a status of 403 ()\n938-402f3bc19e337b98.js:1 Error loading mandates: \nObject\ncode\n: \n\"42501\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"permission denied for table users\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()\nwindow.console.error    @    938-402f3bc19e337b98.js:1\nhqefgtuczwjffuydjwmb…at.desc&limit=100:1 \n Failed to load resource: the server responded with a status of 400 ()\n938-402f3bc19e337b98.js:1 Error loading article matches: \nObject\ncode\n: \n\"42703\"\ndetails\n: \nnull\nhint\n: \nnull\nmessage\n: \n\"column news_contact_matches.article_id does not exist\"\n[[Prototype]]\n: \nObject\nconstructor\n: \nƒ Object()\nhasOwnProperty\n: \nƒ hasOwnProperty()\nisPrototypeOf\n: \nƒ isPrototypeOf()\npropertyIsEnumerable\n: \nƒ propertyIsEnumerable()\ntoLocaleString\n: \nƒ toLocaleString()\ntoString\n: \nƒ toString()\nvalueOf\n: \nƒ valueOf()\n__defineGetter__\n: \nƒ __defineGetter__()\n__defineSetter__\n: \nƒ __defineSetter__()\n__lookupGetter__\n: \nƒ __lookupGetter__()\n__lookupSetter__\n: \nƒ __lookupSetter__()\n__proto__\n: \n(...)\nget __proto__\n: \nƒ __proto__()\nset __proto__\n: \nƒ __proto__()\nwindow.console.error    @    938-402f3bc19e337b98.js:1"
            }
          }
        },
        {
          "display": "No i checked in Extra Workspace. There are still not articles showing in Market Intelligence tab.",
          "pastedContents": {}
        },
        {
          "display": "No they're still not visible in the Market Intelligence tab. Also ive noticed that the mandate I added is only visible in the Mandates tab on The Lynch Brothers workspace.  I want mandates to be visible across all workspaces for all users.",
          "pastedContents": {}
        },
        {
          "display": "No youre wrong. I have lots of contacts in both workspaces. And I was on the contact page for Ted Sarandos when i saw he had an article matched in Market Intelligence.",
          "pastedContents": {}
        },
        {
          "display": "that seems to be working now. On the /Industry page on the Market Intelligence tab, I'm seeing 'No articles found' (on the Extra Workspace). But i know there should be at least one article here, as there is a market intelligence match for Ted Sarandos. And that article appears on his contact page. As a reminder, this Market Intelligence tab should show all articles that have been matched with any of our contacts via the Market Intelligence functionality.",
          "pastedContents": {}
        },
        {
          "display": "Yes do both those. Also, strangely in two different workspaces I have the term 'Netflix' being tracked but I'm only seeing a matched article in one of the workspaces (The Lynch Brothers) and no matched article in Extra Workspace. Surely it should match across all workspaces?",
          "pastedContents": {}
        },
        {
          "display": "I'm getting a matched article for Netflix but oddly not for David Zaslav. Maybe his name didn't appear in any of the RSS feeds but I would be surprised. Also, I didn't get a notification that there was a matched article for Netflix.  And on the matched article link, I'm seeing &#8216; either side of the film title. Can this be fixed?",
          "pastedContents": {}
        },
        {
          "display": "I'm in the right workspace. I added a new entry of Netflix and it was visible but i hard refreshed the page and it disappeared",
          "pastedContents": {}
        },
        {
          "display": "I added terms to track (eg David Zaslav and Netflix) but they're no longer visible on the track page.",
          "pastedContents": {}
        },
        {
          "display": "I now see Saved articles but am not getting any matches or notifications on my site. I specifically added 'David Zaslav' as term to track as i know he's in a lot of articles at the moment but nothing matched with him. Here's the easy cron output: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Id: iad1::iad1::tfpvb-1761909610010-e22104bdffc5\nDate: Fri, 31 Oct 2025 11:20:44 GMT\nServer: Vercel\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Vercel-Cache: MISS\nCache-Control: public, max-age=0, must-revalidate\nContent-Type: application/json\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":9,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":9,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":0,\"saved\":0,\"skipped\":0},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":50,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":10,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":10,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":10,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":10,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":8,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":19,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":18,\"skipped\":0}],\"timestamp\":\"2025-10-31T11:20:44.666Z\"}"
            }
          }
        },
        {
          "display": "i can see you created this sql in /keith but i can't see you asking me to run it. should i?",
          "pastedContents": {}
        },
        {
          "display": "fix-tracked-terms-trigger.sql",
          "pastedContents": {}
        },
        {
          "display": "you mention 3 scripts but then only show 2. Should i be running 3 or the two you mention?",
          "pastedContents": {}
        },
        {
          "display": "looks like still an issue: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Matched-Path: /api/market-intelligence/parse-rss\nCache-Control: public, max-age=0, must-revalidate\nDate: Fri, 31 Oct 2025 10:55:17 GMT\nServer: Vercel\nX-Vercel-Cache: MISS\nX-Vercel-Id: iad1::iad1::t5t4h-1761908078343-fdeada7645e0\nContent-Type: application/json\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":5,\"saved\":0,\"skipped\":3},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":0,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":0,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":0,\"skipped\":0}],\"timestamp\":\"2025-10-31T10:55:17.629Z\"}"
            }
          }
        },
        {
          "display": "did all that but think it's giving me the same result: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Cache-Control: public, max-age=0, must-revalidate\nDate: Fri, 31 Oct 2025 10:46:36 GMT\nStrict-Transport-Security: max-age=63072000; includeSubDomains; preload\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nContent-Type: application/json\nServer: Vercel\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Cache: MISS\nX-Vercel-Id: iad1::iad1::995sz-1761907558413-67219d228318\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":5,\"saved\":0,\"skipped\":3},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":0,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":0,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":0,\"skipped\":0}],\"timestamp\":\"2025-10-31T10:46:36.468Z\"}"
            }
          }
        },
        {
          "display": "think we still have issues. this is the output: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Vercel-Id: iad1::iad1::87zfv-1761906330702-2cd450daaf4f\nCache-Control: public, max-age=0, must-revalidate\nContent-Type: application/json\nDate: Fri, 31 Oct 2025 10:26:05 GMT\nServer: Vercel\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Cache: MISS\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":5,\"saved\":0,\"skipped\":3},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":0,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":0,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":0,\"skipped\":0}],\"timestamp\":\"2025-10-31T10:26:05.272Z\"}"
            }
          }
        },
        {
          "display": "My SUPABASE_SERVICE_ROLE_KEY is currently: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxZWZndHVjendqZmZ1eWRqd21iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTY4NDQ2MiwiZXhwIjoyMDcxMjYwNDYyfQ.14yQ9aRDZjTgN_esrmVtqycvLzKhRugJWGJxaf0r4AE - so it's similar but not the same as what you suggested. why is that?",
          "pastedContents": {}
        },
        {
          "display": "I already went to Vercel and watched as it Built the new version and didnt run the easy cron manual thing until it said Ready",
          "pastedContents": {}
        },
        {
          "display": "I did that. This is the result i got: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Cache: MISS\nContent-Type: application/json\nServer: Vercel\nDate: Fri, 31 Oct 2025 10:15:42 GMT\nX-Vercel-Id: iad1::iad1::ls782-1761905703529-b5223fd7b527\nCache-Control: public, max-age=0, must-revalidate\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":5,\"saved\":0,\"skipped\":3},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":0,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":0,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":0,\"skipped\":0}],\"timestamp\":\"2025-10-31T10:15:42.525Z\"}"
            }
          }
        },
        {
          "display": "I couldnt find Request Method dropdown but can see a HTTP Method dropdown that was set to GET so have changed that to POST. I ran it manually and this is what the output was: [Pasted text #1 +10 lines]",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Date: Fri, 31 Oct 2025 10:09:21 GMT\nStrict-Transport-Security: max-age=63072000; includeSubDomains; preload\nX-Vercel-Id: iad1::iad1::ldhj2-1761905324761-b87f12684353\nCache-Control: public, max-age=0, must-revalidate\nContent-Type: application/json\nServer: Vercel\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Cache: MISS\n\n{\"success\":true,\"message\":\"RSS feeds parsed successfully\",\"results\":[{\"feed\":\"Variety\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Deadline\",\"articlesFound\":12,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Daily\",\"articlesFound\":0,\"saved\":0,\"skipped\":0},{\"feed\":\"Cineuropa\",\"articlesFound\":50,\"saved\":0,\"skipped\":0},{\"feed\":\"Film New Europe\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Little White Lies\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Screen Rant\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"Collider\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"The Hollywood Reporter\",\"articlesFound\":10,\"saved\":0,\"skipped\":0},{\"feed\":\"SlashFilm\",\"articlesFound\":20,\"saved\":0,\"skipped\":0},{\"feed\":\"FirstShowing\",\"articlesFound\":20,\"saved\":0,\"skipped\":0}],\"timestamp\":\"2025-10-31T10:09:21.189Z\"}"
            }
          }
        },
        {
          "display": "i went to Easy Cron and clicked on Executions and can see it ran at 6am and this is the output: [Pasted text #1 +11 lines] - So I'm assuming that means it did run, yeah?",
          "pastedContents": {
            "1": {
              "id": 1,
              "type": "text",
              "content": "Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url\nX-Matched-Path: /api/market-intelligence/parse-rss\nX-Vercel-Cache: MISS\nX-Vercel-Id: iad1::iad1::dzk54-1761890403899-b1cdddbbba63\nAge: 0\nCache-Control: public, max-age=0, must-revalidate\nContent-Type: application/json\nDate: Fri, 31 Oct 2025 06:00:04 GMT\nServer: Vercel\n\n{\"message\":\"Market Intelligence RSS Parser\",\"usage\":\"Send POST request to parse RSS feeds\",\"feeds\":[{\"name\":\"Variety\",\"url\":\"https://variety.com/feed/\"},{\"name\":\"Deadline\",\"url\":\"https://deadline.com/feed/\"},{\"name\":\"Screen Daily\",\"url\":\"https://www.screendaily.com/45202.rss\"},{\"name\":\"Cineuropa\",\"url\":\"https://cineuropa.org/en/rss/\"},{\"name\":\"Film New Europe\",\"url\":\"https://www.filmneweurope.com/?format=feed&type=rss\"},{\"name\":\"Little White Lies\",\"url\":\"https://lwlies.com/feed/\"},{\"name\":\"Screen Rant\",\"url\":\"https://screenrant.com/feed/\"},{\"name\":\"Collider\",\"url\":\"https://collider.com/feed/\"},{\"name\":\"The Hollywood Reporter\",\"url\":\"https://www.hollywoodreporter.com/c/movies/feed/\"},{\"name\":\"SlashFilm\",\"url\":\"https://feeds.feedburner.com/slashfilm\"},{\"name\":\"FirstShowing\",\"url\":\"https://www.firstshowing.net/feed/?full\"}]}"
            }
          }
        },
        {
          "display": "How can i check whether the Easy Cron setup ran at 6am this morning? I don't have any notifications but that might just mean there weren't any matches, so doesn't say either way whether its working or not",
          "pastedContents": {}
        },
        {
          "display": "so we avoid the issue again, why weren't all the changes deployed before?",
          "pastedContents": {}
        },
        {
          "display": "The vercel project buttons are still different to the local. See vercel_buttons.png and local_buttons.png in /refs. There's also no Add Meeting button on the schedule page on the vercel app, even though we brought it into the local app.",
          "pastedContents": {}
        }
      ],
      "mcpContextUris": [],
      "mcpServers": {},
      "enabledMcpjsonServers": [],
      "disabledMcpjsonServers": [],
      "hasTrustDialogAccepted": false,
      "projectOnboardingSeenCount": 0,
      "hasClaudeMdExternalIncludesApproved": false,
      "hasClaudeMdExternalIncludesWarningShown": false,
      "hasCompletedProjectOnboarding": true,
      "lastTotalWebSearchRequests": 0,
      "exampleFiles": [
        "page.tsx",
        "route.ts",
        "[id]/page.tsx",
        "Layout.tsx",
        "debug/route.ts"
      ],
      "exampleFilesGeneratedAt": 1761822955438
    }
  },
  "cachedChangelog": "# Changelog\n\n## 2.0.14\n\n- Fix @-mentioning MCP servers to toggle them on/off\n- Improve permission checks for bash with inline env vars\n- Fix ultrathink + thinking toggle\n- Reduce unnecessary logins\n- Document --system-prompt\n- Several improvements to rendering\n- Plugins UI polish\n\n## 2.0.13\n\n- Fixed `/plugin` not working on native build\n\n## 2.0.12\n\n- **Plugin System Released**: Extend Claude Code with custom commands, agents, hooks, and MCP servers from marketplaces\n- `/plugin install`, `/plugin enable/disable`, `/plugin marketplace` commands for plugin management\n- Repository-level plugin configuration via `extraKnownMarketplaces` for team collaboration\n- `/plugin validate` command for validating plugin structure and configuration\n- Plugin announcement blog post at https://www.anthropic.com/news/claude-code-plugins\n- Plugin documentation available at https://docs.claude.com/en/docs/claude-code/plugins\n- Comprehensive error messages and diagnostics via `/doctor` command\n- Avoid flickering in `/model` selector\n- Improvements to `/help`\n- Avoid mentioning hooks in `/resume` summaries\n- Changes to the \"verbose\" setting in `/config` now persist across sessions\n\n## 2.0.11\n\n- Reduced system prompt size by 1.4k tokens\n- IDE: Fixed keyboard shortcuts and focus issues for smoother interaction\n- Fixed Opus fallback rate limit errors appearing incorrectly\n- Fixed /add-dir command selecting wrong default tab\n\n## 2.0.10\n\n- Rewrote terminal renderer for buttery smooth UI\n- Enable/disable MCP servers by @mentioning, or in /mcp\n- Added tab completion for shell commands in bash mode\n- PreToolUse hooks can now modify tool inputs\n- Press Ctrl-G to edit your prompt in your system's configured text editor\n- Fixes for bash permission checks with environment variables in the command\n\n## 2.0.9\n\n- Fix regression where bash backgrounding stopped working\n\n## 2.0.8\n\n- Update Bedrock default Sonnet model to `global.anthropic.claude-sonnet-4-5-20250929-v1:0`\n- IDE: Add drag-and-drop support for files and folders in chat\n- /context: Fix counting for thinking blocks\n- Improve message rendering for users with light themes on dark terminals\n- Remove deprecated .claude.json allowedTools, ignorePatterns, env, and todoFeatureEnabled config options (instead, configure these in your settings.json)\n\n## 2.0.5\n\n- IDE: Fix IME unintended message submission with Enter and Tab\n- IDE: Add \"Open in Terminal\" link in login screen\n- Fix unhandled OAuth expiration 401 API errors\n- SDK: Added SDKUserMessageReplay.isReplay to prevent duplicate messages\n\n## 2.0.1\n\n- Skip Sonnet 4.5 default model setting change for Bedrock and Vertex\n- Various bug fixes and presentation improvements\n\n## 2.0.0\n\n- New native VS Code extension\n- Fresh coat of paint throughout the whole app\n- /rewind a conversation to undo code changes\n- /usage command to see plan limits\n- Tab to toggle thinking (sticky across sessions)\n- Ctrl-R to search history\n- Unshipped claude config command\n- Hooks: Reduced PostToolUse 'tool_use' ids were found without 'tool_result' blocks errors\n- SDK: The Claude Code SDK is now the Claude Agent SDK\n- Add subagents dynamically with `--agents` flag\n\n## 1.0.126\n\n- Enable /context command for Bedrock and Vertex\n- Add mTLS support for HTTP-based OpenTelemetry exporters\n\n## 1.0.124\n\n- Set `CLAUDE_BASH_NO_LOGIN` environment variable to 1 or true to to skip login shell for BashTool\n- Fix Bedrock and Vertex environment variables evaluating all strings as truthy\n- No longer inform Claude of the list of allowed tools when permission is denied\n- Fixed security vulnerability in Bash tool permission checks\n- Improved VSCode extension performance for large files\n\n## 1.0.123\n\n- Bash permission rules now support output redirections when matching (e.g., `Bash(python:*)` matches `python script.py > output.txt`)\n- Fixed thinking mode triggering on negation phrases like \"don't think\"\n- Fixed rendering performance degradation during token streaming\n- Added SlashCommand tool, which enables Claude to invoke your slash commands. https://docs.claude.com/en/docs/claude-code/slash-commands#SlashCommand-tool\n- Enhanced BashTool environment snapshot logging\n- Fixed a bug where resuming a conversation in headless mode would sometimes enable thinking unnecessarily\n- Migrated --debug logging to a file, to enable easy tailing & filtering\n\n## 1.0.120\n\n- Fix input lag during typing, especially noticeable with large prompts\n- Improved VSCode extension command registry and sessions dialog user experience\n- Enhanced sessions dialog responsiveness and visual feedback\n- Fixed IDE compatibility issue by removing worktree support check\n- Fixed security vulnerability where Bash tool permission checks could be bypassed using prefix matching\n\n## 1.0.119\n\n- Fix Windows issue where process visually freezes on entering interactive mode\n- Support dynamic headers for MCP servers via headersHelper configuration\n- Fix thinking mode not working in headless sessions\n- Fix slash commands now properly update allowed tools instead of replacing them\n\n## 1.0.117\n\n- Add Ctrl-R history search to recall previous commands like bash/zsh\n- Fix input lag while typing, especially on Windows\n- Add sed command to auto-allowed commands in acceptEdits mode\n- Fix Windows PATH comparison to be case-insensitive for drive letters\n- Add permissions management hint to /add-dir output\n\n## 1.0.115\n\n- Improve thinking mode display with enhanced visual effects\n- Type /t to temporarily disable thinking mode in your prompt\n- Improve path validation for glob and grep tools\n- Show condensed output for post-tool hooks to reduce visual clutter\n- Fix visual feedback when loading state completes\n- Improve UI consistency for permission request dialogs\n\n## 1.0.113\n\n- Deprecated piped input in interactive mode\n- Move Ctrl+R keybinding for toggling transcript to Ctrl+O\n\n## 1.0.112\n\n- Transcript mode (Ctrl+R): Added the model used to generate each assistant message\n- Addressed issue where some Claude Max users were incorrectly recognized as Claude Pro users\n- Hooks: Added systemMessage support for SessionEnd hooks\n- Added `spinnerTipsEnabled` setting to disable spinner tips\n- IDE: Various improvements and bug fixes\n\n## 1.0.111\n\n- /model now validates provided model names\n- Fixed Bash tool crashes caused by malformed shell syntax parsing\n\n## 1.0.110\n\n- /terminal-setup command now supports WezTerm\n- MCP: OAuth tokens now proactively refresh before expiration\n- Fixed reliability issues with background Bash processes\n\n## 1.0.109\n\n- SDK: Added partial message streaming support via `--include-partial-messages` CLI flag\n\n## 1.0.106\n\n- Windows: Fixed path permission matching to consistently use POSIX format (e.g., `Read(//c/Users/...)`)\n\n## 1.0.97\n\n- Settings: /doctor now validates permission rule syntax and suggests corrections\n\n## 1.0.94\n\n- Vertex: add support for global endpoints for supported models\n- /memory command now allows direct editing of all imported memory files\n- SDK: Add custom tools as callbacks\n- Added /todos command to list current todo items\n\n## 1.0.93\n\n- Windows: Add alt + v shortcut for pasting images from clipboard\n- Support NO_PROXY environment variable to bypass proxy for specified hostnames and IPs\n\n## 1.0.90\n\n- Settings file changes take effect immediately - no restart required\n\n## 1.0.88\n\n- Fixed issue causing \"OAuth authentication is currently not supported\"\n- Status line input now includes `exceeds_200k_tokens`\n- Fixed incorrect usage tracking in /cost.\n- Introduced `ANTHROPIC_DEFAULT_SONNET_MODEL` and `ANTHROPIC_DEFAULT_OPUS_MODEL` for controlling model aliases opusplan, opus, and sonnet.\n- Bedrock: Updated default Sonnet model to Sonnet 4\n\n## 1.0.86\n\n- Added /context to help users self-serve debug context issues\n- SDK: Added UUID support for all SDK messages\n- SDK: Added `--replay-user-messages` to replay user messages back to stdout\n\n## 1.0.85\n\n- Status line input now includes session cost info\n- Hooks: Introduced SessionEnd hook\n\n## 1.0.84\n\n- Fix tool_use/tool_result id mismatch error when network is unstable\n- Fix Claude sometimes ignoring real-time steering when wrapping up a task\n- @-mention: Add ~/.claude/\\* files to suggestions for easier agent, output style, and slash command editing\n- Use built-in ripgrep by default; to opt out of this behavior, set USE_BUILTIN_RIPGREP=0\n\n## 1.0.83\n\n- @-mention: Support files with spaces in path\n- New shimmering spinner\n\n## 1.0.82\n\n- SDK: Add request cancellation support\n- SDK: New additionalDirectories option to search custom paths, improved slash command processing\n- Settings: Validation prevents invalid fields in .claude/settings.json files\n- MCP: Improve tool name consistency\n- Bash: Fix crash when Claude tries to automatically read large files\n\n## 1.0.81\n\n- Released output styles, including new built-in educational output styles \"Explanatory\" and \"Learning\". Docs: https://docs.claude.com/en/docs/claude-code/output-styles\n- Agents: Fix custom agent loading when agent files are unparsable\n\n## 1.0.80\n\n- UI improvements: Fix text contrast for custom subagent colors and spinner rendering issues\n\n## 1.0.77\n\n- Bash tool: Fix heredoc and multiline string escaping, improve stderr redirection handling\n- SDK: Add session support and permission denial tracking\n- Fix token limit errors in conversation summarization\n- Opus Plan Mode: New setting in `/model` to run Opus only in plan mode, Sonnet otherwise\n\n## 1.0.73\n\n- MCP: Support multiple config files with `--mcp-config file1.json file2.json`\n- MCP: Press Esc to cancel OAuth authentication flows\n- Bash: Improved command validation and reduced false security warnings\n- UI: Enhanced spinner animations and status line visual hierarchy\n- Linux: Added support for Alpine and musl-based distributions (requires separate ripgrep installation)\n\n## 1.0.72\n\n- Ask permissions: have Claude Code always ask for confirmation to use specific tools with /permissions\n\n## 1.0.71\n\n- Background commands: (Ctrl-b) to run any Bash command in the background so Claude can keep working (great for dev servers, tailing logs, etc.)\n- Customizable status line: add your terminal prompt to Claude Code with /statusline\n\n## 1.0.70\n\n- Performance: Optimized message rendering for better performance with large contexts\n- Windows: Fixed native file search, ripgrep, and subagent functionality\n- Added support for @-mentions in slash command arguments\n\n## 1.0.69\n\n- Upgraded Opus to version 4.1\n\n## 1.0.68\n\n- Fix incorrect model names being used for certain commands like `/pr-comments`\n- Windows: improve permissions checks for allow / deny tools and project trust. This may create a new project entry in `.claude.json` - manually merge the history field if desired.\n- Windows: improve sub-process spawning to eliminate \"No such file or directory\" when running commands like pnpm\n- Enhanced /doctor command with CLAUDE.md and MCP tool context for self-serve debugging\n- SDK: Added canUseTool callback support for tool confirmation\n- Added `disableAllHooks` setting\n- Improved file suggestions performance in large repos\n\n## 1.0.65\n\n- IDE: Fixed connection stability issues and error handling for diagnostics\n- Windows: Fixed shell environment setup for users without .bashrc files\n\n## 1.0.64\n\n- Agents: Added model customization support - you can now specify which model an agent should use\n- Agents: Fixed unintended access to the recursive agent tool\n- Hooks: Added systemMessage field to hook JSON output for displaying warnings and context\n- SDK: Fixed user input tracking across multi-turn conversations\n- Added hidden files to file search and @-mention suggestions\n\n## 1.0.63\n\n- Windows: Fixed file search, @agent mentions, and custom slash commands functionality\n\n## 1.0.62\n\n- Added @-mention support with typeahead for custom agents. @<your-custom-agent> to invoke it\n- Hooks: Added SessionStart hook for new session initialization\n- /add-dir command now supports typeahead for directory paths\n- Improved network connectivity check reliability\n\n## 1.0.61\n\n- Transcript mode (Ctrl+R): Changed Esc to exit transcript mode rather than interrupt\n- Settings: Added `--settings` flag to load settings from a JSON file\n- Settings: Fixed resolution of settings files paths that are symlinks\n- OTEL: Fixed reporting of wrong organization after authentication changes\n- Slash commands: Fixed permissions checking for allowed-tools with Bash\n- IDE: Added support for pasting images in VSCode MacOS using ⌘+V\n- IDE: Added `CLAUDE_CODE_AUTO_CONNECT_IDE=false` for disabling IDE auto-connection\n- Added `CLAUDE_CODE_SHELL_PREFIX` for wrapping Claude and user-provided shell commands run by Claude Code\n\n## 1.0.60\n\n- You can now create custom subagents for specialized tasks! Run /agents to get started\n\n## 1.0.59\n\n- SDK: Added tool confirmation support with canUseTool callback\n- SDK: Allow specifying env for spawned process\n- Hooks: Exposed PermissionDecision to hooks (including \"ask\")\n- Hooks: UserPromptSubmit now supports additionalContext in advanced JSON output\n- Fixed issue where some Max users that specified Opus would still see fallback to Sonnet\n\n## 1.0.58\n\n- Added support for reading PDFs\n- MCP: Improved server health status display in 'claude mcp list'\n- Hooks: Added CLAUDE_PROJECT_DIR env var for hook commands\n\n## 1.0.57\n\n- Added support for specifying a model in slash commands\n- Improved permission messages to help Claude understand allowed tools\n- Fix: Remove trailing newlines from bash output in terminal wrapping\n\n## 1.0.56\n\n- Windows: Enabled shift+tab for mode switching on versions of Node.js that support terminal VT mode\n- Fixes for WSL IDE detection\n- Fix an issue causing awsRefreshHelper changes to .aws directory not to be picked up\n\n## 1.0.55\n\n- Clarified knowledge cutoff for Opus 4 and Sonnet 4 models\n- Windows: fixed Ctrl+Z crash\n- SDK: Added ability to capture error logging\n- Add --system-prompt-file option to override system prompt in print mode\n\n## 1.0.54\n\n- Hooks: Added UserPromptSubmit hook and the current working directory to hook inputs\n- Custom slash commands: Added argument-hint to frontmatter\n- Windows: OAuth uses port 45454 and properly constructs browser URL\n- Windows: mode switching now uses alt + m, and plan mode renders properly\n- Shell: Switch to in-memory shell snapshot to fix file-related errors\n\n## 1.0.53\n\n- Updated @-mention file truncation from 100 lines to 2000 lines\n- Add helper script settings for AWS token refresh: awsAuthRefresh (for foreground operations like aws sso login) and awsCredentialExport (for background operation with STS-like response).\n\n## 1.0.52\n\n- Added support for MCP server instructions\n\n## 1.0.51\n\n- Added support for native Windows (requires Git for Windows)\n- Added support for Bedrock API keys through environment variable AWS_BEARER_TOKEN_BEDROCK\n- Settings: /doctor can now help you identify and fix invalid setting files\n- `--append-system-prompt` can now be used in interactive mode, not just --print/-p.\n- Increased auto-compact warning threshold from 60% to 80%\n- Fixed an issue with handling user directories with spaces for shell snapshots\n- OTEL resource now includes os.type, os.version, host.arch, and wsl.version (if running on Windows Subsystem for Linux)\n- Custom slash commands: Fixed user-level commands in subdirectories\n- Plan mode: Fixed issue where rejected plan from sub-task would get discarded\n\n## 1.0.48\n\n- Fixed a bug in v1.0.45 where the app would sometimes freeze on launch\n- Added progress messages to Bash tool based on the last 5 lines of command output\n- Added expanding variables support for MCP server configuration\n- Moved shell snapshots from /tmp to ~/.claude for more reliable Bash tool calls\n- Improved IDE extension path handling when Claude Code runs in WSL\n- Hooks: Added a PreCompact hook\n- Vim mode: Added c, f/F, t/T\n\n## 1.0.45\n\n- Redesigned Search (Grep) tool with new tool input parameters and features\n- Disabled IDE diffs for notebook files, fixing \"Timeout waiting after 1000ms\" error\n- Fixed config file corruption issue by enforcing atomic writes\n- Updated prompt input undo to Ctrl+\\_ to avoid breaking existing Ctrl+U behavior, matching zsh's undo shortcut\n- Stop Hooks: Fixed transcript path after /clear and fixed triggering when loop ends with tool call\n- Custom slash commands: Restored namespacing in command names based on subdirectories. For example, .claude/commands/frontend/component.md is now /frontend:component, not /component.\n\n## 1.0.44\n\n- New /export command lets you quickly export a conversation for sharing\n- MCP: resource_link tool results are now supported\n- MCP: tool annotations and tool titles now display in /mcp view\n- Changed Ctrl+Z to suspend Claude Code. Resume by running `fg`. Prompt input undo is now Ctrl+U.\n\n## 1.0.43\n\n- Fixed a bug where the theme selector was saving excessively\n- Hooks: Added EPIPE system error handling\n\n## 1.0.42\n\n- Added tilde (`~`) expansion support to `/add-dir` command\n\n## 1.0.41\n\n- Hooks: Split Stop hook triggering into Stop and SubagentStop\n- Hooks: Enabled optional timeout configuration for each command\n- Hooks: Added \"hook_event_name\" to hook input\n- Fixed a bug where MCP tools would display twice in tool list\n- New tool parameters JSON for Bash tool in `tool_decision` event\n\n## 1.0.40\n\n- Fixed a bug causing API connection errors with UNABLE_TO_GET_ISSUER_CERT_LOCALLY if `NODE_EXTRA_CA_CERTS` was set\n\n## 1.0.39\n\n- New Active Time metric in OpenTelemetry logging\n\n## 1.0.38\n\n- Released hooks. Special thanks to community input in https://github.com/anthropics/claude-code/issues/712. Docs: https://docs.claude.com/en/docs/claude-code/hooks\n\n## 1.0.37\n\n- Remove ability to set `Proxy-Authorization` header via ANTHROPIC_AUTH_TOKEN or apiKeyHelper\n\n## 1.0.36\n\n- Web search now takes today's date into context\n- Fixed a bug where stdio MCP servers were not terminating properly on exit\n\n## 1.0.35\n\n- Added support for MCP OAuth Authorization Server discovery\n\n## 1.0.34\n\n- Fixed a memory leak causing a MaxListenersExceededWarning message to appear\n\n## 1.0.33\n\n- Improved logging functionality with session ID support\n- Added prompt input undo functionality (Ctrl+Z and vim 'u' command)\n- Improvements to plan mode\n\n## 1.0.32\n\n- Updated loopback config for litellm\n- Added forceLoginMethod setting to bypass login selection screen\n\n## 1.0.31\n\n- Fixed a bug where ~/.claude.json would get reset when file contained invalid JSON\n\n## 1.0.30\n\n- Custom slash commands: Run bash output, @-mention files, enable thinking with thinking keywords\n- Improved file path autocomplete with filename matching\n- Added timestamps in Ctrl-r mode and fixed Ctrl-c handling\n- Enhanced jq regex support for complex filters with pipes and select\n\n## 1.0.29\n\n- Improved CJK character support in cursor navigation and rendering\n\n## 1.0.28\n\n- Slash commands: Fix selector display during history navigation\n- Resizes images before upload to prevent API size limit errors\n- Added XDG_CONFIG_HOME support to configuration directory\n- Performance optimizations for memory usage\n- New attributes (terminal.type, language) in OpenTelemetry logging\n\n## 1.0.27\n\n- Streamable HTTP MCP servers are now supported\n- Remote MCP servers (SSE and HTTP) now support OAuth\n- MCP resources can now be @-mentioned\n- /resume slash command to switch conversations within Claude Code\n\n## 1.0.25\n\n- Slash commands: moved \"project\" and \"user\" prefixes to descriptions\n- Slash commands: improved reliability for command discovery\n- Improved support for Ghostty\n- Improved web search reliability\n\n## 1.0.24\n\n- Improved /mcp output\n- Fixed a bug where settings arrays got overwritten instead of merged\n\n## 1.0.23\n\n- Released TypeScript SDK: import @anthropic-ai/claude-code to get started\n- Released Python SDK: pip install claude-code-sdk to get started\n\n## 1.0.22\n\n- SDK: Renamed `total_cost` to `total_cost_usd`\n\n## 1.0.21\n\n- Improved editing of files with tab-based indentation\n- Fix for tool_use without matching tool_result errors\n- Fixed a bug where stdio MCP server processes would linger after quitting Claude Code\n\n## 1.0.18\n\n- Added --add-dir CLI argument for specifying additional working directories\n- Added streaming input support without require -p flag\n- Improved startup performance and session storage performance\n- Added CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR environment variable to freeze working directory for bash commands\n- Added detailed MCP server tools display (/mcp)\n- MCP authentication and permission improvements\n- Added auto-reconnection for MCP SSE connections on disconnect\n- Fixed issue where pasted content was lost when dialogs appeared\n\n## 1.0.17\n\n- We now emit messages from sub-tasks in -p mode (look for the parent_tool_use_id property)\n- Fixed crashes when the VS Code diff tool is invoked multiple times quickly\n- MCP server list UI improvements\n- Update Claude Code process title to display \"claude\" instead of \"node\"\n\n## 1.0.11\n\n- Claude Code can now also be used with a Claude Pro subscription\n- Added /upgrade for smoother switching to Claude Max plans\n- Improved UI for authentication from API keys and Bedrock/Vertex/external auth tokens\n- Improved shell configuration error handling\n- Improved todo list handling during compaction\n\n## 1.0.10\n\n- Added markdown table support\n- Improved streaming performance\n\n## 1.0.8\n\n- Fixed Vertex AI region fallback when using CLOUD_ML_REGION\n- Increased default otel interval from 1s -> 5s\n- Fixed edge cases where MCP_TIMEOUT and MCP_TOOL_TIMEOUT weren't being respected\n- Fixed a regression where search tools unnecessarily asked for permissions\n- Added support for triggering thinking non-English languages\n- Improved compacting UI\n\n## 1.0.7\n\n- Renamed /allowed-tools -> /permissions\n- Migrated allowedTools and ignorePatterns from .claude.json -> settings.json\n- Deprecated claude config commands in favor of editing settings.json\n- Fixed a bug where --dangerously-skip-permissions sometimes didn't work in --print mode\n- Improved error handling for /install-github-app\n- Bugfixes, UI polish, and tool reliability improvements\n\n## 1.0.6\n\n- Improved edit reliability for tab-indented files\n- Respect CLAUDE_CONFIG_DIR everywhere\n- Reduced unnecessary tool permission prompts\n- Added support for symlinks in @file typeahead\n- Bugfixes, UI polish, and tool reliability improvements\n\n## 1.0.4\n\n- Fixed a bug where MCP tool errors weren't being parsed correctly\n\n## 1.0.1\n\n- Added `DISABLE_INTERLEAVED_THINKING` to give users the option to opt out of interleaved thinking.\n- Improved model references to show provider-specific names (Sonnet 3.7 for Bedrock, Sonnet 4 for Console)\n- Updated documentation links and OAuth process descriptions\n\n## 1.0.0\n\n- Claude Code is now generally available\n- Introducing Sonnet 4 and Opus 4 models\n\n## 0.2.125\n\n- Breaking change: Bedrock ARN passed to `ANTHROPIC_MODEL` or `ANTHROPIC_SMALL_FAST_MODEL` should no longer contain an escaped slash (specify `/` instead of `%2F`)\n- Removed `DEBUG=true` in favor of `ANTHROPIC_LOG=debug`, to log all requests\n\n## 0.2.117\n\n- Breaking change: --print JSON output now returns nested message objects, for forwards-compatibility as we introduce new metadata fields\n- Introduced settings.cleanupPeriodDays\n- Introduced CLAUDE_CODE_API_KEY_HELPER_TTL_MS env var\n- Introduced --debug mode\n\n## 0.2.108\n\n- You can now send messages to Claude while it works to steer Claude in real-time\n- Introduced BASH_DEFAULT_TIMEOUT_MS and BASH_MAX_TIMEOUT_MS env vars\n- Fixed a bug where thinking was not working in -p mode\n- Fixed a regression in /cost reporting\n- Deprecated MCP wizard interface in favor of other MCP commands\n- Lots of other bugfixes and improvements\n\n## 0.2.107\n\n- CLAUDE.md files can now import other files. Add @path/to/file.md to ./CLAUDE.md to load additional files on launch\n\n## 0.2.106\n\n- MCP SSE server configs can now specify custom headers\n- Fixed a bug where MCP permission prompt didn't always show correctly\n\n## 0.2.105\n\n- Claude can now search the web\n- Moved system & account status to /status\n- Added word movement keybindings for Vim\n- Improved latency for startup, todo tool, and file edits\n\n## 0.2.102\n\n- Improved thinking triggering reliability\n- Improved @mention reliability for images and folders\n- You can now paste multiple large chunks into one prompt\n\n## 0.2.100\n\n- Fixed a crash caused by a stack overflow error\n- Made db storage optional; missing db support disables --continue and --resume\n\n## 0.2.98\n\n- Fixed an issue where auto-compact was running twice\n\n## 0.2.96\n\n- Claude Code can now also be used with a Claude Max subscription (https://claude.ai/upgrade)\n\n## 0.2.93\n\n- Resume conversations from where you left off from with \"claude --continue\" and \"claude --resume\"\n- Claude now has access to a Todo list that helps it stay on track and be more organized\n\n## 0.2.82\n\n- Added support for --disallowedTools\n- Renamed tools for consistency: LSTool -> LS, View -> Read, etc.\n\n## 0.2.75\n\n- Hit Enter to queue up additional messages while Claude is working\n- Drag in or copy/paste image files directly into the prompt\n- @-mention files to directly add them to context\n- Run one-off MCP servers with `claude --mcp-config <path-to-file>`\n- Improved performance for filename auto-complete\n\n## 0.2.74\n\n- Added support for refreshing dynamically generated API keys (via apiKeyHelper), with a 5 minute TTL\n- Task tool can now perform writes and run bash commands\n\n## 0.2.72\n\n- Updated spinner to indicate tokens loaded and tool usage\n\n## 0.2.70\n\n- Network commands like curl are now available for Claude to use\n- Claude can now run multiple web queries in parallel\n- Pressing ESC once immediately interrupts Claude in Auto-accept mode\n\n## 0.2.69\n\n- Fixed UI glitches with improved Select component behavior\n- Enhanced terminal output display with better text truncation logic\n\n## 0.2.67\n\n- Shared project permission rules can be saved in .claude/settings.json\n\n## 0.2.66\n\n- Print mode (-p) now supports streaming output via --output-format=stream-json\n- Fixed issue where pasting could trigger memory or bash mode unexpectedly\n\n## 0.2.63\n\n- Fixed an issue where MCP tools were loaded twice, which caused tool call errors\n\n## 0.2.61\n\n- Navigate menus with vim-style keys (j/k) or bash/emacs shortcuts (Ctrl+n/p) for faster interaction\n- Enhanced image detection for more reliable clipboard paste functionality\n- Fixed an issue where ESC key could crash the conversation history selector\n\n## 0.2.59\n\n- Copy+paste images directly into your prompt\n- Improved progress indicators for bash and fetch tools\n- Bugfixes for non-interactive mode (-p)\n\n## 0.2.54\n\n- Quickly add to Memory by starting your message with '#'\n- Press ctrl+r to see full output for long tool results\n- Added support for MCP SSE transport\n\n## 0.2.53\n\n- New web fetch tool lets Claude view URLs that you paste in\n- Fixed a bug with JPEG detection\n\n## 0.2.50\n\n- New MCP \"project\" scope now allows you to add MCP servers to .mcp.json files and commit them to your repository\n\n## 0.2.49\n\n- Previous MCP server scopes have been renamed: previous \"project\" scope is now \"local\" and \"global\" scope is now \"user\"\n\n## 0.2.47\n\n- Press Tab to auto-complete file and folder names\n- Press Shift + Tab to toggle auto-accept for file edits\n- Automatic conversation compaction for infinite conversation length (toggle with /config)\n\n## 0.2.44\n\n- Ask Claude to make a plan with thinking mode: just say 'think' or 'think harder' or even 'ultrathink'\n\n## 0.2.41\n\n- MCP server startup timeout can now be configured via MCP_TIMEOUT environment variable\n- MCP server startup no longer blocks the app from starting up\n\n## 0.2.37\n\n- New /release-notes command lets you view release notes at any time\n- `claude config add/remove` commands now accept multiple values separated by commas or spaces\n\n## 0.2.36\n\n- Import MCP servers from Claude Desktop with `claude mcp add-from-claude-desktop`\n- Add MCP servers as JSON strings with `claude mcp add-json <n> <json>`\n\n## 0.2.34\n\n- Vim bindings for text input - enable with /vim or /config\n\n## 0.2.32\n\n- Interactive MCP setup wizard: Run \"claude mcp add\" to add MCP servers with a step-by-step interface\n- Fix for some PersistentShell issues\n\n## 0.2.31\n\n- Custom slash commands: Markdown files in .claude/commands/ directories now appear as custom slash commands to insert prompts into your conversation\n- MCP debug mode: Run with --mcp-debug flag to get more information about MCP server errors\n\n## 0.2.30\n\n- Added ANSI color theme for better terminal compatibility\n- Fixed issue where slash command arguments weren't being sent properly\n- (Mac-only) API keys are now stored in macOS Keychain\n\n## 0.2.26\n\n- New /approved-tools command for managing tool permissions\n- Word-level diff display for improved code readability\n- Fuzzy matching for slash commands\n\n## 0.2.21\n\n- Fuzzy matching for /commands\n",
  "changelogLastFetched": 1760357494892,
  "lastReleaseNotesSeen": "2.0.14",
  "firstStartTime": "2025-08-29T10:05:16.951Z",
  "oauthAccount": {
    "accountUuid": "92c67507-bb62-4151-a035-8527f1f9d81a",
    "emailAddress": "keith@arecibomedia.com",
    "organizationUuid": "01f4a349-72e1-4b27-b110-d2996ec7c6d4",
    "organizationRole": "admin",
    "workspaceRole": null,
    "organizationName": "Keith Lynch",
    "displayName": "Keith",
    "organizationBillingType": "stripe_subscription"
  },
  "claudeCodeFirstTokenDate": "2025-08-19T13:33:14.769046Z",
  "hasCompletedOnboarding": true,
  "lastOnboardingVersion": "1.0.84",
  "subscriptionNoticeCount": 0,
  "hasAvailableSubscription": false,
  "s1mAccessCache": {
    "01f4a349-72e1-4b27-b110-d2996ec7c6d4": {
      "hasAccess": false,
      "hasAccessNotAsDefault": false,
      "timestamp": 1762269782557
    }
  },
  "isQualifiedForDataSharing": false,
  "sonnet45MigrationComplete": true,
  "hasOpusPlanDefault": false,
  "feedbackSurveyState": {
    "lastShownTime": 1762174818804
  }
}